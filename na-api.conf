<VirtualHost *:80>
    ServerName na-api.topdev.co.ke

    ProxyPreserveHost On
    ProxyRequests Off
    
    # Increase timeout for long-running AI requests
    ProxyTimeout 300
    
    # WebSocket support for SignalR
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://127.0.0.1:5001/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://127.0.0.1:5001/$1 [P,L]
    
    # Reverse proxy to your backend
    ProxyPass / http://127.0.0.1:5001/ upgrade=websocket
    ProxyPassReverse / http://127.0.0.1:5001/
    
    # Allow WebSocket connections to stay alive
    ProxyPass /userHub ws://127.0.0.1:5001/userHub
    ProxyPassReverse /userHub ws://127.0.0.1:5001/userHub

    ErrorLog ${APACHE_LOG_DIR}/na-api_error.log
    CustomLog ${APACHE_LOG_DIR}/na-api_access.log combined
</VirtualHost>
