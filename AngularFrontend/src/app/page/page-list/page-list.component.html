<section class="content">
  <div class="container-fluid">
    <div class="d-flex mb-2">
      <div class="me-auto">
        <span class="mb-0 page-title">{{ "PAGES" | translate }} <app-page-help-text
            code="PAGES"></app-page-help-text></span>
      </div>
      <div class="d-flex justify-content-end">
        <button class="error me-2" matButton="filled" (click)="refresh()">
          <mat-icon class="medium-icon fs-5 align-middle">refresh</mat-icon>
          {{ "REFRESH" | translate }}
        </button>
        <button class="primary me-2" matButton="filled" (click)="managePage()">
          <mat-icon class="medium-icon fs-5 align-middle">add</mat-icon>
          {{ "ADD_PAGE" | translate }}
        </button>
      </div>
    </div>
    <mat-card appearance="outlined">
      <mat-card-content>
        <div class="table-responsive">
          <div class="grid-height-large">
            <table mat-table [dataSource]="pageStore.pages()" multiTemplateDataRows>
              <!-- Action Column -->
              <ng-container matColumnDef="action">
                <th class="table-column-fix-250" mat-header-cell *matHeaderCellDef>{{'ACTION' | translate}} </th>
                <td mat-cell *matCellDef="let element">
                  <div class="d-flex align-items-center">
                    <button class="me-2" mat-icon-button (click)="toggleRow(element)">
                      @if (element != expandedElement) {
                      <mat-icon>chevron_right</mat-icon>
                      }
                      @if (element == expandedElement) {
                      <mat-icon>expand_more</mat-icon>
                      }
                    </button>
                    <button (click)="managePage(element)" class="success btn-sm me-2" matButton="filled" type="button">
                      <mat-icon class="medium-icon fs-5 align-middle">edit</mat-icon>
                      <span class="d-none d-sm-inline"> {{'EDIT' | translate}}</span>
                    </button>
                    <button (click)="deletePage(element)" class="error" matButton="filled" type="button">
                      <mat-icon class="medium-icon fs-5 align-middle">delete</mat-icon>
                      <span class="d-none d-sm-inline"> {{'DELETE' | translate}}</span>
                    </button>
                  </div>
                </td>
              </ng-container>
              <!-- Name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef> {{'NAME' | translate}} </th>
                <td mat-cell *matCellDef="let element"> {{element.name}} </td>
              </ng-container>
              <ng-container matColumnDef="order">
                <th mat-header-cell *matHeaderCellDef> {{'ORDER' | translate}} </th>
                <td mat-cell *matCellDef="let element"> {{element.order}} </td>
              </ng-container>
              <ng-container matColumnDef="expandedDetail">
                <td mat-cell *matCellDef="let actionObject" [attr.colspan]="displayedColumns.length">
                  @if(actionObject?.id == expandedElement?.id){
                  <div animate.enter="expandanimation" animate.leave="collapseanimation" class="expandable-panel">
                    <div class="my-2 mx-5">
                      <div class="row mb-3 align-items-center justify-content-between">
                        <div class="col-md-auto col-sm-auto">
                          <div class="section-title">
                            <h5> {{'ACTION' |translate}}</h5>
                          </div>
                        </div>
                        <div class="col-md-auto col-sm-auto">
                          <h4 class="widget-title">
                            <button class="success me-2" matButton="filled" (click)="manageAction()">
                              <mat-icon class="medium-icon fs-5 align-middle">add</mat-icon>
                              {{'ADD_ACTION' |translate}}
                            </button>
                          </h4>
                        </div>
                      </div>
                      <!-- Sub Action Table -->
                      <table mat-table [dataSource]="actionStore.selectedPageAction()" multiTemplateDataRows
                        class="table ">
                        <ng-container matColumnDef="action">
                          <th mat-header-cell *matHeaderCellDef>{{'ACTION' | translate}}
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <button (click)="manageAction(element)" class="primary me-2" matButton="filled"
                              type="button">
                              <mat-icon class="medium-icon fs-5 align-middle">edit</mat-icon>
                              {{'EDIT' | translate}}
                            </button>
                            <button (click)="deleteAction(element)" class="error" matButton="filled" type="button">
                              <mat-icon class="medium-icon fs-5 align-middle">delete</mat-icon>
                              {{'DELETE' | translate}}
                            </button>
                          </td>
                        </ng-container>
                        <ng-container matColumnDef="name">
                          <th mat-header-cell *matHeaderCellDef> {{'NAME' | translate}} </th>
                          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                        </ng-container>
                        <ng-container matColumnDef="order">
                          <th mat-header-cell *matHeaderCellDef> {{'ORDER' | translate}} </th>
                          <td mat-cell *matCellDef="let element"> {{element.order}} </td>
                        </ng-container>
                        <ng-container matColumnDef="code">
                          <th mat-header-cell *matHeaderCellDef> {{'CODE' | translate}} </th>
                          <td mat-cell *matCellDef="let element"> {{element.code}} </td>
                        </ng-container>

                        <tr class="grid-header-color" mat-header-row
                          *matHeaderRowDef="subActionColumnToDisplay;sticky: true">
                        </tr>
                        <tr mat-row *matRowDef="let row; columns: subActionColumnToDisplay;">
                        </tr>
                      </table>
                    </div>
                  </div>
                  }
                </td>
              </ng-container>
              <tr *matNoDataRow>
                <td colspan="6">
                  <div class="m-2">
                    <b> {{ "NO_DATA_FOUND" | translate }}</b>
                  </div>
                </td>
              </tr>
              <tr class="grid-header-color" mat-header-row *matHeaderRowDef="displayedColumns;sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row">
              </tr>
            </table>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</section>
@if(pageStore.isLoading()) {
<div class="spinner-container">
  <!-- <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div> -->
  <mat-progress-spinner mode="indeterminate" diameter="60" strokeWidth="5">
  </mat-progress-spinner>
</div>
}
