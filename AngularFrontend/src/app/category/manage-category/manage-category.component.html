<mat-dialog-content>
  <div class="d-flex">
    <div class="me-auto p-2">
      <span class="mb-3 page-title">
        {{ "MANAGE_CATEGORY" | translate }}
        <app-page-help-text [code]="'DOCUMENT_CATEGORIES'"></app-page-help-text>
      </span>
    </div>
    <div class="d-flex justify-content-end mb-2">
      <mat-icon
        class="close-icon text-danger cursor-pointer"
        (click)="onCancel()"
        >cancel</mat-icon
      >
    </div>
  </div>

  <form
    name="form"
    (ngSubmit)="saveCategory()"
    [formGroup]="categoryForm"
    novalidate
  >
    <div class="row gy-3">
      <div class="col-sm-12">
        <label class="form-label" for="category">
          {{ "PARENT_CATEGORY" | translate }}
        </label>

        <mat-select
          panelClass="mat-select-control"
          class="form-control"
          formControlName="parentId"
          placeholder="{{ 'SELECT_CATEGORY' | translate }}"
        >
          <!-- Trigger (shows selected item icon + name) -->
          <mat-select-trigger>
            <div class="d-flex align-items-center">
              <mat-icon class="text-warning me-1">folder</mat-icon>
              <span>
                {{
                  getCategoryNameById(categoryForm.get("parentId")?.value) ||
                    ("NONE" | translate)
                }}
              </span>
            </div>
          </mat-select-trigger>
          <!-- None option -->
          <mat-option [value]=""> -- {{ "NONE" | translate }} -- </mat-option>
          <!-- Category list -->
          @for(category of allCategories; track $index; let i= $index){
          <mat-option [value]="category.id">
            <div
              class="country-item"
              [ngStyle]="{
                'margin-left.px': (category.deafLevel ?? 0) * 20
              }"
            >
              @if(category.deafLevel == 0) {
              <div class="d-flex align-items-center">
                <mat-icon class="text-warning me-1">folder</mat-icon>
                <b>{{ category.name }}</b>
              </div>
              } @else {
              <div
                [matTooltip]="category.name"
                class="d-flex align-items-center"
              >
                <mat-icon class="text-warning me-1">folder</mat-icon>
                {{ category.name }}
              </div>
              }
            </div>
          </mat-option>
          }
        </mat-select>
      </div>

      <div class="col-sm-12">
        <label class="form-label" for="categoryName">{{
          "NAME" | translate
        }}</label>
        <input
          required
          formControlName="name"
          type="text"
          name="name"
          class="form-control"
          id="categoryName"
        />
        @if(categoryForm.get('name')?.touched &&
        categoryForm.get('name')?.errors &&
        categoryForm.get('name')?.hasError('required')){
        <div class="text-danger">
          {{ "CATEGORY_NAME_IS_REQUIRED" | translate }}
        </div>
        }
      </div>
      <div class="col-sm-12">
        <label class="form-label" for="description">{{
          "DESCRIPTION" | translate
        }}</label>
        <textarea
          formControlName="description"
          name="description"
          type="text"
          class="form-control"
        >
        </textarea>
      </div>
      <div class="col-md-12 mt-2">
        <button
          type="submit"
          *hasClaim="'CREATE_CATEGORY'"
          class="success me-1"
          matButton="filled"
          cdkFocusInitial
        >
          <mat-icon class="medium-icon">save</mat-icon>
          {{ isEdit ? ("UPDATE" | translate) : ("CREATE" | translate) }}
        </button>
        <button
          type="button"
          class="error"
          matButton="filled"
          (click)="onCancel()"
        >
          <mat-icon class="medium-icon">cancel</mat-icon>
          {{ "CANCEL" | translate }}
        </button>
      </div>
    </div>
  </form>
</mat-dialog-content>
