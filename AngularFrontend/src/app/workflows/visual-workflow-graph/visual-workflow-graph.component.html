<mat-dialog-content>
  <div class="d-flex">
    <div class="me-auto p-2">
      <span class="mb-3 page-title">{{data.workflowName | limitTo : "100"}}
      </span>
    </div>
    <div class="d-flex justify-content-end mb-2">
      <mat-icon class="close-icon text-danger cursor-pointer " (click)="onDocumentCancel()">cancel</mat-icon>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-3">
      <div class="ngx-graph-height">
        <ngx-graph #graph class="chart-container" [layoutSettings]="{ orientation: 'TB' }" [links]="links"
          [nodes]="nodes" [layout]="'dagre'" [curve]="curve" [panOnZoom]="true" [autoCenter]="false" [autoZoom]="true">
          <ng-template #defsTemplate>
            <svg:marker id="arrow" viewBox="0 -5 10 10" refX="8" refY="0" markerWidth="4" markerHeight="4"
              orient="auto">
              <svg:path d="M0,-5L10,0L0,5" class="arrow-head" />
            </svg:marker>
          </ng-template>
          <ng-template #nodeTemplate let-node>
            <svg:g class="node">
              <svg:rect [attr.width]="node.dimension?.width || 100" [attr.height]="node.dimension?.height || 50"
                [attr.fill]="node.data?.color || '#ccc'">
              </svg:rect>
              <svg:text alignment-baseline="central" [attr.fill]="'#fff'" [attr.x]="10"
                [attr.y]="(node.dimension?.height || 50) / 2">
                {{node.label}}
              </svg:text>
            </svg:g>
          </ng-template>
          <ng-template #linkTemplate let-link>
            @if(link.source && link.target) {
            <svg:g class="edge">
              <svg:path class="line" stroke-width="2" marker-end="url(#arrow)"></svg:path>
              <svg:text class="edge-label" text-anchor="middle">
                <textPath [attr.fill]="link.status === 1 ? 'green' : 'black'" class="text-path"
                  [attr.href]="'#' + link.id" [style.dominant-baseline]="link.dominantBaseline" startOffset="50%">
                  {{link.label}}
                </textPath>
              </svg:text>
            </svg:g>
            }
          </ng-template>
        </ngx-graph>
      </div>
    </div>
    <div class="col-sm-9">
      <div class="row">
        <div class="col">
          <div class="card shadow mt-2">
            <div class="card-header d-flex align-items-center">
              <mat-icon class="medium-icon fs-5 align-middle">info</mat-icon>
              <span class="px-2 h5 font-weight-bold mb-0">{{"WORKFLOW_DETAILS" | translate}}</span>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-6">
                  <p class="h6"><strong>{{"NAME" | translate}}:</strong> {{data.workflowName}}</p>
                  @if(data.workflowDescription) {
                  <p class="h6"><strong>{{"DESCRIPTION" | translate}}:</strong>
                    {{data.workflowDescription}}</p>
                  }
                  <p class="h6"><strong>{{"STATUS" | translate}}:</strong> {{data.workflowInstanceStatus |
                    workflowInstanceStatus}}</p>
                </div>
                <div class="col-6">
                  <p class="h6"><strong>{{"DOCUMENT" | translate}}:</strong>
                    <a class="doc-link" (click)="onDocumentView()">{{data.documentNumber}}-{{data.documentName}}</a>
                  </p>
                  <p class="h6"><strong>{{"CREATED_DATE" | translate}}:</strong> {{data.createdAt |
                    utcToLocalTime:'full' }}
                  </p>
                  <p class="h6"><strong>{{"UPDATED_DATE" | translate}}:</strong> {{data.updatedAt |
                    utcToLocalTime:'full' }}
                  </p>
                  <p class="h6"><strong>{{"INITIATED_BY" | translate}}:</strong> {{data.initiatedBy }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        @if(data && data.pendingWorkflowTransitions && data.pendingWorkflowTransitions.length > 0) {
        <div class="col-md-6 col-sm-12"
          [ngClass]="{'col-md-12': data.completedWorkflowTransitionInstances?.length == 0}">
          <div class="row">
            <div class="col">
              <span class="px-2 h5 font-weight-bold mb-0 text-danger">{{"PENDING_TRANSITIONS" | translate}}</span>
            </div>
          </div>
          @for(transition of data.pendingWorkflowTransitions; track $index) {
          <div class="card shadow  mt-2">
            <div class="card-header d-flex align-items-center">
              <mat-icon class="text-danger medium-icon fs-5 align-middle">schedule</mat-icon>
              <div>
                <span class="px-2 h6 font-weight-bold mb-0">{{transition.name}}</span>
                <small class="badge bg-danger"> {{"PENDING" | translate}}</small>
              </div>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-left">
                <div class="text-center me-3">
                  <span class="h6 mb-1">{{transition.fromStepName}}</span>
                </div>
                <div class="text-center me-3 pt-3">
                  <mat-icon class="text-danger medium-icon">arrow_right_alt</mat-icon>
                  <small class="d-block text-danger  font-size-7">{{"PENDING" | translate}}</small>
                </div>
                <div class="text-center">
                  <span class="h6 mb-1">{{transition.toStepName}}</span>
                </div>
              </div>
              @if(transition?.assignRoles){
              <p class="h6"><strong>Assigned To Roles:</strong> {{
                transition.assignRoles }}
              </p>
              }
              @if(transition?.assignUsers){
              <p class="h6"><strong>Assigned To Users:</strong> {{
                transition.assignUsers }}
              </p>
              }
            </div>
          </div>
          }
        </div>
        }
        @if(data && data.completedWorkflowTransitionInstances && data.completedWorkflowTransitionInstances.length >
        0) {
        <div class="col-md-6 col-sm-12" [ngClass]="{'col-md-12': data.pendingWorkflowTransitions?.length == 0 }">
          <div class="row">
            <div class="col">
              <span class="px-2 h5 font-weight-bold mb-0 text-success">{{"COMPLETED_TRANSTIONS" | translate}}</span>
            </div>
          </div>
          @for(transition of data.completedWorkflowTransitionInstances; track $index) {
          <div class="card shadow  mt-2">
            <div class="card-header d-flex align-items-center">
              @if(transition.status==1) {
              <mat-icon class="text-success medium-icon fs-5 align-middle">check_circle</mat-icon>
              }
              @if(transition.status==0) {
              <mat-icon class="text-danger medium-icon fs-5 align-middle">schedule</mat-icon>
              }
              <div>
                <span class="px-2 h5 font-weight-bold mb-0">{{transition.name}}</span>
                <small class="badge" [ngClass]="{'bg-success': transition.status==1,'bg-danger':transition.status==0 }">
                  {{transition.status==1 ? 'Completed' : 'Initiated'}}
                </small>
              </div>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-left">
                <div class="text-center me-3">
                  <span class="h6 mb-1">{{transition.fromStepName}}</span>
                </div>
                <div class="text-center me-3 pt-3">
                  @if (transition.status == 1) {
                  <mat-icon class="text-success medium-icon fs-4 align-middle">arrow_right_alt</mat-icon>
                  }
                  @if (transition.status == 0 ) {
                  <mat-icon class="text-danger medium-icon fs-4 align-middle">arrow_right_alt</mat-icon>
                  }
                  @if(transition.status==1) {
                  <small class="d-block font-size-7 text-success">Completed</small>
                  }
                </div>
                <div class="text-center">
                  <span class="h6 mb-1">{{transition.toStepName}}</span>
                </div>
              </div>
              @if(transition.createdAt) {
              <p class="h6"><strong>Created Date:</strong> {{ transition.createdAt |
                utcToLocalTime:'full' }}</p>
              }
              @if(transition.completedAt && transition.status==1) {
              <p class="h6"><strong>Completed Date:</strong> {{
                transition.completedAt |
                utcToLocalTime:'full' }}</p>
              }
              @if(transition?.user) {
              <p class="h6"><strong>Perform By:</strong> {{ transition?.user?.lastName
                }}&nbsp;&nbsp;{{
                transition.user?.firstName }}</p>
              }
              @if(transition?.comment) {
              <p class="h6"><strong>Comment:</strong> {{ transition?.comment }}</p>
              }
            </div>
          </div>
          }
        </div>
        }
      </div>
    </div>
  </div>

</mat-dialog-content>
