import{a as N}from"./chunk-NHBDANCD.js";import{a as f,b as a,c as B,d as I,e as R,f as S,g as E,h as C}from"./chunk-OHUA35YV.js";import{a as b}from"./chunk-APWCXNU6.js";import{a as p}from"./chunk-RKRBEXQJ.js";import{Ob as y,i as c}from"./chunk-KZMFGXDY.js";import{Pa as g,Ub as w,W as h,_b as P,h as l}from"./chunk-W3TJXGK4.js";import{a as m,b as s}from"./chunk-H5HZ6YB3.js";var U={documents:[],isLoading:!1,categories:[],selectedCategoryId:"",newCategoryPath:[],documentResourceParameter:{id:"",createdBy:"",categoryId:"",documentStatusId:"",storageSettingId:"",clientId:"",createDate:void 0,fields:"",orderBy:"createdDate desc",searchQuery:"",pageSize:15,skip:0,name:"",totalCount:0,metaTags:"",documentNumber:""},commonError:null},_=B({providedIn:"root"},E(U),I(({documentResourceParameter:o,categories:n,documents:i})=>({sortedCategories:y(()=>{if(!n()||n().length===0)return[];let t=o().orderBy.split(" ");return t[0]==="name"?t[1]==="asc"?[...n().sort((e,r)=>r.name.localeCompare(e.name))]:[...n().sort((e,r)=>e.name.localeCompare(r.name))]:t[0]==="createdDate"?t[1]==="asc"?[...n().sort((e,r)=>new Date(e.createdDate).getTime()-new Date(r.createdDate).getTime())]:[...n().sort((e,r)=>new Date(r.createdDate).getTime()-new Date(e.createdDate).getTime())]:t[0]==="createdBy"?t[1]==="asc"?[...n().sort((e,r)=>r.createdUserName?.localeCompare(e.createdUserName??"")??0)]:[...n().sort((e,r)=>e.createdUserName?.localeCompare(r.createdUserName??"")??0)]:[...n()]}),sortedDocuments:y(()=>{if(!i()||i().length===0)return[];let t=o().orderBy.split(" ");return t[0]==="createdDate"?t[1]==="asc"?[...i().sort((e,r)=>new Date(e.createdDate).getTime()-new Date(r.createdDate).getTime())]:[...i().sort((e,r)=>new Date(r.createdDate).getTime()-new Date(e.createdDate).getTime())]:t[0]==="name"?t[1]==="asc"?[...i().sort((e,r)=>r.name.localeCompare(e.name))]:[...i().sort((e,r)=>e.name.localeCompare(r.name))]:t[0]==="documentNumber"?t[1]==="asc"?[...i().sort((e,r)=>r.documentNumber?.localeCompare(e.documentNumber))]:[...i().sort((e,r)=>e.documentNumber?.localeCompare(r.documentNumber))]:t[0]==="createdBy"?t[1]==="asc"?[...i().sort((e,r)=>r.createdBy?.localeCompare(e.createdBy))]:[...i().sort((e,r)=>e.createdBy?.localeCompare(r.createdBy))]:[...i()]})})),S((o,n=c(b),i=c(N),d=c(p))=>({loadCategoriesById:C(l(g(300),w(t=>(t||(t="00000000-0000-0000-0000-000000000000"),i.getArchiveCategoriesByParentId(t).pipe(f({next:e=>{let r=t;t=="00000000-0000-0000-0000-000000000000"&&(r=""),a(o,{categories:[...e],documentResourceParameter:s(m({},o.documentResourceParameter()),{categoryId:r}),selectedCategoryId:r,isLoading:!1})},error:e=>{a(o,{commonError:e}),console.error(e)}})))))),loadByQuery:C(l(g(300),P(()=>a(o,{isLoading:!0})),h(t=>{if(t.categoryId||(t.categoryId="00000000-0000-0000-0000-000000000000"),!d.hasClaim("ALL_VIEW_DOCUMENTS")){a(o,{isLoading:!1,documents:[]});return}return n.getArchiveDocuments(t).pipe(f({next:e=>{if(e.headers.get("X-Pagination")){let r=e.headers,u=r.get("X-Pagination")?JSON.parse(r.get("X-Pagination")??"{}"):null,L=o.documentResourceParameter(),T=s(m({},L),{totalCount:u?.totalCount??0,pageSize:u?.pageSize??15,skip:u?.skip??0}),D=e.body?e.body:[],v=[...o.documents().filter(x=>D.findIndex(A=>A.id===x.id)===-1),...D];a(o,{documents:[...v],isLoading:!1,commonError:null,documentResourceParameter:m({},T)})}},error:e=>{a(o,{commonError:e,isLoading:!1})}}))}))),setLoadingFlag(t){a(o,{isLoading:t})},loadCategoriesBySelectedCategoryId(){this.loadCategoriesById(o.selectedCategoryId())},loadDocumentsByCategory(t){let e=s(m({},o.documentResourceParameter()),{skip:0,categoryId:t});this.loadByQuery(e)},setDocumentsEmpty(){a(o,{documents:[]})},setCategorysEmpty(){a(o,{categories:[]})},setDocumentResource(t){a(o,{documentResourceParameter:m({},t)})},loadDocuments(){o.selectedCategoryId()&&this.loadByQuery(o.documentResourceParameter())},addCategoryPath(t){t?a(o,{newCategoryPath:[...o.newCategoryPath(),t]}):a(o,{newCategoryPath:[]})},removeCategoryPath(t){if(!t)a(o,{newCategoryPath:[]});else{let e=o.newCategoryPath().findIndex(r=>r.id===t.id);if(e!==-1){let r=o.newCategoryPath().slice(0,e+1);a(o,{newCategoryPath:r})}}}})),R({onInit(o,n=c(p)){n.isUserAuthenticate()&&o.loadCategoriesById("")}}));export{_ as a};
