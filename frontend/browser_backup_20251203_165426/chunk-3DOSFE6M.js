import{a as Me}from"./chunk-XUA4LWIB.js";import{a as xe,b as Ie,c as Ue}from"./chunk-2JITEWKE.js";import{a as Te}from"./chunk-Q64ABPSN.js";import{b as ve}from"./chunk-ZEPKQIVA.js";import{p as Se}from"./chunk-32HAOKOZ.js";import{a as he,b as De}from"./chunk-55DV7QCW.js";import{a as Ce,b as Ee,c as ge}from"./chunk-SJIWHW3R.js";import{a as K}from"./chunk-ZXWR2MAY.js";import{a as ue,b as fe,c as _e}from"./chunk-GYIDN45C.js";import{a as pe,b as ce}from"./chunk-F2N2VWHU.js";import{d as de}from"./chunk-AHHITDV2.js";import{c as me}from"./chunk-PJSVLHWR.js";import{b as G,c as j,e as H,f as W}from"./chunk-2DXU6Z77.js";import{b as X}from"./chunk-WC3ZMFX5.js";import{b as Z}from"./chunk-UFOTACYY.js";import{e as se}from"./chunk-F3ENXN4Q.js";import{C as ae,E as le,c as ee,e as w,h as te,i as ie,o as ne,r as re,u as oe}from"./chunk-KYSGX4IW.js";import{a as Q,b as Y}from"./chunk-P6E4AR6Q.js";import{ta as q,va as $}from"./chunk-GDJX5AXE.js";import{$ as C,Ca as E,Da as g,Db as s,Eb as m,Fa as I,Ga as U,Ha as P,Ia as f,Ja as n,Ka as r,La as M,Pc as z,Rc as J,Sa as k,Ua as D,W as i,Wa as b,eb as x,ga as y,i as F,jb as a,ka as N,kb as S,lb as h,mb as B,nb as A,p as _,pb as V,q as v,qb as O,rb as L,vb as T}from"./chunk-KZMFGXDY.js";import{b as R}from"./chunk-W3TJXGK4.js";function be(o,c){if(o&1&&(n(0,"mat-chip",11),a(1),r()),o&2){let e=c.$implicit;i(),S(e.name)}}function ke(o,c){if(o&1&&(n(0,"span"),a(1),r()),o&2){let e=b();i(),A(" ",e.selectedUsers[0].firstName," ",e.selectedUsers[0].lastName," (",e.selectedUsers[0].userName,") ")}}function Ae(o,c){if(o&1&&(n(0,"span",15),a(1),r()),o&2){let e=b();i(),B(" (+",e.selectedUsers.length-1," ",e.selectedUsers.length===2?"other":"others",") ")}}function we(o,c){if(o&1&&(n(0,"mat-option",17),a(1),r()),o&2){let e=c.$implicit;f("value",e),i(),A(" ",e.firstName," ",e.lastName," (",e.userName,") ")}}function Re(o,c){if(o&1&&(n(0,"mat-option",19),a(1),r()),o&2){let e=c.$implicit;f("value",e.id),i(),h(" ",e.name," ")}}function Fe(o,c){o&1&&(n(0,"mat-error"),a(1),s(2,"translate"),r()),o&2&&(i(),h(" ",m(2,1,"START_DATE_IS_REQURED")," "))}function ye(o,c){o&1&&(n(0,"mat-error"),a(1),s(2,"translate"),r()),o&2&&(i(),h(" ",m(2,1,"END_DATE_IS_REQURED")," "))}function Ne(o,c){if(o&1){let e=k();n(0,"div",22)(1,"div",31)(2,"mat-label"),a(3),s(4,"translate"),r(),n(5,"div",32),M(6,"input",33),s(7,"translate"),n(8,"div",34)(9,"button",35),D("click",function(){_(e);let t=x(13);return v(t.open())}),n(10,"mat-icon",36),a(11,"calendar_today"),r()()(),M(12,"mat-datepicker",null,1),r(),E(14,Fe,3,3,"mat-error"),r(),n(15,"div",31)(16,"mat-label"),a(17),s(18,"translate"),r(),n(19,"div",32),M(20,"input",37),s(21,"translate"),n(22,"div",34)(23,"button",35),D("click",function(){_(e);let t=x(27);return v(t.open())}),n(24,"mat-icon",36),a(25,"calendar_today"),r()()(),M(26,"mat-datepicker",null,2),r(),E(28,ye,3,3,"mat-error"),r()()}if(o&2){let e,l,t,d=x(13),u=x(27),p=b();i(3),S(m(4,12,"CHOOSE_A_START_DATE")),i(3),f("placeholder",T(m(7,14,"START_DATE")))("min",p.minDate)("matDatepicker",d),i(8),g((e=p.permissionForm.get("startDate"))!=null&&e.touched&&(!((e=p.permissionForm.get("startDate"))==null||e.errors==null)&&e.errors.required)?14:-1),i(3),S(m(18,16,"CHOOSE_A_END_DATE")),i(3),f("placeholder",T(m(21,18,"END_DATE")))("min",(l=p.permissionForm.get("startDate"))==null?null:l.value)("matDatepicker",u),i(8),g((t=p.permissionForm.get("startDate"))!=null&&t.touched&&(!((t=p.permissionForm.get("endDate"))==null||t.errors==null)&&t.errors.required)?28:-1)}}function Be(o,c){o&1&&(n(0,"div",26),a(1),s(2,"translate"),r()),o&2&&(i(),h(" ",m(2,1,"PLEASE_CONFIGURE_EMAIL_SMTP_SETTINGS")," "))}var Pe=class o extends K{constructor(e,l,t,d,u,p){super();this.documentPermissionService=e;this.toastrService=l;this.commonService=t;this.data=d;this.dialogRef=u;this.fb=p}documentPermissions=[];documents;users=[];filteredUsers=[];selectedUsers=[];roles=[];permissionForm;subscriptions=new R;smtpConfigured=!1;minDate=new Date;userStore=F(Te);ngOnInit(){this.documents=this.data,this.filteredUsers=[...this.users],this.getRoles(),this.createFormGroup(),this.subscriptions.add(this.commonService.IsSmtpConfigured.subscribe(e=>{if(e==null){this.checkEmailSMTPSettings();return}this.smtpConfigured=e})),this.filteredUsers=[...this.userStore.users()]}createFormGroup(){this.permissionForm=this.fb.group({roles:[],users:[],isTimeBound:[!1],startDate:[],endDate:[],isAllowDownload:[!1],isAllowEmailNotification:[!1]})}filterUsers(e){let l=e.target?.value.trim().toLowerCase();if(!l){this.filteredUsers=[...this.userStore.users()];return}this.filteredUsers=this.users.filter(t=>t.firstName?.toLowerCase().includes(l)||t.lastName?.toLowerCase().includes(l)||t.email?.toLowerCase().includes(l)||t.userName?.toLowerCase().includes(l)),this.filteredUsers=Array.from(new Set([...this.selectedUsers,...this.filteredUsers]))}compareUsers=(e,l)=>e&&l&&e.id===l.id;timeBoundChange(e){e.checked?(this.permissionForm.get("startDate")?.setValidators([w.required]),this.permissionForm.get("endDate")?.setValidators([w.required]),this.permissionForm.get("endDate")?.updateValueAndValidity(),this.permissionForm.get("startDate")?.updateValueAndValidity()):(this.permissionForm.get("startDate")?.clearValidators(),this.permissionForm.get("endDate")?.clearValidators(),this.permissionForm.get("endDate")?.updateValueAndValidity(),this.permissionForm.get("startDate")?.updateValueAndValidity())}buildObject(){let e=this.permissionForm.get("users")?.value&&this.permissionForm.get("users")?.value.length>0?this.permissionForm.get("users")?.value.map(t=>t.id):[];return{roles:this.permissionForm.get("roles")?.value??[],users:e??[],isTimeBound:this.permissionForm.get("isTimeBound")?.value,startDate:this.permissionForm.get("startDate")?.value,endDate:this.permissionForm.get("endDate")?.value,isAllowDownload:this.permissionForm.get("isAllowDownload")?.value,documents:this.documents.map(t=>t.id).filter(t=>typeof t=="string"),isAllowEmailNotification:this.permissionForm.get("isAllowEmailNotification")?.value}}saveDocumentUserPermission(){if(!this.permissionForm.valid){this.permissionForm.markAllAsTouched();return}let e=this.buildObject();if(e.roles.length===0&&e.users.length===0){this.toastrService.error(this.translationService.getValue("PLEASE_SELECT_EITHER_ROLES_OR_USERS"));return}this.sub$.sink=this.documentPermissionService.multipleDocumentsToUsersAndRoles(e).subscribe(l=>{this.toastrService.success(this.translationService.getValue("DOCUMENTS_PERMISSION_ASSIGN_TO_USERS_AND_ROLES")),this.dialogRef.close("loaded")})}getRoles(){this.sub$.sink=this.commonService.getRoles().subscribe(e=>this.roles=e)}closeDialog(){this.dialogRef.close()}checkEmailSMTPSettings(){this.sub$.sink=this.commonService.checkEmailSMTPSetting().subscribe({next:e=>{e&&e?.data},error:e=>{this.toastrService.error(this.translationService.getValue("SMTP_SETTINGS_ERROR"))}})}static \u0275fac=function(l){return new(l||o)(C(Me),C(X),C(Z),C(j),C(G),C(ae))};static \u0275cmp=y({type:o,selectors:[["app-document-permission-multiple"]],features:[N],decls:68,vars:46,consts:[["input1",""],["startDatePicker",""],["endDatePicker",""],[1,"d-flex"],[1,"me-auto","p-2"],[1,"mb-3","page-title"],[3,"code"],[1,"d-flex","justify-content-end","mb-2"],[1,"close-icon","text-danger","cursor-pointer",3,"click"],[1,"row"],[1,"col-sm-12"],["color","primary",2,"overflow","hidden"],[1,"row","mt-2",3,"formGroup"],[1,"col-md-6"],["panelClass","mat-select-control","multiple","","formControlName","users",1,"form-control",3,"valueChange","placeholder","value"],[1,"example-additional-selection"],[1,"form-control",3,"keyup","placeholder"],["color","primary",3,"value"],["panelClass","mat-select-control","color","primary","formControlName","roles","multiple","",1,"form-control",3,"placeholder"],[3,"value"],[1,"col-md-12","col-sm-12","mt-1"],["color","primary","formControlName","isTimeBound",3,"change"],[1,"col-md-12","col-sm-12","row"],[1,"col-md-12"],["color","primary","formControlName","isAllowDownload"],["color","primary","formControlName","isAllowEmailNotification"],[1,"alert","alert-warning","mt-2"],[1,"col-12","d-flex","flex-column","flex-sm-row","gap-2","mt-2"],["matButton","filled","cdkFocusInitial","",1,"success","me-2",3,"click"],[1,"medium-icon"],["matButton","filled",1,"error",3,"click"],[1,"form-group","col-md-6","col-sm-12"],[1,"input-group"],["formControlName","startDate",1,"form-control",3,"placeholder","min","matDatepicker"],[1,"input-group-append"],["type","button",1,"btn","btn-primary","calendar-button",3,"click"],[1,"medium-icon","fs-6","align-middle"],["formControlName","endDate",1,"form-control",3,"placeholder","min","matDatepicker"]],template:function(l,t){if(l&1){let d=k();n(0,"mat-dialog-content")(1,"div",3)(2,"div",4)(3,"span",5),a(4),s(5,"translate"),M(6,"app-page-help-text",6),r()(),n(7,"div",7)(8,"mat-icon",8),D("click",function(){return _(d),v(t.closeDialog())}),a(9,"cancel"),r()()(),n(10,"div",9)(11,"div",10)(12,"h5"),a(13),s(14,"translate"),r()()(),n(15,"div",9)(16,"div",10)(17,"mat-chip-set"),U(18,be,2,1,"mat-chip",11,I),r()()(),n(20,"form",12)(21,"div",13)(22,"mat-label"),a(23),s(24,"translate"),r(),n(25,"mat-select",14),s(26,"translate"),L("valueChange",function(p){return _(d),O(t.selectedUsers,p)||(t.selectedUsers=p),v(p)}),n(27,"mat-select-trigger"),E(28,ke,2,3,"span"),E(29,Ae,2,2,"span",15),r(),n(30,"input",16,0),s(32,"translate"),D("keyup",function(p){return _(d),v(t.filterUsers(p))}),r(),U(33,we,2,4,"mat-option",17,I),r()(),n(35,"div",13)(36,"mat-label"),a(37),s(38,"translate"),r(),n(39,"mat-select",18),s(40,"translate"),U(41,Re,2,2,"mat-option",19,I),r()(),n(43,"div",20)(44,"mat-checkbox",21),D("change",function(p){return _(d),v(t.timeBoundChange(p))}),a(45),s(46,"translate"),r()(),E(47,Ne,29,20,"div",22),n(48,"div",23)(49,"mat-checkbox",24),a(50),s(51,"translate"),r()(),n(52,"div",23)(53,"mat-checkbox",25),a(54),s(55,"translate"),r()(),E(56,Be,3,3,"div",26),n(57,"div",27)(58,"button",28),D("click",function(){return _(d),v(t.saveDocumentUserPermission())}),n(59,"mat-icon",29),a(60,"save"),r(),a(61),s(62,"translate"),r(),n(63,"button",30),D("click",function(){return _(d),v(t.closeDialog())}),n(64,"mat-icon",29),a(65,"cancel"),r(),a(66),s(67,"translate"),r()()()()}if(l&2){let d,u;i(4),h(" ",m(5,22,"SHARE_DOCUMENT")," "),i(2),f("code","SHARE_DOCUMENT"),i(7),S(m(14,24,"SELECTED_DOCUMENTS")),i(5),P(t.documents),i(2),f("formGroup",t.permissionForm),i(3),S(m(24,26,"USERS")),i(2),f("placeholder",T(m(26,28,"SELECT_USERS"))),V("value",t.selectedUsers),i(3),g(t.selectedUsers.length>0?28:-1),i(),g(t.selectedUsers.length>1?29:-1),i(),f("placeholder",T(m(32,30,"SEARCH_BY_USER_ROLE_NAME_AND_EMAIL"))),i(3),P(t.filteredUsers),i(4),S(m(38,32,"ROLES")),i(2),f("placeholder",T(m(40,34,"SELECT_ROLES"))),i(2),P(t.roles),i(4),h(" ",m(46,36,"SPACIFY_THE_PERIOD")," "),i(2),g((d=t.permissionForm.get("isTimeBound"))!=null&&d.value?47:-1),i(3),S(m(51,38,"ALLOW_DOWNLOAD")),i(4),S(m(55,40,"IS_ALLOW_NOTIFICATION")),i(2),g((u=t.permissionForm.get("isAllowEmailNotification"))!=null&&u.value&&!t.smtpConfigured?56:-1),i(5),h(" ",m(62,42,"SAVE")," "),i(5),h(" ",m(67,44,"CANCEL")," ")}},dependencies:[Se,ve,W,H,me,Y,Q,Ue,xe,Ie,J,_e,pe,ce,ue,fe,de,De,he,ge,Ce,Ee,le,ne,ee,te,ie,re,oe,se,$,q,z],encapsulation:2})};export{Pe as a};
