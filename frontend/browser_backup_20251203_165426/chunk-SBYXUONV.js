import{a as N}from"./chunk-3VFDPVPY.js";import{a as L}from"./chunk-NHBDANCD.js";import{a as C,b as a,c as B,d as I,e as R,f as S,g as b,h as D}from"./chunk-OHUA35YV.js";import{a as f}from"./chunk-RKRBEXQJ.js";import{Ob as p,i as s}from"./chunk-KZMFGXDY.js";import{Pa as l,Ub as g,W as P,_b as y,h as u}from"./chunk-W3TJXGK4.js";import{a as m,b as c}from"./chunk-H5HZ6YB3.js";var A={documents:[],isLoading:!1,categories:[],selectedCategoryId:"",newCategoryPath:[],documentResourceParameter:{id:"",createdBy:"",categoryId:"",documentStatusId:"",storageSettingId:"",clientId:"",createDate:void 0,fields:"",orderBy:"createdDate desc",searchQuery:"",pageSize:15,skip:0,name:"",totalCount:0,metaTags:"",documentNumber:""},commonError:null},O=B({providedIn:"root"},b(A),I(({documentResourceParameter:o,categories:n,documents:i})=>({sortedCategories:p(()=>{if(!n()||n().length===0)return[];let r=o().orderBy.split(" ");return r[0]==="name"?r[1]==="asc"?[...n().sort((e,t)=>t.name.localeCompare(e.name))]:[...n().sort((e,t)=>e.name.localeCompare(t.name))]:r[0]==="createdDate"?r[1]==="asc"?[...n().sort((e,t)=>new Date(e.createdDate).getTime()-new Date(t.createdDate).getTime())]:[...n().sort((e,t)=>new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime())]:r[0]==="createdBy"?r[1]==="asc"?[...n().sort((e,t)=>t.createdUserName?.localeCompare(e.createdUserName??"")??0)]:[...n().sort((e,t)=>e.createdUserName?.localeCompare(t.createdUserName??"")??0)]:[...n()]}),sortedDocuments:p(()=>{if(!i()||i().length===0)return[];let r=o().orderBy.split(" ");return r[0]==="createdDate"?r[1]==="asc"?[...i().sort((e,t)=>new Date(e?.createdDate??new Date).getTime()-new Date(t?.createdDate??new Date).getTime())]:[...i().sort((e,t)=>new Date(t?.createdDate??new Date).getTime()-new Date(e?.createdDate??new Date).getTime())]:r[0]==="name"?r[1]==="asc"?[...i().sort((e,t)=>t.name?.localeCompare(e.name??"")??0)]:[...i().sort((e,t)=>e.name?.localeCompare(t.name??"")??0)]:r[0]==="documentNumber"?r[1]==="asc"?[...i().sort((e,t)=>t.documentNumber?.localeCompare(e.documentNumber??"")??0)]:[...i().sort((e,t)=>e.documentNumber?.localeCompare(t.documentNumber??"")??0)]:r[0]==="createdBy"?r[1]==="asc"?[...i().sort((e,t)=>t.createdBy?.localeCompare(e.createdBy??"")??0)]:[...i().sort((e,t)=>e.createdBy?.localeCompare(t.createdBy??"")??0)]:[...i()]})})),S((o,n=s(N),i=s(L),w=s(f))=>({loadCategoriesById:D(u(l(300),y(()=>a(o,{isLoading:!0})),g(r=>(r||(r="00000000-0000-0000-0000-000000000000"),i.getCategoriesSharedByParentId(r).pipe(C({next:e=>{let t=r;r=="00000000-0000-0000-0000-000000000000"&&(t=""),a(o,{categories:[...e],isLoading:!1,documentResourceParameter:c(m({},o.documentResourceParameter()),{categoryId:t}),selectedCategoryId:t})},error:e=>{a(o,{commonError:e,isLoading:!1}),console.error(e)}})))))),loadByQuery:D(u(l(300),y(()=>a(o,{isLoading:!0})),P(r=>(r.categoryId||(r.categoryId="00000000-0000-0000-0000-000000000000"),r)),g(r=>n.getDocuments(r).pipe(C({next:e=>{if(e.headers.get("X-Pagination")){let t=e.headers,d=t.get("X-Pagination")?JSON.parse(t.get("X-Pagination")??"[]"):null,E=o.documentResourceParameter(),T=c(m({},E),{totalCount:d?.totalCount??0,pageSize:d?.pageSize??0,skip:d?.skip??0}),h=e.body?e.body:[],x=[...o.documents().filter(k=>h.findIndex(v=>v.id===k.id)===-1),...h];a(o,{documents:[...x],isLoading:!1,commonError:null,documentResourceParameter:m({},T)})}},error:e=>{a(o,{commonError:e,isLoading:!1})}}))))),setLoadingFlag(r){a(o,{isLoading:r})},loadCategoriesBySelectedCategoryId(){this.loadCategoriesById(o.selectedCategoryId())},loadDocumentsByCategory(r){let e=c(m({},o.documentResourceParameter()),{skip:0,categoryId:r});this.loadByQuery(e)},setDocumentsEmpty(){a(o,{documents:[]})},addCategoryPath(r){r?a(o,{newCategoryPath:[...o.newCategoryPath(),r]}):a(o,{newCategoryPath:[]})},removeCategoryPath(r){if(!r)a(o,{newCategoryPath:[]});else{let e=o.newCategoryPath().findIndex(t=>t.id===r.id);if(e!==-1){let t=o.newCategoryPath().slice(0,e+1);a(o,{newCategoryPath:t})}}},setDocumentResource(r){a(o,{documentResourceParameter:m({},r)})},loadDocuments(){o.selectedCategoryId()&&this.loadByQuery(o.documentResourceParameter())}})),R({onInit(o,n=s(f)){n.isUserAuthenticate()&&o.loadCategoriesById("")}}));export{O as a};
