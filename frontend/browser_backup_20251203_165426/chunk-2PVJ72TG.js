import{a as z}from"./chunk-E4NKSOB7.js";import{a as Q}from"./chunk-NHBDANCD.js";import{a as se}from"./chunk-NUIAS2S4.js";import{b as de}from"./chunk-BEIMTKK4.js";import{a as U}from"./chunk-ZXWR2MAY.js";import{a as ce,b as ge,c as fe}from"./chunk-GYIDN45C.js";import{d as pe}from"./chunk-AHHITDV2.js";import{c as me}from"./chunk-PJSVLHWR.js";import{a as J}from"./chunk-546GNQSA.js";import{b as G,c as L,e as k,f as w}from"./chunk-2DXU6Z77.js";import{a as H}from"./chunk-C3OPHOKD.js";import{e as le}from"./chunk-F3ENXN4Q.js";import{B as oe,D as ne,E as re,c as K,e as W,h as X,i as Z,o as ee,r as te,u as ie,z as ae}from"./chunk-KYSGX4IW.js";import{k as O}from"./chunk-BFSIXXTJ.js";import{a as P,b as Y}from"./chunk-P6E4AR6Q.js";import{ta as V,va as j}from"./chunk-GDJX5AXE.js";import{$ as u,Ab as R,Ca as h,Da as S,Db as m,Ea as F,Eb as d,F as I,Ga as N,Ha as B,Ia as c,Ja as o,Ka as a,La as E,Pc as q,Rc as $,Ua as C,W as n,Wa as v,ga as M,i as x,jb as l,ka as b,kb as y,lb as s,ma as T,pc as D,vb as A}from"./chunk-KZMFGXDY.js";import{a as _}from"./chunk-H5HZ6YB3.js";var Ce=r=>({"margin-left.px":r});function ve(r,f){if(r&1&&(o(0,"div",11)(1,"mat-icon",12),l(2,"folder"),a(),o(3,"b"),l(4),a()()),r&2){let e=v().$implicit;n(4),y(e.name)}}function ye(r,f){if(r&1&&(o(0,"div",24)(1,"mat-icon",12),l(2,"folder"),a(),l(3),a()),r&2){let e=v().$implicit;c("matTooltip",e.name),n(3),s(" ",e.name," ")}}function he(r,f){if(r&1&&(o(0,"mat-option",13)(1,"div",23),h(2,ve,5,1,"div",11)(3,ye,4,2,"div",24),a()()),r&2){let e=f.$implicit;c("value",e.id),n(),c("ngStyle",R(3,Ce,(e.deafLevel??0)*20)),n(),S(e.deafLevel==0?2:3)}}function Se(r,f){r&1&&(o(0,"div",16),l(1),m(2,"translate"),a()),r&2&&(n(),s(" ",d(2,1,"CATEGORY_NAME_IS_REQUIRED")," "))}function Ee(r,f){if(r&1&&(o(0,"button",25)(1,"mat-icon",22),l(2,"save"),a(),l(3),m(4,"translate"),m(5,"translate"),a()),r&2){let e=v();n(3),s(" ",e.isEdit?d(4,1,"UPDATE"):d(5,3,"CREATE")," ")}}var ue=class r extends U{constructor(e,i,t,p,g){super();this.dialogRef=e;this.data=i;this.categoryService=t;this.clonerService=p;this.fb=g}isEdit=!1;categories=[];allCategories=[];categoryForm;foldersViewStore=x(z);ngOnInit(){this.data&&this.data.id&&(this.isEdit=!0),this.createForm(),this.sub$.sink=this.categoryService.getAllCategories(!0).subscribe(e=>{this.categories=e,this.categories.filter(t=>t.parentId==null).forEach((t,p)=>{this.data?.id!=t.id&&(t.deafLevel=0,t.index=p*Math.pow(.1,t.deafLevel),t.displayName=t.name,this.allCategories.push(t),this.setDeafLevel(t))}),this.allCategories=this.clonerService.deepClone(this.allCategories)})}createForm(){this.categoryForm=this.fb.group({id:[this.data?.id],name:[this.data?.name,[W.required]],description:[this.data?.description],parentId:[{value:this.data?.parentId?this.data?.parentId:"",disabled:!!this.data?.id}]})}getCategoryNameById(e){return this.allCategories?.find(t=>t.id===e)?.name||""}ngOnChanges(e){e.data&&this.data.id&&(this.isEdit=!0)}setDeafLevel(e){return e?.children&&e.children.length>0&&e.children.map((i,t)=>{i.displayName=e.displayName+" > "+i.name,i.deafLevel=e?(e.deafLevel??0)+1:0,i.index=e?(e.index??0)+t*Math.pow(.1,i.deafLevel):0,this.allCategories.push(i),this.setDeafLevel(i)}),e}onCancel(){this.dialogRef.close()}saveCategory(){if(this.categoryForm.valid){this.categoryForm.get("parentId")?.enable({emitEvent:!1});let e=_({},this.categoryForm.value);this.data?.id&&this.categoryForm.get("parentId")?.disable({emitEvent:!1}),e.id?this.categoryService.update(e).subscribe({next:i=>{e.parentId==this.foldersViewStore.selectedCategoryId()&&this.foldersViewStore.loadCategoriesBySelectedCategoryId(),this.dialogRef.close(i)},error:i=>{console.log(i)}}):this.categoryService.add(e).subscribe({next:i=>{e.parentId==this.foldersViewStore.selectedCategoryId()&&this.foldersViewStore.loadCategoriesBySelectedCategoryId(),this.dialogRef.close(i)},error:i=>{console.log(i)}})}else this.categoryForm.markAllAsTouched()}static \u0275fac=function(i){return new(i||r)(u(G),u(L),u(Q),u(H),u(oe))};static \u0275cmp=M({type:r,selectors:[["app-manage-category"]],features:[b,I],decls:49,vars:29,consts:[[1,"d-flex"],[1,"me-auto","p-2"],[1,"mb-3","page-title"],[3,"code"],[1,"d-flex","justify-content-end","mb-2"],[1,"close-icon","text-danger","cursor-pointer",3,"click"],["name","form","novalidate","",3,"ngSubmit","formGroup"],[1,"row","gy-3"],[1,"col-sm-12"],["for","category",1,"form-label"],["panelClass","mat-select-control","formControlName","parentId",1,"form-control",3,"placeholder"],[1,"d-flex","align-items-center"],[1,"text-warning","me-1"],[3,"value"],["for","categoryName",1,"form-label"],["required","","formControlName","name","type","text","name","name","id","categoryName",1,"form-control"],[1,"text-danger"],["for","description",1,"form-label"],["formControlName","description","name","description","type","text",1,"form-control"],[1,"col-md-12","mt-2"],["type","submit","class","success me-1","matButton","filled","cdkFocusInitial","",4,"hasClaim"],["type","button","matButton","filled",1,"error",3,"click"],[1,"medium-icon"],[1,"country-item",3,"ngStyle"],[1,"d-flex","align-items-center",3,"matTooltip"],["type","submit","matButton","filled","cdkFocusInitial","",1,"success","me-1"]],template:function(i,t){if(i&1&&(o(0,"mat-dialog-content")(1,"div",0)(2,"div",1)(3,"span",2),l(4),m(5,"translate"),E(6,"app-page-help-text",3),a()(),o(7,"div",4)(8,"mat-icon",5),C("click",function(){return t.onCancel()}),l(9,"cancel"),a()()(),o(10,"form",6),C("ngSubmit",function(){return t.saveCategory()}),o(11,"div",7)(12,"div",8)(13,"label",9),l(14),m(15,"translate"),a(),o(16,"mat-select",10),m(17,"translate"),o(18,"mat-select-trigger")(19,"div",11)(20,"mat-icon",12),l(21,"folder"),a(),o(22,"span"),l(23),m(24,"translate"),a()()(),o(25,"mat-option",13),l(26),m(27,"translate"),a(),N(28,he,4,5,"mat-option",13,F),a()(),o(30,"div",8)(31,"label",14),l(32),m(33,"translate"),a(),E(34,"input",15),h(35,Se,3,3,"div",16),a(),o(36,"div",8)(37,"label",17),l(38),m(39,"translate"),a(),o(40,"textarea",18),l(41,"        "),a()(),o(42,"div",19),T(43,Ee,6,5,"button",20),o(44,"button",21),C("click",function(){return t.onCancel()}),o(45,"mat-icon",22),l(46,"cancel"),a(),l(47),m(48,"translate"),a()()()()()),i&2){let p,g;n(4),s(" ",d(5,13,"MANAGE_CATEGORY")," "),n(2),c("code","DOCUMENT_CATEGORIES"),n(4),c("formGroup",t.categoryForm),n(4),s(" ",d(15,15,"PARENT_CATEGORY")," "),n(2),c("placeholder",A(d(17,17,"SELECT_CATEGORY"))),n(7),s(" ",t.getCategoryNameById((p=t.categoryForm.get("parentId"))==null?null:p.value)||d(24,19,"NONE")," "),n(3),s(" -- ",d(27,21,"NONE")," -- "),n(2),B(t.allCategories),n(4),y(d(33,23,"NAME")),n(3),S((g=t.categoryForm.get("name"))!=null&&g.touched&&((g=t.categoryForm.get("name"))!=null&&g.errors)&&((g=t.categoryForm.get("name"))!=null&&g.hasError("required"))?35:-1),n(3),y(d(39,25,"DESCRIPTION")),n(5),c("hasClaim","CREATE_CATEGORY"),n(4),s(" ",d(48,27,"CANCEL")," ")}},dependencies:[ne,ee,K,X,Z,ae,$,O,j,V,re,te,ie,fe,ce,ge,pe,se,de,w,k,me,J,le,Y,P,D,q],encapsulation:2})};export{ue as a};
