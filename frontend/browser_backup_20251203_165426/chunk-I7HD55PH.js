import"./chunk-VN3CQEPZ.js";import{a as ii}from"./chunk-5NB3GHSG.js";import{a as Ut,b as Yt,c as Qt,d as jt,e as Gt}from"./chunk-JNQ3VMDY.js";import"./chunk-MHTWOIH5.js";import{a as q,b as Ct,c as St}from"./chunk-PJWKAJON.js";import{a as z,b as gt}from"./chunk-ZEPKQIVA.js";import{a as vt,b as Dt,c as yt,d as Et,e as Tt,f as bt,g as xt,h as wt,i as It,j as kt,k as Rt,l as At,m as Mt,n as Vt,o as Bt,p as Nt}from"./chunk-32HAOKOZ.js";import{a as Kt}from"./chunk-JUFSZQR3.js";import{b as zt}from"./chunk-RSOKOSFJ.js";import{a as Xt}from"./chunk-47YH7K5Q.js";import{a as ei}from"./chunk-C5E2LXAD.js";import{b as Ht}from"./chunk-ZBYQRGLJ.js";import{b as Pt}from"./chunk-D63AZ2OX.js";import{a as qt}from"./chunk-FYSR42NU.js";import"./chunk-W6Y3OYFO.js";import{a as Wt}from"./chunk-DP5AXSVW.js";import{a as ti}from"./chunk-MUB3U2II.js";import{b as Ye}from"./chunk-6KAVZYIE.js";import{a as Ie,b as ke,c as Re,d as Ae}from"./chunk-AO6AHHEQ.js";import{a as He}from"./chunk-XCFLXYBY.js";import{a as Zt}from"./chunk-DBWWD6JI.js";import"./chunk-E4NKSOB7.js";import{a as Pe}from"./chunk-NHBDANCD.js";import"./chunk-D6HICPES.js";import"./chunk-KK3LA7D5.js";import"./chunk-PVDG46DZ.js";import{a as mt}from"./chunk-NUIAS2S4.js";import{b as We}from"./chunk-ZPADZQPI.js";import"./chunk-I43MH25B.js";import"./chunk-OHUA35YV.js";import{c as ot}from"./chunk-2OJALU77.js";import{a as nt}from"./chunk-BJ2ZHXLF.js";import{a as Le}from"./chunk-APWCXNU6.js";import{a as G}from"./chunk-6GBRFDEJ.js";import{a as Jt}from"./chunk-KCPEL47F.js";import"./chunk-KBYUC6BL.js";import"./chunk-7UZYWCAJ.js";import{b as Ot}from"./chunk-55DV7QCW.js";import{a as Ft,b as Lt,c as $t}from"./chunk-SJIWHW3R.js";import"./chunk-ZL3HBFEV.js";import"./chunk-PT2JM3JA.js";import"./chunk-4U6IWAJM.js";import"./chunk-73AGG5TT.js";import{b as st}from"./chunk-BEIMTKK4.js";import{a as Qe,b as je}from"./chunk-YCBFVA3Y.js";import{a as Be}from"./chunk-ZXWR2MAY.js";import"./chunk-G4LST2RF.js";import"./chunk-NJY6F3LT.js";import{a as ht,b as _t,c as ft}from"./chunk-GYIDN45C.js";import{a as pt}from"./chunk-G5E2PA5H.js";import{c as dt}from"./chunk-DXL7FQB3.js";import"./chunk-F2N2VWHU.js";import{d as ut}from"./chunk-AHHITDV2.js";import"./chunk-QPRQJRAS.js";import{c as ct}from"./chunk-PJSVLHWR.js";import{a as Ue}from"./chunk-546GNQSA.js";import{d as De,f as ye}from"./chunk-2DXU6Z77.js";import{b as Fe}from"./chunk-WC3ZMFX5.js";import{b as $e}from"./chunk-UFOTACYY.js";import{a as Oe}from"./chunk-RKRBEXQJ.js";import{a as Ne}from"./chunk-C3OPHOKD.js";import{a as at,b as rt,e as lt}from"./chunk-F3ENXN4Q.js";import{B as et,D as tt,E as it,c as Ge,h as ze,i as qe,n as Ke,o as Je,r as Xe,u as Ze}from"./chunk-KYSGX4IW.js";import"./chunk-LCPYESOB.js";import"./chunk-BFSIXXTJ.js";import{a as xe,b as we}from"./chunk-P6E4AR6Q.js";import{D as Se,ca as ve,ta as Ee,u as Ce,ua as Te,va as be}from"./chunk-GDJX5AXE.js";import{$ as D,$a as L,A as se,Ab as M,Bb as he,Ca as I,Da as k,Db as d,Ea as pe,Eb as h,Ec as ge,Fb as U,Ga as R,Ha as A,Ia as p,Ja as r,Ka as a,La as b,Pa as y,Pc as Me,Qa as E,Rc as Ve,Sa as T,Ua as S,W as n,Wa as C,_a as F,ab as $,eb as x,ga as me,i as O,jb as s,ka as de,kb as B,kc as _e,lb as u,ma as v,p as f,pb as W,pc as fe,q as g,qb as P,rb as H,vb as w,za as ue,zb as j}from"./chunk-KZMFGXDY.js";import{I as J,Ja as ce,Pa as Z,Ya as ee,_ as ae,_b as Q,fa as X,la as re,za as le}from"./chunk-W3TJXGK4.js";import{p as K}from"./chunk-H5HZ6YB3.js";var ri=["input"],li=["metatag"],ni=t=>({display:t}),ci=()=>["","asc"],si=t=>({"grid-height-small":t}),mi=t=>({"margin-left.px":t}),ai=t=>({color:t}),di=()=>["CREATE_SHAREABLE_LINK","RESTORE_DOCUMENT","DOWNLOAD_DOCUMENT","VIEW_VERSION_HISTORY","SEND_EMAIL","DELETE_DOCUMENT"],ui=(t,c)=>({"link-success":t,"link-danger":c}),pi=()=>[10,20,30,50],Y=(t,c)=>c.id;function hi(t,c){if(t&1&&(r(0,"div",72)(1,"mat-icon",74),s(2,"folder"),a(),r(3,"b"),s(4),a()()),t&2){let e=C().$implicit;n(4),B(e.name)}}function _i(t,c){if(t&1&&(r(0,"div",73)(1,"mat-icon",74),s(2,"folder"),a(),s(3),a()),t&2){let e=C().$implicit;p("matTooltip",e.name),n(3),u(" ",e.name," ")}}function fi(t,c){if(t&1&&(r(0,"mat-option",26)(1,"div",71),I(2,hi,5,1,"div",72)(3,_i,4,2,"div",73),a()()),t&2){let e=c.$implicit;p("value",e),n(),p("ngStyle",M(3,mi,(e.deafLevel??0)*20)),n(),k(e.deafLevel==0?2:3)}}function gi(t,c){if(t&1&&(r(0,"mat-option",26)(1,"span",75),s(2),a()()),t&2){let e=c.$implicit;p("value",e),n(),p("ngStyle",M(3,ai,e==null?null:e.colorCode)),n(),B(e.name)}}function Ci(t,c){if(t&1&&(r(0,"mat-option",26)(1,"span"),s(2),a()()),t&2){let e=c.$implicit;p("value",e),n(2),u(" ",e.companyName," ")}}function Si(t,c){if(t&1&&(r(0,"mat-option",26),s(1),d(2,"storageType"),a()),t&2){let e=c.$implicit;p("value",e),n(),u(" ",U(2,2,e.storageType,e.name)," ")}}function vi(t,c){if(t&1&&(r(0,"mat-option",26)(1,"span"),s(2),a()()),t&2){let e=c.$implicit;p("value",e),n(2),u(" ",e.name," ")}}function Di(t,c){t&1&&(r(0,"div",40),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"END_DATE_IS_REQUIRED_WHEN_START_DATE_IS_SELECTED")," "))}function yi(t,c){t&1&&(r(0,"th",76),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"ACTION")," "))}function Ei(t,c){if(t&1&&(r(0,"button",84)(1,"mat-icon"),s(2,"more_vert"),a()()),t&2){C();let e=x(3);p("matMenuTriggerFor",e),ue("aria-label","Action")}}function Ti(t,c){if(t&1){let e=T();r(0,"button",80),S("click",function(){f(e);let i=C().$implicit,l=C();return g(l.onCreateShareableLink(i))}),r(1,"mat-icon"),s(2,"link"),a(),s(3),d(4,"translate"),a()}t&2&&(n(3),u(" ",h(4,1,"GET_SHAREABLE_LINK")," "))}function bi(t,c){if(t&1){let e=T();r(0,"button",80),S("click",function(){f(e);let i=C().$implicit,l=C();return g(l.restoreDocument(i))}),r(1,"mat-icon"),s(2,"restore_from_trash"),a(),s(3),d(4,"translate"),a()}t&2&&(n(3),u(" ",h(4,1,"RESTORE")," "))}function xi(t,c){if(t&1){let e=T();r(0,"button",80),S("click",function(){f(e);let i=C().$implicit,l=C();return g(l.downloadDocument(i))}),r(1,"mat-icon"),s(2,"download"),a(),s(3),d(4,"translate"),a()}t&2&&(n(3),u(" ",h(4,1,"DOWNLOAD")," "))}function wi(t,c){if(t&1){let e=T();r(0,"button",85),S("click",function(){f(e);let i=C().$implicit,l=C();return g(l.onVersionHistoryClick(i))}),r(1,"mat-icon"),s(2," history"),a(),s(3),d(4,"translate"),a()}t&2&&(n(3),u(" ",h(4,1,"VERSION_HISOTRY")," "))}function Ii(t,c){if(t&1){let e=T();r(0,"button",80),S("click",function(){f(e);let i=C().$implicit,l=C();return g(l.sendEmail(i))}),r(1,"mat-icon"),s(2,"forward_to_inbox"),a(),s(3),d(4,"translate"),a()}t&2&&(n(3),u(" ",h(4,1,"SEND_EMAIL")," "))}function ki(t,c){if(t&1){let e=T();r(0,"button",86),S("click",function(){f(e);let i=C().$implicit,l=C();return g(l.deleteDocument(i))}),r(1,"mat-icon"),s(2,"delete"),a(),s(3),d(4,"translate"),a()}t&2&&(n(3),u(" ",h(4,1,"DELETE")," "))}function Ri(t,c){if(t&1){let e=T();r(0,"td",77),v(1,Ei,3,2,"button",78),r(2,"mat-menu",null,8),v(4,Ti,5,3,"button",79),r(5,"button",80),S("click",function(){let i=f(e).$implicit,l=C();return g(l.onDocumentView(i))}),r(6,"mat-icon"),s(7,"visibility"),a(),s(8),d(9,"translate"),a(),v(10,bi,5,3,"button",81)(11,xi,5,3,"button",81)(12,wi,5,3,"button",82)(13,Ii,5,3,"button",81)(14,ki,5,3,"button",83),a()()}t&2&&(n(),p("hasClaim",j(10,di)),n(3),p("hasClaim","CREATE_SHAREABLE_LINK"),n(4),u(" ",h(9,8,"VIEW")," "),n(2),p("hasClaim","RESTORE_DOCUMENT"),n(),p("hasClaim","DOWNLOAD_DOCUMENT"),n(),p("hasClaim","VIEW_VERSION_HISTORY"),n(),p("hasClaim","SEND_EMAIL"),n(),p("hasClaim","DELETE_DOCUMENT"))}function Ai(t,c){t&1&&(r(0,"th",87),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"WORKFLOW")," "))}function Mi(t,c){if(t&1){let e=T();r(0,"a",90),S("click",function(){let i=f(e).$implicit,l=C(3);return g(l.viewVisualWorkflow(i))}),s(1),a()}if(t&2){let e=c.$implicit,o=c.$index,i=C(2).$implicit;p("ngClass",he(2,ui,e.workflowInstaceStatus==2,e.workflowInstaceStatus==3)),n(),u("",i.workflowsDetail[o].workflowName," ")}}function Vi(t,c){if(t&1&&(r(0,"div",88),R(1,Mi,2,5,"a",89,pe),a()),t&2){let e=C().$implicit;n(),A(e.workflowsDetail)}}function Bi(t,c){if(t&1&&(r(0,"td",77),I(1,Vi,3,0,"div",88),a()),t&2){let e=c.$implicit;n(),k(e.workflowsDetail&&e.workflowsDetail.length>0?1:-1)}}function Ni(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"DOCUMENT_NO")," "))}function Oi(t,c){if(t&1){let e=T();r(0,"td",77)(1,"a",92),S("click",function(){let i=f(e).$implicit,l=C();return g(l.onDocumentView(i))}),s(2),a()()}if(t&2){let e=c.$implicit;n(2),B(e.documentNumber)}}function Fi(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"NAME")," "))}function Li(t,c){if(t&1){let e=T();r(0,"td",77)(1,"a",92),S("click",function(){let i=f(e).$implicit,l=C();return g(l.onDocumentView(i))}),s(2),a()()}if(t&2){let e=c.$implicit;n(2),B(e.name)}}function $i(t,c){t&1&&(r(0,"th",87),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"ISSIGN")," "))}function Wi(t,c){if(t&1&&(r(0,"span",93)(1,"mat-icon",33),s(2,"check"),a()(),s(3)),t&2){let e=C().$implicit;n(3),u(" ",e.signBy," ")}}function Pi(t,c){if(t&1&&(r(0,"td",77),I(1,Wi,4,1),a()),t&2){let e=c.$implicit;n(),k(e.isSignatureExists?1:-1)}}function Hi(t,c){t&1&&(r(0,"th",87),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"SIGNDATE")," "))}function Ui(t,c){if(t&1&&(s(0),d(1,"utcToLocalTime")),t&2){let e=C().$implicit;u(" ",U(1,1,e==null?null:e.signByDate,"short")," ")}}function Yi(t,c){if(t&1&&(r(0,"td",77),I(1,Ui,2,4),a()),t&2){let e=c.$implicit;n(),k(e.signByDate&&e.isSignatureExists?1:-1)}}function Qi(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"CATEGORY")," "))}function ji(t,c){if(t&1&&(r(0,"td",77),s(1),a()),t&2){let e=c.$implicit;n(),u(" ",e.categoryName," ")}}function Gi(t,c){t&1&&(r(0,"th",94),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"CLIENT")," "))}function zi(t,c){if(t&1&&(r(0,"td",95),s(1),a()),t&2){let e=c.$implicit;n(),u(" ",e.client==null?null:e.client.companyName," ")}}function qi(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"STATUS")," "))}function Ki(t,c){if(t&1&&(r(0,"td",96),s(1),a()),t&2){let e=c.$implicit;p("ngStyle",M(2,ai,e.documentStatus==null?null:e.documentStatus.colorCode)),n(),u(" ",e.documentStatus==null?null:e.documentStatus.name," ")}}function Ji(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"STORAGE")," "))}function Xi(t,c){if(t&1&&(r(0,"td",77),s(1),d(2,"storageType"),a()),t&2){let e=c.$implicit;n(),u(" ",U(2,1,e.storageType,e.storageSettingName)," ")}}function Zi(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"CREATED_DATE")," "))}function en(t,c){if(t&1&&(r(0,"td",77),s(1),d(2,"utcToLocalTime"),a()),t&2){let e=c.$implicit;n(),u(" ",U(2,1,e==null?null:e.createdDate,"shortDate")," ")}}function tn(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"CREATED_BY")," "))}function nn(t,c){if(t&1&&(r(0,"td",77),s(1),a()),t&2){let e=c.$implicit;n(),u(" ",e==null?null:e.createdBy," ")}}function on(t,c){t&1&&(r(0,"th",91),s(1),d(2,"translate"),a()),t&2&&(n(),u(" ",h(2,1,"ARCHIVE_BY")," "))}function an(t,c){if(t&1&&(r(0,"td",77),s(1),a()),t&2){let e=c.$implicit;n(),u(" ",e==null?null:e.archiveName," ")}}function rn(t,c){if(t&1&&(r(0,"td",97),b(1,"mat-paginator",98),a()),t&2){let e=C(),o=e.documentStore.documentResourceParameter().skip/e.documentStore.documentResourceParameter().pageSize;n(),p("length",e.documentStore.documentResourceParameter().totalCount)("pageSize",e.documentStore.documentResourceParameter().pageSize)("pageIndex",o)("pageSizeOptions",j(4,pi))}}function ln(t,c){t&1&&(r(0,"tr")(1,"td",99)(2,"div",100)(3,"b"),s(4),d(5,"translate"),a()()()()),t&2&&(n(4),u(" ",h(5,1,"NO_DATA_FOUND")))}function cn(t,c){t&1&&b(0,"tr",101)}function sn(t,c){t&1&&b(0,"tr",102)}function mn(t,c){t&1&&b(0,"tr",103)}function dn(t,c){t&1&&(r(0,"div",70),b(1,"mat-progress-spinner",104),a())}var oi=class t extends Be{constructor(e,o,i,l,_,m,V,N,te,ie,ne,oe,un,pn,hn,_n){super();this.fb=e;this.documentService=o;this.commonDialogService=i;this.categoryService=l;this.dialog=_;this.overlay=m;this.clonerService=V;this.securityService=N;this.commonService=te;this.toastrService=ie;this.documentStatusService=ne;this.StorageSettingService=oe;this.breakpointsService=un;this.workflowInstanceService=pn;this.uTCToLocalTime=hn;this.breakpointObserver=_n;this.documentStore.documents().length===0&&this.documentStore.getArchiveDocuments(),this.filterForm=this.fb.group({type:[""],metaTag:[""],startDate:[""],endDate:["",this.endDateValidator.bind(this)]}),this.filterForm.get("startDate")?.valueChanges.subscribe(fn=>{this.filterForm.get("endDate")?.updateValueAndValidity()})}step=se(0);selectedCategory=null;displayedColumns=["action","documentNumber","name","categoryName","createdDate","createdBy","archiveName","client","documentStatus","currentWorkflow","isSigned","signDate","storageType"];footerToDisplayed=["footer"];isLoadingResults=!1;contentType="";documentChunkDownloads=[];categories=[];hierarchicalCategories=[];storageSetting=[];documentStatuses=[];allCategories=[];documentStore=O(He);allDocumentStore=O(We);documentResource=this.documentStore.documentResourceParameter();loading=this.documentStore.isLoading();selectedStatus=null;selectStorage=null;selectedCreatedDate;name=null;metatagText=null;selectedDocument=null;documentChunks=[];filterForm;selectedType=null;startDate=null;endDate=null;startDateHasValue=!1;paginator;sort;input;metatag;selection=new dt(!0,[]);clientStore=O(Pt);documentMetaTagStore=O(Ht);endDateValidator(e){return this.filterForm?.get("startDate")?.value&&!e.value?{required:!0}:null}ngOnInit(){this.documentResource.createDate&&(this.selectedCreatedDate=new Date(this.documentResource.createDate)),this.name=this.documentResource.name??"",this.metatagText=this.documentResource.metaTags??"",this.ismobileCheck(),this.getCategories(),this.getDocumentStatus(),this.getStorageSetting(),this.filterForm.get("startDate")?.value||this.filterForm.get("endDate")?.disable()}ismobileCheck(){this.breakpointObserver.isMatched(ve.Handset)&&this.step.set(1)}onRefresh(){this.documentStore.loadByQuery(this.documentResource)}ngAfterViewInit(){this.sub$.sink=this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),this.sub$.sink=re(this.sort.sortChange,this.paginator.page).pipe(Q(e=>{this.documentResource.pageSize=this.paginator.pageSize,this.documentResource.skip=this.paginator.pageIndex*this.paginator.pageSize,this.documentResource.pageSize=this.paginator.pageSize,this.documentResource.orderBy=this.sort.active+" "+this.sort.direction,this.documentStore.loadByQuery(this.documentResource)})).subscribe(),this.sub$.sink=X(this.input.nativeElement,"keyup").pipe(Z(1e3),ee(),Q(()=>{this.paginator.pageIndex=0,this.documentResource.skip=0,this.documentResource.name=this.input.nativeElement.value,this.documentStore.loadByQuery(this.documentResource)})).subscribe(),this.sub$.sink=X(this.metatag.nativeElement,"keyup").pipe(Z(1e3),ee(),Q(()=>{this.paginator.pageIndex=0,this.documentResource.skip=0,this.documentResource.metaTags=this.metatag.nativeElement.value,this.documentStore.loadByQuery(this.documentResource)})).subscribe()}isAllSelected(){let e=this.selection.selected.length,o=this.documentStore.documents().length;return e===o}masterToggle(){this.isAllSelected()?this.selection.clear():this.documentStore.documents().forEach(e=>this.selection.select(e))}onCategoryChange(e){e&&e.value?this.documentResource.categoryId=e.value.id:this.documentResource.categoryId="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.documentStore.loadByQuery(this.documentResource)}onClientChange(e){let o=e.value;o?this.documentResource.clientId=o.id:this.documentResource.clientId="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.documentStore.loadByQuery(this.documentResource)}onCreatedDateChange(e){e?this.documentResource.createDate=this.selectedCreatedDate:this.documentResource.createDate=void 0,this.documentResource.skip=0,this.paginator.pageIndex=0,this.documentStore.loadByQuery(this.documentResource)}onDateFilterChange(e,o){if(e&&o){let[i,l,_]=e.split("/").map(Number),[m,V,N]=o.split("/").map(Number),te=new Date(_,l-1,i),ie=new Date(N,V-1,m),ne=this.uTCToLocalTime.transform(te,"MM/DD/YYYY"),oe=this.uTCToLocalTime.transform(ie,"MM/DD/YYYY");this.documentResource.startDate=ne,this.documentResource.endDate=oe}else this.documentResource.startDate=void 0,this.documentResource.endDate=void 0;this.documentResource.skip=0,this.paginator.pageIndex=0,this.documentStore.loadByQuery(this.documentResource)}onStartDateChange(){let e=this.filterForm.get("startDate")?.value,o=this.filterForm.get("endDate");e?o?.enable():o?.disable()}getDocumentStatus(){this.documentStatusService.getDocumentStatuss().subscribe(e=>{e&&e.length>0&&(this.documentStatuses=[...e],this.documentResource.documentStatusId&&(this.selectedStatus=this.documentStatuses.find(o=>o.id===this.documentResource.documentStatusId)??null))})}getStorageSetting(){this.StorageSettingService.getStorageSettings().subscribe(e=>{e&&e.length>0&&(this.storageSetting=[...e],this.documentResource.storageSettingId&&(this.selectStorage=this.storageSetting.find(o=>o.id===this.documentResource.storageSettingId)??null))})}getCategories(){this.categoryService.getAllCategories().subscribe(e=>{this.categories=[...e],this.categories.filter(i=>i.parentId==null).forEach((i,l)=>{i.deafLevel=0,i.index=l*Math.pow(.1,i.deafLevel??0),i.displayName=i.name,this.allCategories.push(i),this.setDeafLevel(i)}),this.allCategories=this.clonerService.deepClone(this.allCategories),this.documentResource.categoryId&&(this.selectedCategory=this.allCategories.find(i=>i.id===this.documentResource.categoryId)??null)})}setDeafLevel(e){return e?.children&&e.children.length>0&&e.children.map((o,i)=>{o.displayName=e.displayName+" > "+o.name,o.deafLevel=e?(e.deafLevel??0)+1:0,o.index=e?(e.index??0)+i*Math.pow(.1,o.deafLevel):0,this.allCategories.push(o),this.setDeafLevel(o)}),e}restoreDocument(e){let o=e.categoryId;o?this.categoryService.getCategoryById(o).subscribe(i=>{i?.isArchive?this.toastrService.error(this.translationService.getValue("CATEGORY_IS_ARCHIVED_CANNOT_RESTORE_DOCUMENT")):this.sub$.sink=this.commonDialogService.deleteConfirmtionDialog(`${this.translationService.getValue("ARE_YOU_SURE_YOU_WANT_TO_RESTORE")} ${e.name}`).subscribe(l=>{l&&(this.sub$.sink=this.documentService.restoreDocument(e.id??"").subscribe(()=>{this.toastrService.success(this.translationService.getValue("DOCUMENT_RESTORE_SUCCESSFULLY")),this.documentStore.loadByQuery(this.documentResource),this.allDocumentStore.loadDocuments()}))})}):this.toastrService.error(this.translationService.getValue("CATEGORY_NOT_FOUND"))}deleteDocument(e){this.sub$.sink=this.commonDialogService.deleteConfirmtionDialog(`${this.translationService.getValue("ARE_YOU_SURE_YOU_WANT_TO_DELETE")} ${e.name}`).subscribe(o=>{o&&(this.sub$.sink=this.documentService.deleteDocument(e.id??"").subscribe(()=>{this.toastrService.success(this.translationService.getValue("DOCUMENT_DELETED_SUCCESSFULLY")),this.documentStore.loadByQuery(this.documentResource)}))})}onStatusChange(e){let o=e.value;o?this.documentResource.documentStatusId=o.id:this.documentResource.documentStatusId="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.documentStore.loadByQuery(this.documentResource)}onStorageChange(e){let o=e.value;o?this.documentResource.storageSettingId=o.id:this.documentResource.storageSettingId="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.documentStore.loadByQuery(this.documentResource)}checkWorkflowInstance(e){return!(e?.workflowsDetail&&e?.workflowsDetail?.length>0&&e.workflowsDetail.find(i=>i.workflowInstaceStatus===1||i.workflowInstaceStatus===0))}downloadDocument(e){if(this.selectedDocument=e,this.documentStore.setLoadingFlag(!0),e.isChunk)this.getAllDocumentChunks();else{let o={documentId:e.id,name:"",extension:e?.url?.split(".")[1]??"",isVersion:!1,isFromPublicPreview:!1,isPreviewDownloadEnabled:!1,isFileRequestDocument:!1,isSignatureExists:!1,documentNumber:e.documentNumber};this.sub$.sink=this.commonService.downloadDocument(o).subscribe({next:i=>{if(i.type===ge.Response&&(this.addDocumentTrail(e.id??"",8 .toString()),i.body)){let l=new Blob([i.body],{type:i?.body?.type});this.downloadFile(l)}},error:i=>{this.documentStore.setLoadingFlag(!1),this.toastrService.error(this.translationService.getValue("ERROR_WHILE_DOWNLOADING_DOCUMENT"))}})}}addDocumentTrail(e,o){let i={documentId:e,operationName:o};this.allDocumentStore.addDocumentAudit(i)}sendEmail(e){this.dialog.open(ti,{data:e,width:"100%",maxWidth:"50vw"})}onDocumentView(e){return K(this,null,function*(){this.isLoadingResults=!0;try{let i=(e.url?.split(".")??[])[1],l={documentId:e.id,name:e.name,url:e.url,extension:i,isVersion:!1,isFromPublicPreview:!1,isPreviewDownloadEnabled:this.securityService.hasClaim("archive_documents_download_document"),isFileRequestDocument:!1,isSignatureExists:e.isSignatureExists,isChunk:e.isChunk,documentNumber:e.documentNumber},{BasePreviewComponent:_}=yield import("./chunk-BJ7BM7KC.js");this.overlay.open(_,{position:"center",origin:"global",panelClass:["file-preview-overlay-container","white-background"],data:l}),i==="pdf"&&(this.sub$.sink=this.overlay.isClosePanelClose$.subscribe(m=>{m&&i==="pdf"&&this.documentStore.loadByQuery(this.documentResource)}))}finally{this.isLoadingResults=!1}})}onVersionHistoryClick(e){let o=this.clonerService.deepClone(e);this.sub$.sink=this.documentService.getDocumentVersion(e.id??"").subscribe(i=>{o.documentVersions=i,this.dialog.open(Xt,{maxWidth:"95vw",panelClass:"full-width-dialog",data:Object.assign({},o)}).afterClosed().subscribe(_=>{_&&this.documentStore.loadByQuery(this.documentResource)})})}onCreateShareableLink(e){this.sub$.sink=this.documentService.getDocumentShareableLink(e.id??"").subscribe(o=>{this.dialog.open(ei,{width:"500px",data:{document:e,link:o}})})}viewVisualWorkflow(e){this.workflowInstanceService.getvisualWorkflowInstance(e.workflowInstanceId).subscribe({next:o=>K(this,null,function*(){this.isLoadingResults=!0;try{let{VisualWorkflowGraphComponent:i}=yield import("./chunk-H4LJFAGV.js"),l=this.dialog.open(i,{width:"95vw",data:Object.assign({},o)})}finally{this.isLoadingResults=!1}}),error:o=>{}})}getAllDocumentChunks(){this.sub$.sink=this.commonService.getDocumentChunks(this.selectedDocument?.id??"").subscribe({next:e=>{this.documentChunks=e,this.documentChunks.length>0&&this.startDownload()},error:e=>{this.toastrService.error(e.error.message)}})}startDownload(){let{chunkSize1:e,parallelCalls:o}=this.commonService.getNetworkSpeed(),i=[];for(let l=0;l<this.documentChunks.length;l++)i.push({chunkIndex:l,documentVersionId:this.documentChunks[l].documentVersionId});this.sub$.sink=J(i).pipe(le(o),ce(l=>J(l).pipe(ae(_=>this.downloadChunk(_?.chunkIndex,_?.documentVersionId),o)))).subscribe({next:l=>{this.contentType=l.contentType;let _=this.base64ToBlob(l.data,l.contentType);l.blobChunk=_,this.documentChunkDownloads.push(l)},complete:()=>this.mergeChunks(),error:l=>{this.documentStore.setLoadingFlag(!1),this.toastrService.error(this.translationService.getValue("ERROR_WHILE_DOWNLOADING_DOCUMENT")),console.error("Error downloading chunks",l)}})}base64ToBlob(e,o){let i=atob(e),l=new Array(i.length);for(let m=0;m<i.length;m++)l[m]=i.charCodeAt(m);let _=new Uint8Array(l);return new Blob([_],{type:o})}downloadChunk(e,o){return this.commonService.downloadDocumentChunk(o,e)}mergeChunks(){let e=this.documentChunkDownloads.sort((i,l)=>i.chunkIndex-l.chunkIndex).map(i=>i.blobChunk).filter(i=>i!==void 0),o=new Blob(e,{type:this.contentType});this.documentStore.setLoadingFlag(!1),this.addDocumentTrail(this.selectedDocument?.id??"",8 .toString()),this.downloadFile(o)}downloadFile(e){this.documentStore.setLoadingFlag(!1);let o=document.createElement("a");o.setAttribute("style","display:none;"),document.body.appendChild(o),o.download=this.selectedDocument?.name??"",o.href=URL.createObjectURL(e),o.target="_blank",o.click(),document.body.removeChild(o)}onMetaTagChange(e){e&&e.value?(this.selectedType=Number(e.value.type),Number(this.selectedType)===0?(this.filterForm.get("metaTag")?.setValue(""),this.metatagText=""):Number(this.selectedType)===1&&(this.filterForm.get("startDate")?.setValue(null),this.filterForm.get("endDate")?.setValue(null)),this.documentResource.metaTagsTypeId=e.value.id):(this.documentResource.metaTags="",this.metatagText="",this.selectedType=null,this.documentResource.metaTagsTypeId=void 0,this.documentResource.startDate=void 0,this.documentResource.endDate=void 0,this.documentResource.skip=0,this.paginator.pageIndex=0,this.documentStore.loadByQuery(this.documentResource))}static \u0275fac=function(o){return new(o||t)(D(et),D(Le),D(Wt),D(Pe),D(De),D(ot),D(Ne),D(Oe),D($e),D(Fe),D(qt),D(Kt),D(nt),D(Jt),D(G),D(Ce))};static \u0275cmp=me({type:t,selectors:[["app-archive-documents"]],viewQuery:function(o,i){if(o&1&&(F(z,5),F(q,5),F(ri,5),F(li,5)),o&2){let l;L(l=$())&&(i.paginator=l.first),L(l=$())&&(i.sort=l.first),L(l=$())&&(i.input=l.first),L(l=$())&&(i.metatag=l.first)}},features:[de],decls:159,vars:101,consts:[["input",""],["ref",""],["picker",""],["metatag",""],["startDateInput",""],["startPicker",""],["endDateInput",""],["endPicker",""],["menu","matMenu"],[1,"content"],[1,"container-fluid"],[1,"d-flex","mb-2"],[1,"me-auto"],[1,"mb-0","page-title"],[3,"code"],[1,"d-flex","justify-content-end"],["matButton","filled",1,"error",3,"click"],[1,"medium-icon","fs-5","align-middle"],[1,"d-none","d-lg-inline","ms-1"],["appearance","outlined"],[3,"dir"],[3,"expanded"],[1,"d-flex","flex-wrap","flex-column","flex-sm-row"],[1,"p-1","flex-item","flex-fill"],["type","text",1,"form-control",3,"ngModelChange","ngModel","placeholder"],["panelClass","mat-select-control",1,"form-control",3,"valueChange","selectionChange","value","placeholder"],[3,"value"],["panelClass","mat-select-control",1,"form-control",3,"selectionChange","value","placeholder"],["panelClass","mat-select-control",1,"form-control",3,"selectionChange","placeholder"],[1,"input-group"],[1,"form-control",3,"ngModelChange","dateInput","ngModel","matDatepicker","placeholder"],[1,"input-group-append"],["type","button",1,"btn","btn-primary","calendar-button",3,"click"],[1,"medium-icon","fs-6","align-middle"],[1,"p-1","flex-item","flex-fill",3,"ngStyle"],[1,"form-control",3,"ngModelChange","ngModel","placeholder"],[3,"formGroup"],["formControlName","startDate",1,"form-control",3,"dateChange","matDatepicker","placeholder"],[1,"input-group","mt-2"],["formControlName","endDate",1,"form-control",3,"dateInput","matDatepicker","placeholder"],[1,"text-danger"],[1,"table-responsive","mt-2"],[3,"ngClass"],["mat-table","","matSortDisableClear","","matSort","",1,"w-100",3,"dir","dataSource","matSortActive","matSortDirection"],["matColumnDef","action"],["class","table-column-fix-30","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","currentWorkflow"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","documentNumber"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","name"],["matColumnDef","isSigned"],["matColumnDef","signDate"],["matColumnDef","categoryName"],["matColumnDef","client"],["class","table-column-100","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","table-column-100","mat-cell","",4,"matCellDef"],["matColumnDef","documentStatus"],["mat-cell","",3,"ngStyle",4,"matCellDef"],["matColumnDef","storageType"],["matColumnDef","createdDate"],["matColumnDef","createdBy"],["matColumnDef","archiveName"],["matColumnDef","footer"],["mat-footer-cell","","colspan","12",4,"matFooterCellDef"],[4,"matNoDataRow"],["class","grid-header-color","mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef","matFooterRowDefSticky"],[1,"spinner-container"],[1,"country-item",3,"ngStyle"],[1,"d-flex","align-items-center"],[1,"d-flex","align-items-center",3,"matTooltip"],[1,"text-warning","me-1"],[3,"ngStyle"],["mat-header-cell","",1,"table-column-fix-30"],["mat-cell",""],["matMiniFab","","class","primary",3,"matMenuTriggerFor",4,"hasClaim"],["mat-menu-item","","class","btn btn-light btn-sm","type","button",3,"click",4,"hasClaim"],["mat-menu-item","","type","button",1,"btn","btn-light","btn-sm",3,"click"],["class","btn btn-light btn-sm","mat-menu-item","","type","button",3,"click",4,"hasClaim"],["class","btn btn-light btn-sm","mat-menu-item","",3,"click",4,"hasClaim"],["mat-menu-item","","type","button",3,"click",4,"hasClaim"],["matMiniFab","",1,"primary",3,"matMenuTriggerFor"],["mat-menu-item","",1,"btn","btn-light","btn-sm",3,"click"],["mat-menu-item","","type","button",3,"click"],["mat-header-cell",""],[1,"d-flex","flex-column"],[1,"doc-link","mb-1",3,"ngClass"],[1,"doc-link","mb-1",3,"click","ngClass"],["mat-header-cell","","mat-sort-header",""],[1,"doc-link",3,"click"],[1,"bg-success","text-light"],["mat-header-cell","","mat-sort-header","",1,"table-column-100"],["mat-cell","",1,"table-column-100"],["mat-cell","",3,"ngStyle"],["mat-footer-cell","","colspan","12"],[3,"length","pageSize","pageIndex","pageSizeOptions"],["colspan","11"],[1,"m-2"],["mat-header-row","",1,"grid-header-color"],["mat-row",""],["mat-footer-row",""],["mode","indeterminate","diameter","60","strokeWidth","5"]],template:function(o,i){if(o&1){let l=T();r(0,"section",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"span",13),s(5),d(6,"translate"),b(7,"app-page-help-text",14),a()(),r(8,"div",15)(9,"button",16),S("click",function(){return f(l),g(i.onRefresh())}),r(10,"mat-icon",17),s(11,"refresh"),a(),r(12,"span",18),s(13),d(14,"translate"),a()()()(),r(15,"mat-card",19)(16,"mat-card-content")(17,"mat-accordion",20)(18,"mat-expansion-panel",21)(19,"mat-expansion-panel-header")(20,"mat-panel-title"),s(21),d(22,"translate"),a()(),r(23,"div",22)(24,"div",23)(25,"input",24,0),d(27,"translate"),H("ngModelChange",function(m){return f(l),P(i.name,m)||(i.name=m),g(m)}),a()(),r(28,"div",23)(29,"mat-select",25),d(30,"translate"),H("valueChange",function(m){return f(l),P(i.selectedCategory,m)||(i.selectedCategory=m),g(m)}),S("selectionChange",function(m){return f(l),g(i.onCategoryChange(m))}),r(31,"mat-select-trigger"),s(32),d(33,"translate"),a(),r(34,"mat-option",26),s(35),d(36,"translate"),a(),R(37,fi,4,5,"mat-option",26,Y),a()(),r(39,"div",23)(40,"mat-select",27),d(41,"translate"),S("selectionChange",function(m){return f(l),g(i.onStatusChange(m))}),r(42,"mat-option",26),s(43),d(44,"translate"),a(),R(45,gi,3,5,"mat-option",26,Y),a()(),r(47,"div",23)(48,"mat-select",28),d(49,"translate"),S("selectionChange",function(m){return f(l),g(i.onClientChange(m))}),r(50,"mat-option",26),s(51),d(52,"translate"),a(),R(53,Ci,3,2,"mat-option",26,Y),a()(),r(55,"div",23)(56,"mat-select",27),d(57,"translate"),S("selectionChange",function(m){return f(l),g(i.onStorageChange(m))}),r(58,"mat-option",26),s(59),d(60,"translate"),a(),R(61,Si,3,5,"mat-option",26,Y),a()(),r(63,"div",23)(64,"div",29)(65,"input",30,1),d(67,"translate"),H("ngModelChange",function(m){return f(l),P(i.selectedCreatedDate,m)||(i.selectedCreatedDate=m),g(m)}),S("dateInput",function(){f(l);let m=x(66);return g(i.onCreatedDateChange(m.value))}),a(),r(68,"div",31)(69,"button",32),S("click",function(){f(l);let m=x(73);return g(m.open())}),r(70,"mat-icon",33),s(71,"calendar_today"),a()()(),b(72,"mat-datepicker",null,2),a()(),r(74,"div",23)(75,"mat-select",28),d(76,"translate"),S("selectionChange",function(m){return f(l),g(i.onMetaTagChange(m))}),r(77,"mat-option"),s(78),d(79,"translate"),a(),R(80,vi,3,2,"mat-option",26,Y),a()(),r(82,"div",34)(83,"input",35,3),d(85,"translate"),H("ngModelChange",function(m){return f(l),P(i.metatagText,m)||(i.metatagText=m),g(m)}),a()(),r(86,"div",34)(87,"form",36)(88,"div",29)(89,"input",37,4),d(91,"translate"),S("dateChange",function(){return f(l),g(i.onStartDateChange())}),a(),r(92,"div",31)(93,"button",32),S("click",function(){f(l);let m=x(97);return g(m.open())}),r(94,"mat-icon",17),s(95,"calendar_today"),a()()(),b(96,"mat-datepicker",null,5),a(),r(98,"div",38)(99,"input",39,6),d(101,"translate"),S("dateInput",function(){f(l);let m=x(90),V=x(100);return g(i.onDateFilterChange(m.value,V.value))}),a(),r(102,"div",31)(103,"button",32),S("click",function(){f(l);let m=x(107);return g(m.open())}),r(104,"mat-icon",17),s(105,"calendar_today"),a()()(),b(106,"mat-datepicker",null,7),a(),I(108,Di,3,3,"div",40),a()(),b(109,"div",23),a()()(),r(110,"div",41)(111,"div",42)(112,"table",43),y(113,44),v(114,yi,3,3,"th",45)(115,Ri,15,11,"td",46),E(),y(116,47),v(117,Ai,3,3,"th",48)(118,Bi,2,1,"td",46),E(),y(119,49),v(120,Ni,3,3,"th",50)(121,Oi,3,1,"td",46),E(),y(122,51),v(123,Fi,3,3,"th",50)(124,Li,3,1,"td",46),E(),y(125,52),v(126,$i,3,3,"th",48)(127,Pi,2,1,"td",46),E(),y(128,53),v(129,Hi,3,3,"th",48)(130,Yi,2,1,"td",46),E(),y(131,54),v(132,Qi,3,3,"th",50)(133,ji,2,1,"td",46),E(),y(134,55),v(135,Gi,3,3,"th",56)(136,zi,2,1,"td",57),E(),y(137,58),v(138,qi,3,3,"th",50)(139,Ki,2,4,"td",59),E(),y(140,60),v(141,Ji,3,3,"th",50)(142,Xi,3,4,"td",46),E(),y(143,61),v(144,Zi,3,3,"th",50)(145,en,3,4,"td",46),E(),y(146,62),v(147,tn,3,3,"th",50)(148,nn,2,1,"td",46),E(),y(149,63),v(150,on,3,3,"th",50)(151,an,2,1,"td",46),E(),y(152,64),v(153,rn,2,5,"td",65),E(),v(154,ln,6,3,"tr",66)(155,cn,1,0,"tr",67)(156,sn,1,0,"tr",68)(157,mn,1,0,"tr",69),a()()()()()()(),I(158,dn,2,0,"div",70)}if(o&2){let l,_=x(73),m=x(97),V=x(107);n(5),u("",h(6,56,"ARCHIVE_DOCUMENTS")," "),n(2),p("code","ARCHIVE_DOCUMENTS"),n(6),B(h(14,58,"REFRESH")),n(4),p("dir",i.langDir),n(),p("expanded",i.step()===0),n(3),u(" ",h(22,60,"FILTER")," "),n(4),p("placeholder",w(h(27,62,"SEARCH_DOCUMENT_BY_NAME_OR_DESCRIPTION"))),W("ngModel",i.name),n(4),p("placeholder",w(h(30,64,"SELECT_CATEGORY"))),W("value",i.selectedCategory),n(3),u(" ",h(33,66,(i.selectedCategory==null?null:i.selectedCategory.displayName)??"NONE")," "),n(3),u("-- ",h(36,68,"NONE")," --"),n(2),A(i.allCategories),n(3),p("placeholder",w(h(41,70,"SELECT_DOCUMENT_STATUS")))("value",i.selectedStatus),n(3),u("-- ",h(44,72,"NONE")," --"),n(2),A(i.documentStatuses),n(3),p("placeholder",w(h(49,74,"SELECT_CLIENT"))),n(3),u("-- ",h(52,76,"NONE")," --"),n(2),A(i.clientStore.clients()),n(3),p("placeholder",w(h(57,78,"SELECT_STORAGE")))("value",i.selectStorage),n(3),u("-- ",h(60,80,"NONE")," --"),n(2),A(i.storageSetting),n(4),p("placeholder",w(h(67,82,"CREATED_DATE"))),W("ngModel",i.selectedCreatedDate),p("matDatepicker",_),n(10),p("placeholder",w(h(76,84,"SELECT_META_TAG"))),n(3),u("-- ",h(79,86,"NONE")," --"),n(2),A(i.documentMetaTagStore.documentMetaTags()),n(2),p("ngStyle",M(94,ni,i.selectedType!==null&&i.selectedType===0?"block":"none")),n(),p("placeholder",w(h(85,88,"SEARCH_DOCUMENT_BY_META_TAGS"))),W("ngModel",i.metatagText),n(3),p("ngStyle",M(96,ni,i.selectedType!==null&&i.selectedType===1?"block":"none")),n(),p("formGroup",i.filterForm),n(2),p("placeholder",w(h(91,90,"START_DATE")))("matDatepicker",m),n(10),p("placeholder",w(h(101,92,"END_DATE")))("matDatepicker",V),n(9),k((l=i.filterForm.get("endDate"))!=null&&l.hasError("required")&&((l=i.filterForm.get("startDate"))!=null&&l.value)?108:-1);let N=i.documentStore.documentResourceParameter().orderBy?i.documentStore.documentResourceParameter().orderBy.split(" "):j(98,ci);n(3),p("ngClass",M(99,si,i.step()===0)),n(),p("dir",i.langDir)("dataSource",i.documentStore.documents())("matSortActive",N[0])("matSortDirection",N[1]==="asc"?"asc":"desc"),n(43),p("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),n(),p("matRowDefColumns",i.displayedColumns),n(),p("matFooterRowDef",i.footerToDisplayed)("matFooterRowDefSticky",!0),n(),k(i.documentStore.isLoading()||i.isLoadingResults?158:-1)}},dependencies:[it,Je,Ge,ze,qe,Xe,Ze,Nt,Se,vt,yt,It,Tt,Dt,Rt,Et,kt,bt,wt,xt,At,Vt,Mt,Bt,ye,ft,ht,_t,ut,St,q,Ct,gt,z,ii,$t,Ft,Lt,we,xe,be,Ee,Te,Ye,Ot,Ae,ke,Ie,Re,pt,mt,st,tt,Ke,Gt,jt,Ut,Yt,Qt,Zt,ct,Ve,Ue,lt,at,rt,fe,_e,je,Qe,zt,Me,G],encapsulation:2})};export{oi as ArchiveDocumentsComponent};
