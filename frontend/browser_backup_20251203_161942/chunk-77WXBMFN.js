import{c as O}from"./chunk-XFBX5CPU.js";import{a as b}from"./chunk-C3OPHOKD.js";import{g as p}from"./chunk-BFSIXXTJ.js";import{a as f}from"./chunk-DGFNMOMG.js";import{Gc as m,d as h,h as o}from"./chunk-KZMFGXDY.js";import{Da as l,_b as u,o as c}from"./chunk-W3TJXGK4.js";var a=class{id;userName="";firstName="";lastName="";email="";phoneNumber="";bearerToken="";isAuthenticated=!1;isSuperAdmin=!1;claims=[]};var v=class n{constructor(e,t,i,s,r){this.http=e;this.clonerService=t;this.commonHttpErrorService=i;this.router=s;this.licenseValidatorService=r}securityObject=new a;securityObject$=new c(null);companyProfile$=new c(null);get SecurityObject(){return this.securityObject$.asObservable()}isUserAuthenticate(){return this.securityObject.userName&&this.securityObject.bearerToken?!0:this.parseSecurityObj()}setCompany(e){if(e)sessionStorage.setItem(this.licenseValidatorService.keyValues.COMPANY_PROFILE,JSON.stringify(e)),this.companyProfile$.next(JSON.parse(JSON.stringify(e)));else{let t=sessionStorage.getItem(this.licenseValidatorService.keyValues.COMPANY_PROFILE);t&&t!=="null"&&t!=="undefined"&&this.companyProfile$.next(JSON.parse(t))}}get companyProfile(){return this.companyProfile$.asObservable()}login(e){return this.resetSecurityObject(),this.http.post("user/login",e).pipe(u(t=>{this.securityObject=this.clonerService.deepClone(t),this.licenseValidatorService.setTokenValue(this.securityObject),this.securityObject$.next(t)}))}refreshToken(){return this.http.get("user/refresh_token").pipe(u(e=>{this.securityObject=this.clonerService.deepClone(e),this.licenseValidatorService.setTokenValue(this.securityObject),this.securityObject$.next(e)})).pipe(l(this.commonHttpErrorService.handleError))}parseSecurityObj(){let e=this.licenseValidatorService.getAuthObject();return e?(this.securityObject=this.clonerService.deepClone(e),this.securityObject.userName&&this.securityObject.bearerToken?(this.securityObject$.next(this.securityObject),!0):!1):!1}logout(){this.resetSecurityObject()}resetSecurityObject(){this.securityObject.userName="",this.securityObject.bearerToken="",this.securityObject.isAuthenticated=!1,this.securityObject.firstName="",this.securityObject.lastName="",this.securityObject.claims=[],this.licenseValidatorService.removeToken(),sessionStorage.clear(),this.securityObject$.next(null),this.router.navigate(["/login"])}hasClaim(e,t){let i=!1;if(typeof e=="string")i=this.isClaimValid(e,t);else{let s=e;if(s.length===0)return!0;if(s)for(let r=0;r<s.length&&(i=this.isClaimValid(s[r]),!i);r++);}return i}isClaimValid(e,t){let i=!1,s=null;if(s=this.securityObject,s){if(e.indexOf(":")>=0){let r=e.split(":");e=r[0].toLowerCase(),t=r[1]}else e=e.toLowerCase(),t=t||"true";i=s.claims.find(r=>r.claimType?.toLowerCase()==e?.toLowerCase()&&r.claimValue==t)!=null}return i}getUserDetail(){let e=this.licenseValidatorService.getAuthObject();return e||null}setUserDetail(e){this.securityObject=this.clonerService.deepClone(e),this.licenseValidatorService.setTokenValue(this.securityObject)}getQueryParam(e){return new URLSearchParams(window.location.search).get(e)}getCompanyProfile(){return this.http.get("companyprofile")}updateCompanyProfile(e,t){return this.http.post("companyprofile/activate_license",{purchaseCode:t,licenseKey:e}).pipe(l(this.commonHttpErrorService.handleError))}static \u0275fac=function(t){return new(t||n)(o(m),o(b),o(f),o(p),o(O))};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};export{v as a};
