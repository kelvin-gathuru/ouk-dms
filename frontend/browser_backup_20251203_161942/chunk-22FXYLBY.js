import{a as le}from"./chunk-TC5US2P6.js";import{a as $,b as W}from"./chunk-GE3TJVIQ.js";import{a as V}from"./chunk-ZXWR2MAY.js";import{a as re,c as ae}from"./chunk-756DJ4VK.js";import{b as R,c as N,e as w,f as k}from"./chunk-BQ4MMRNN.js";import{b as Q}from"./chunk-JSAPTJHL.js";import{b as Y}from"./chunk-UFOTACYY.js";import{e as oe}from"./chunk-THB5JDTQ.js";import{a as U,b as G}from"./chunk-4E37NPLR.js";import{ta as P,va as L}from"./chunk-56QOWAU7.js";import{C as ie,E as ne,c as z,e as b,h as K,i as X,o as Z,r as ee,u as te}from"./chunk-KYSGX4IW.js";import{a as J}from"./chunk-DGFNMOMG.js";import{$ as v,Ca as S,Da as E,Db as l,Eb as m,Gc as O,Ia as C,Ja as o,Ka as i,La as _,Pc as H,Rc as q,Ua as x,W as t,d as A,ga as y,h as I,jb as a,ka as B,lb as d,mb as j,vb as M,za as T}from"./chunk-KZMFGXDY.js";import{Da as D,b as F}from"./chunk-W3TJXGK4.js";var h=class e{constructor(p,r){this.httpClient=p;this.commonHttpErrorService=r}sendEmail(p){return this.httpClient.post("Email",p).pipe(D(this.commonHttpErrorService.handleError))}static \u0275fac=function(r){return new(r||e)(I(O),I(J))};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};function se(e,p){e&1&&(o(0,"div",7),a(1),l(2,"translate"),i()),e&2&&(t(),d(" ",m(2,1,"PLEASE_CONFIGURE_EMAIL_SMTP_SETTINGS")," "))}function ce(e,p){e&1&&(o(0,"div",13),a(1),l(2,"translate"),i()),e&2&&(t(),d(" ",m(2,1,"TO_ADDRESS_IS_REQUIRED")," "))}function ue(e,p){e&1&&(o(0,"div",13),a(1),l(2,"translate"),i()),e&2&&(t(),d(" ",m(2,1,"EMAIL_IS_NOT_PROPER_FORMAT")," "))}function fe(e,p){e&1&&(o(0,"div",13),a(1),l(2,"translate"),i()),e&2&&(t(),d(" ",m(2,1,"SUBJECT_IS_REQUIRED")," "))}function ve(e,p){e&1&&(o(0,"div",13),a(1),l(2,"translate"),i()),e&2&&(t(),d(" ",m(2,1,"BODY_IS_REQUIRED")," "))}function Se(e,p){e&1&&(o(0,"div",27),_(1,"mat-progress-spinner",28),i())}var me=class e extends V{constructor(r,g,n,s,c,u){super();this.fb=r;this.toastrService=g;this.emailSendService=n;this.data=s;this.dialogRef=c;this.commonService=u}emailForm;subscriptions=new F;isLoading=!1;smtpConfigured;ngOnInit(){this.createEmailForm(),this.subscriptions.add(this.commonService.IsSmtpConfigured.subscribe(r=>{if(r==null){this.checkEmailSMTPSettings();return}this.smtpConfigured=r}))}checkEmailSMTPSettings(){this.sub$.sink=this.commonService.checkEmailSMTPSetting().subscribe({next:r=>{r&&r?.data},error:r=>{this.toastrService.error(this.translationService.getValue("SMTP_SETTINGS_ERROR"))}})}closeDialog(){this.dialogRef.close()}createEmailForm(){this.emailForm=this.fb.group({id:[""],toAddress:["",[b.required,b.email]],subject:["",[b.required]],body:["",[b.required]],documentId:[this.data.id,[b.required]]})}sendEmail(){if(!this.emailForm.valid){this.emailForm.markAllAsTouched();return}this.isLoading=!0,this.sub$.sink=this.emailSendService.sendEmail(this.buildObject()).subscribe({next:()=>{this.addDocumentTrail(),this.toastrService.success(this.translationService.getValue("EMAIL_SENT_SUCCESSFULLY")),this.dialogRef.close(),this.isLoading=!1},error:()=>{this.isLoading=!1}})}buildObject(){return{documentId:this.emailForm.get("documentId")?.value,email:this.emailForm.get("toAddress")?.value,subject:this.emailForm.get("subject")?.value,message:this.emailForm.get("body")?.value}}addDocumentTrail(){let r={documentId:this.data.id,operationName:7 .toString()};this.sub$.sink=this.commonService.addDocumentAuditTrail(r).subscribe(g=>{})}static \u0275fac=function(g){return new(g||e)(v(ie),v(Q),v(h),v(N),v(R),v(Y))};static \u0275cmp=y({type:e,selectors:[["app-send-email"]],features:[B],decls:51,vars:37,consts:[[1,"d-flex"],[1,"me-auto","p-2"],[1,"mb-3","page-title"],[3,"code"],[1,"d-flex","justify-content-end","mb-2"],[1,"close-icon","text-danger","cursor-pointer",3,"click"],[3,"formGroup"],[1,"alert","alert-warning","mt-2"],[1,"row"],[1,"col-12","col-md-6","pb-1"],[1,"input-group","flex-column","flex-md-row"],[1,"input-group-text","font-weight-bold","form-label"],["formControlName","toAddress","type","text",1,"form-control",3,"placeholder"],[1,"text-danger"],["formControlName","subject","type","text",1,"form-control",3,"placeholder"],[1,"col-md-12"],[1,"form-group"],[1,"font-weight-bold","form-label"],[1,"NgxEditor__Wrapper"],["formControlName","body"],[1,"col-md-12","pb-1"],[1,"input-group","mt-3","flex-column","flex-md-row"],[1,"input-group-prepend","w-100","w-md-auto"],[1,"input-group-text","text-truncate","w-100"],[1,"col-md-12","mt-2"],["type","submit","matButton","filled",1,"success",3,"click"],[1,"medium-icon","fs-6","d-flex","align-items-center","justify-content-center"],[1,"spinner-container"],["mode","indeterminate","diameter","60","strokeWidth","5"]],template:function(g,n){if(g&1&&(o(0,"mat-dialog-content")(1,"div",0)(2,"div",1)(3,"span",2),a(4),l(5,"translate"),_(6,"app-page-help-text",3),i()(),o(7,"div",4)(8,"mat-icon",5),x("click",function(){return n.closeDialog()}),a(9,"cancel"),i()()(),o(10,"form",6),S(11,se,3,3,"div",7),o(12,"div",8)(13,"div",9)(14,"div",10)(15,"label",11),a(16),l(17,"translate"),i(),_(18,"input",12),l(19,"translate"),i(),S(20,ce,3,3,"div",13),S(21,ue,3,3,"div",13),i(),o(22,"div",9)(23,"div",10)(24,"label",11),a(25),l(26,"translate"),i(),_(27,"input",14),l(28,"translate"),i(),S(29,fe,3,3,"div",13),i(),o(30,"div",15)(31,"div",16)(32,"label",17),a(33),l(34,"translate"),i(),o(35,"div",18),_(36,"app-text-editor",19),i(),S(37,ve,3,3,"div",13),i()(),o(38,"div",20)(39,"div",21)(40,"div",22)(41,"span",23),a(42),l(43,"translate"),i()()()(),o(44,"div",24)(45,"button",25),x("click",function(){return n.sendEmail()}),o(46,"mat-icon",26),a(47,"send"),i(),a(48),l(49,"translate"),i()()()(),S(50,Se,2,0,"div",27),i()),g&2){let s,c,u,f;t(4),d(" ",m(5,21,"SEND_EMAIL")," "),t(2),C("code","SEND_EMAIL"),t(4),C("formGroup",n.emailForm),t(),E(n.smtpConfigured?-1:11),t(5),d(" ",m(17,23,"TO")," "),t(2),C("placeholder",M(m(19,25,"EMAIL"))),T("aria-label","To"),t(2),E((s=n.emailForm.get("toAddress"))!=null&&s.touched&&((s=n.emailForm.get("toAddress"))!=null&&s.errors)&&(!((s=n.emailForm.get("toAddress"))==null||s.errors==null)&&s.errors.required)?20:-1),t(),E((c=n.emailForm.get("toAddress"))!=null&&c.touched&&((c=n.emailForm.get("toAddress"))!=null&&c.errors)&&(!((c=n.emailForm.get("toAddress"))==null||c.errors==null)&&c.errors.email)?21:-1),t(4),d(" ",m(26,27,"SUBJECT")," "),t(2),C("placeholder",M(m(28,29,"SUBJECT"))),T("aria-label","Subject"),t(2),E((u=n.emailForm.get("subject"))!=null&&u.touched&&((u=n.emailForm.get("subject"))!=null&&u.errors)&&(!((u=n.emailForm.get("subject"))==null||u.errors==null)&&u.errors.required)?29:-1),t(4),d(" ",m(34,31,"BODY")," "),t(4),E((f=n.emailForm.get("body"))!=null&&f.touched&&((f=n.emailForm.get("body"))!=null&&f.errors)&&(!((f=n.emailForm.get("body"))==null||f.errors==null)&&f.errors.required)?37:-1),t(5),j(" ",m(43,33,"ATTACHMENT_DOCUMENT")," :: ",n.data.name," "),t(6),d(" ",m(49,35,"SEND")," "),t(2),E(n.isLoading?50:-1)}},dependencies:[ae,ne,Z,z,K,X,ee,te,k,w,L,P,le,q,re,oe,G,U,W,$,H],styles:[".ck-editor__editable_inline{min-height:150px}.input-group-text[_ngcontent-%COMP%]{white-space:normal;word-break:break-word}.input-group[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media (max-width: 767px){.input-group[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.input-group-text[_ngcontent-%COMP%]{width:100%;margin-bottom:5px}input.form-control[_ngcontent-%COMP%]{width:100%}}"]})};export{me as a};
