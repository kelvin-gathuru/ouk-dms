import{a as ct}from"./chunk-5P7HYDVK.js";import{a as $e}from"./chunk-2EZE64U4.js";import{a as ot,b as at,c as rt,d as lt,e as mt}from"./chunk-UYTZRGIO.js";import{a as nt}from"./chunk-Q64ABPSN.js";import"./chunk-GVGC473E.js";import{a as q}from"./chunk-PM3ZOWUF.js";import{a as W}from"./chunk-XA5EPKK2.js";import{a as Le,b as je,c as Ue,d as ze,e as Qe,f as We,g as qe,h as Ye,i as Ge,j as Je,k as Xe,l as Ke,m as Ze,n as et,o as tt,p as it}from"./chunk-O4QTDGQI.js";import{a as Ee}from"./chunk-UCAGIDEK.js";import{a as xe}from"./chunk-DFMNWGTU.js";import{a as Ne}from"./chunk-KK3LA7D5.js";import"./chunk-PVDG46DZ.js";import{a as Be}from"./chunk-TC5US2P6.js";import{b as Oe}from"./chunk-WFK47GYZ.js";import"./chunk-OHUA35YV.js";import{c as be}from"./chunk-BBTJI4ZO.js";import"./chunk-L52YSXRC.js";import{a as Te}from"./chunk-6GBRFDEJ.js";import{a as Ae,b as Re}from"./chunk-GE3TJVIQ.js";import{a as De}from"./chunk-ZXWR2MAY.js";import"./chunk-G4LST2RF.js";import"./chunk-NJY6F3LT.js";import{a as Fe,b as Pe,c as Ve}from"./chunk-FWRBVAV4.js";import"./chunk-NH2LHIRZ.js";import"./chunk-DTECNCC4.js";import"./chunk-2FSKRITI.js";import{d as He}from"./chunk-TQCCWZBZ.js";import"./chunk-QPRQJRAS.js";import{c as ke}from"./chunk-756DJ4VK.js";import"./chunk-JYYDN77K.js";import"./chunk-BQ4MMRNN.js";import"./chunk-JSAPTJHL.js";import"./chunk-UFOTACYY.js";import{a as we,b as Ie,e as Me}from"./chunk-THB5JDTQ.js";import{a as _e,b as ve}from"./chunk-4E37NPLR.js";import{ca as fe,u as ue,va as Ce}from"./chunk-56QOWAU7.js";import"./chunk-77WXBMFN.js";import"./chunk-XFBX5CPU.js";import{a as Se}from"./chunk-C3OPHOKD.js";import"./chunk-KYSGX4IW.js";import"./chunk-LCPYESOB.js";import"./chunk-BFSIXXTJ.js";import{a as ye}from"./chunk-DGFNMOMG.js";import{$ as y,$a as w,A as Z,Ab as Q,Ca as R,Da as E,Db as c,Dc as pe,Eb as s,Fb as le,Ga as k,Gc as se,Ha as O,Ia as u,Ja as r,Ka as a,La as g,Pa as _,Pc as he,Qa as v,Rc as ge,Sa as B,Ua as x,W as n,Wa as f,_a as b,ab as I,d as X,ga as ee,h as U,i as K,jb as l,ka as te,kb as H,kc as me,lb as m,ma as C,mb as z,p as T,pb as ie,pc as ce,q as D,qb as ne,rb as oe,rc as de,sb as ae,vb as A,zb as re}from"./chunk-KZMFGXDY.js";import{Pa as L,Ya as j,_b as N,fa as $,gb as J,la as G,o as M}from"./chunk-W3TJXGK4.js";import{p as Y}from"./chunk-H5HZ6YB3.js";var F=class{constructor(i){this.documentAuditTrailService=i}documentAuditTrailsSubject=new M([]);responseHeaderSubject=new M({});loadingSubject=new M(!1);loading$=this.loadingSubject.asObservable();_count=0;get count(){return this._count}responseHeaderSubject$=this.responseHeaderSubject.asObservable();connect(i){return this.documentAuditTrailsSubject.asObservable()}disconnect(i){this.documentAuditTrailsSubject.complete(),this.loadingSubject.complete()}loadDocumentAuditTrails(i){this.loadingSubject.next(!0),this.documentAuditTrailService.getDocumentAuditTrials(i).pipe(J(()=>this.loadingSubject.next(!1))).subscribe(t=>{let d=JSON.parse(t.headers.get("X-Pagination")??"{}");this.responseHeaderSubject.next(d);let o=[...t.body??[]];this._count=o.length,this.documentAuditTrailsSubject.next(o)})}};var P=class e{constructor(i,t){this.httpClient=i;this.commonHttpErrorService=t}getDocumentAuditTrials(i){let t="documentAuditTrail",d=new pe().set("Fields",i.fields??"").set("OrderBy",i.orderBy).set("PageSize",i.pageSize.toString()).set("Skip",i.skip.toString()).set("SearchQuery",i.searchQuery??"").set("categoryId",i.categoryId??"").set("operation",i.operation??"").set("name",i.name??"").set("documentNumber",i.documentNumber??"").set("id",i.id?.toString()??"").set("createdBy",i.createdBy?.toString()??"");return this.httpClient.get(t,{params:d,observe:"response"})}static \u0275fac=function(t){return new(t||e)(U(se),U(ye))};static \u0275prov=X({token:e,factory:e.\u0275fac,providedIn:"root"})};var ut=["input"],ft=["docNoInput"],Ct=e=>({"grid-height-medium":e}),_t=e=>({"margin-left.px":e}),vt=()=>[10,20,30],dt=(e,i)=>i.id,ht=(e,i)=>i.value;function gt(e,i){if(e&1&&(r(0,"div",39)(1,"mat-icon",41),l(2,"folder"),a(),r(3,"b"),l(4),a()()),e&2){let t=f().$implicit;n(4),H(t.name)}}function Tt(e,i){if(e&1&&(r(0,"div",40)(1,"mat-icon",41),l(2,"folder"),a(),l(3),a()),e&2){let t=f().$implicit;u("matTooltip",t.name),n(3),m(" ",t.name," ")}}function Dt(e,i){if(e&1&&(r(0,"mat-option",14)(1,"div",38),R(2,gt,5,1,"div",39)(3,Tt,4,2,"div",40),a()()),e&2){let t=i.$implicit;u("value",t),n(),u("ngStyle",Q(3,_t,(t.deafLevel??0)*20)),n(),E(t.deafLevel==0?2:3)}}function St(e,i){if(e&1&&(r(0,"mat-option",14),l(1),a()),e&2){let t=i.$implicit;u("value",t.value),n(),m(" ",t.key," ")}}function yt(e,i){if(e&1&&(r(0,"mat-option",14),l(1),a()),e&2){let t=i.$implicit;u("value",t.id),n(),z(" ",t.firstName," ",t.lastName," ")}}function xt(e,i){e&1&&(r(0,"th",42),l(1),c(2,"translate"),c(3,"translate"),a()),e&2&&(n(),z(" ",s(2,2,"ACTION")," ",s(3,4,"DATE")," "))}function At(e,i){if(e&1&&(r(0,"td",43),l(1),c(2,"utcToLocalTime"),a()),e&2){let t=i.$implicit;n(),m(" ",le(2,1,t==null?null:t.createdDate,"full")," ")}}function Rt(e,i){e&1&&(r(0,"th",44),l(1),c(2,"translate"),a()),e&2&&(n(),m(" ",s(2,1,"DOCUMENT_NO")," "))}function Et(e,i){if(e&1){let t=B();r(0,"a",46),x("click",function(){T(t);let o=f().$implicit,p=f();return D(p.onDocumentView(o))}),l(1),a()}if(e&2){let t=f().$implicit;n(),H(t.documentNumber)}}function bt(e,i){if(e&1&&l(0),e&2){let t=f().$implicit;m(" ",t.documentNumber," ")}}function wt(e,i){if(e&1&&(r(0,"td",43),R(1,Et,2,1,"a",45)(2,bt,1,1),a()),e&2){let t=i.$implicit;n(),E(t.isDocumentDeleted===!1?1:2)}}function It(e,i){e&1&&(r(0,"th",44),l(1),c(2,"translate"),a()),e&2&&(n(),m(" ",s(2,1,"NAME")," "))}function Mt(e,i){if(e&1){let t=B();r(0,"a",46),x("click",function(){T(t);let o=f().$implicit,p=f();return D(p.onDocumentView(o))}),l(1),a()}if(e&2){let t=f().$implicit;n(),H(t.documentName)}}function Nt(e,i){if(e&1&&l(0),e&2){let t=f().$implicit;m(" ",t.documentName," ")}}function kt(e,i){if(e&1&&(r(0,"td",43),R(1,Mt,2,1,"a",45)(2,Nt,1,1),a()),e&2){let t=i.$implicit;n(),E(t.isDocumentDeleted===!1?1:2)}}function Ot(e,i){e&1&&(r(0,"th",44),l(1),c(2,"translate"),a()),e&2&&(n(),m(" ",s(2,1,"CATEGORY_NAME")," "))}function Bt(e,i){if(e&1&&(r(0,"td",43),l(1),a()),e&2){let t=i.$implicit;n(),m(" ",t.categoryName," ")}}function Ht(e,i){e&1&&(r(0,"th",44),l(1),c(2,"translate"),a()),e&2&&(n(),m(" ",s(2,1,"OPERATION")," "))}function Ft(e,i){if(e&1&&(r(0,"td",47),l(1),c(2,"translate"),a()),e&2){let t=i.$implicit;u("appDocumentOperationColor",t.operationName),n(),m(" ",s(2,2,t.operationName.toUpperCase())," ")}}function Pt(e,i){e&1&&(r(0,"th",44),l(1),c(2,"translate"),a()),e&2&&(n(),m(" ",s(2,1,"BY_WHOM")," "))}function Vt(e,i){if(e&1&&(r(0,"td",43),l(1),a()),e&2){let t=i.$implicit;n(),m(" ",t==null?null:t.createdBy," ")}}function $t(e,i){e&1&&(r(0,"th",44),l(1),c(2,"translate"),a()),e&2&&(n(),m(" ",s(2,1,"TO_WHOM_USER")," "))}function Lt(e,i){if(e&1&&(r(0,"td",43),l(1),a()),e&2){let t=i.$implicit;n(),m(" ",t==null?null:t.permissionUser," ")}}function jt(e,i){e&1&&(r(0,"th",44),l(1),c(2,"translate"),a()),e&2&&(n(),m(" ",s(2,1,"TO_WHOM_ROLE")," "))}function Ut(e,i){if(e&1&&(r(0,"td",43),l(1),a()),e&2){let t=i.$implicit;n(),m(" ",t==null?null:t.permissionRole," ")}}function zt(e,i){if(e&1&&(r(0,"td",48),g(1,"mat-paginator",49),a()),e&2){let t=f();n(),u("length",t.documentResource.totalCount)("pageSize",t.documentResource.pageSize)("pageSizeOptions",re(3,vt))}}function Qt(e,i){e&1&&g(0,"tr",50)}function Wt(e,i){e&1&&g(0,"tr",51)}function qt(e,i){e&1&&g(0,"tr",52)}function Yt(e,i){e&1&&(r(0,"tr")(1,"td",53)(2,"div",54)(3,"b"),l(4),c(5,"translate"),a()()()()),e&2&&(n(4),m(" ",s(5,1,"NO_DATA_FOUND")))}function Gt(e,i){e&1&&(r(0,"div",37),g(1,"mat-progress-spinner",55),a())}var V=class e extends De{constructor(t,d,o,p,S){super();this.documentAuditTrailService=t;this.categoryService=d;this.overlay=o;this.clonerService=p;this.breakpointObserver=S;this.documentResource=new $e,this.documentResource.pageSize=10,this.documentResource.orderBy="createdDate desc"}dataSource;operations=[];documentOperation=Ne;documentAuditTrails=[];displayedColumns=["createdDate","documentNumber","documentName","categoryName","operationName","createdBy","permissionUser","permissionRole"];isLoadingResults=!1;documentResource;categories=[];allCategories=[];selectedCategory=null;loading$;paginator;sort;input;docNoInput;userStore=K(nt);footerToDisplayed=["footer"];step=Z(0);ngOnInit(){this.ismobileCheck(),this.dataSource=new F(this.documentAuditTrailService),this.dataSource.loadDocumentAuditTrails(this.documentResource),this.getCategories(),this.getResourceParameter(),this.getOperations()}ismobileCheck(){this.breakpointObserver.isMatched(fe.Handset)&&this.step.set(1)}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),this.sub$.sink=G(this.sort.sortChange,this.paginator.page).pipe(N(t=>{this.documentResource.skip=this.paginator.pageIndex*this.paginator.pageSize,this.documentResource.pageSize=this.paginator.pageSize,this.documentResource.orderBy=this.sort.active+" "+this.sort.direction,this.dataSource.loadDocumentAuditTrails(this.documentResource)})).subscribe(),this.sub$.sink=$(this.input.nativeElement,"keyup").pipe(L(1e3),j(),N(()=>{this.paginator.pageIndex=0,this.documentResource.skip=0,this.documentResource.name=this.input.nativeElement.value,this.dataSource.loadDocumentAuditTrails(this.documentResource)})).subscribe(),this.sub$.sink=$(this.docNoInput.nativeElement,"keyup").pipe(L(1e3),j(),N(()=>{this.paginator.pageIndex=0,this.documentResource.skip=0,this.documentResource.documentNumber=this.docNoInput.nativeElement.value,this.dataSource.loadDocumentAuditTrails(this.documentResource)})).subscribe()}onCategoryChange(t){t&&t.value?this.documentResource.categoryId=t.value.id:this.documentResource.categoryId="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.dataSource.loadDocumentAuditTrails(this.documentResource)}onUserChange(t){t.value?this.documentResource.createdBy=t.value:this.documentResource.createdBy="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.dataSource.loadDocumentAuditTrails(this.documentResource)}onOperationChange(t){t.value?this.documentResource.operation=t.value:this.documentResource.operation="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.dataSource.loadDocumentAuditTrails(this.documentResource)}getOperations(){this.operations=[{key:"Read",value:1},{key:"Created",value:2},{key:"Modified",value:3},{key:"Deleted",value:4},{key:"Added Permission",value:5},{key:"Removed Permission",value:6},{key:"Send Email",value:7},{key:"Download",value:8},{key:"Added Version",value:9},{key:"Added Signature",value:10},{key:"Restored Version",value:11},{key:"Archived",value:12},{key:"Restored",value:13},{key:"Add Folder Permission",value:14},{key:"Removed Folder Permission",value:15},{key:"Archived Folder",value:16},{key:"Restored Folder",value:17},{key:"Added Folder",value:18},{key:"Edited Folder",value:19},{key:"Deleted Folder",value:20}]}getCategories(){this.categoryService.getAllCategories().subscribe(t=>{this.categories=[...t],this.categories.filter(o=>o.parentId==null).forEach((o,p)=>{o.deafLevel=0,o.index=p*Math.pow(.1,o.deafLevel),o.displayName=o.name,this.allCategories.push(o),this.setDeafLevel(o)}),this.allCategories=this.clonerService.deepClone(this.allCategories)})}setDeafLevel(t){return t?.children&&t.children.length>0&&t.children.map((d,o)=>{d.displayName=t.displayName+" > "+d.name,d.deafLevel=t?(t.deafLevel??0)+1:0,d.index=(t?t.index??0:0)+o*Math.pow(.1,d.deafLevel),this.allCategories.push(d),this.setDeafLevel(d)}),t}getResourceParameter(){this.sub$.sink=this.dataSource.responseHeaderSubject$.subscribe(t=>{t&&(this.documentResource.pageSize=t.pageSize,this.documentResource.skip=t.skip,this.documentResource.totalCount=t.totalCount)})}onDocumentView(t){return Y(this,null,function*(){this.isLoadingResults=!0;try{let o=(t.url?.split(".")??[])[1],p={documentId:t.documentId,name:t.documentName,extension:o,isVersion:!1,isFromPublicPreview:!1,isPreviewDownloadEnabled:!1,isSignatureExists:!1,isFileRequestDocument:!1,url:t.url,isChunk:t.isChunk,documentNumber:t.documentNumber},{BasePreviewComponent:S}=yield import("./chunk-JJBHCVNV.js");this.overlay.open(S,{position:"center",origin:"global",panelClass:["file-preview-overlay-container","white-background"],data:p})}finally{this.isLoadingResults=!1}})}static \u0275fac=function(d){return new(d||e)(y(P),y(xe),y(be),y(Se),y(ue))};static \u0275cmp=ee({type:e,selectors:[["app-document-audit-trail"]],viewQuery:function(d,o){if(d&1&&(b(W,5),b(q,5),b(ut,5),b(ft,5)),d&2){let p;w(p=I())&&(o.paginator=p.first),w(p=I())&&(o.sort=p.first),w(p=I())&&(o.input=p.first),w(p=I())&&(o.docNoInput=p.first)}},features:[te],decls:88,vars:53,consts:[["docNoInput",""],["input",""],[1,"content"],[1,"container-fluid"],[1,"d-flex","mb-2"],[1,"me-auto"],[1,"mb-0","page-title"],[3,"code"],["appearance","outlined"],[3,"expanded"],[1,"d-flex","flex-wrap","flex-column","flex-sm-row"],[1,"p-1","flex-item","flex-fill"],[1,"form-control",3,"placeholder"],["panelClass","mat-select-control",1,"form-control",3,"valueChange","selectionChange","value","placeholder"],[3,"value"],["panelClass","mat-select-control",1,"form-control",3,"selectionChange","placeholder"],[1,"table-responsive","mt-2"],[3,"ngClass"],["mat-table","","matSort","","matSortActive","createdDate","matSortDirection","desc",1,"w-100",3,"dataSource"],["matColumnDef","createdDate"],["class","table-column-fix-200","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","documentNumber"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","documentName"],["matColumnDef","categoryName"],["matColumnDef","operationName"],["mat-cell","",3,"appDocumentOperationColor",4,"matCellDef"],["matColumnDef","createdBy"],["matColumnDef","permissionUser"],["matColumnDef","permissionRole"],["matColumnDef","footer"],["mat-footer-cell","","colspan","8",4,"matFooterCellDef"],["class","grid-header-color","mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef","matFooterRowDefSticky"],[4,"matNoDataRow"],[1,"spinner-container"],[1,"country-item",3,"ngStyle"],[1,"d-flex","align-items-center"],[1,"d-flex","align-items-center",3,"matTooltip"],[1,"text-warning","me-1"],["mat-header-cell","","mat-sort-header","",1,"table-column-fix-200"],["mat-cell",""],["mat-header-cell","","mat-sort-header",""],[1,"doc-link"],[1,"doc-link",3,"click"],["mat-cell","",3,"appDocumentOperationColor"],["mat-footer-cell","","colspan","8"],[3,"length","pageSize","pageSizeOptions"],["mat-header-row","",1,"grid-header-color"],["mat-row",""],["mat-footer-row",""],["colspan","7"],[1,"m-2"],["mode","indeterminate","diameter","60","strokeWidth","5"]],template:function(d,o){if(d&1){let p=B();r(0,"section",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"span",6),l(5),c(6,"translate"),g(7,"app-page-help-text",7),a()()(),r(8,"mat-card",8)(9,"mat-card-content")(10,"mat-accordion")(11,"mat-expansion-panel",9)(12,"mat-expansion-panel-header")(13,"mat-panel-title"),l(14),c(15,"translate"),a()(),r(16,"div",10)(17,"div",11),g(18,"input",12,0),c(20,"translate"),a(),r(21,"div",11),g(22,"input",12,1),c(24,"translate"),a(),r(25,"div",11)(26,"mat-select",13),c(27,"translate"),oe("valueChange",function(h){return T(p),ne(o.selectedCategory,h)||(o.selectedCategory=h),D(h)}),x("selectionChange",function(h){return T(p),D(o.onCategoryChange(h))}),r(28,"mat-select-trigger"),l(29),c(30,"translate"),a(),r(31,"mat-option",14),l(32),c(33,"translate"),a(),k(34,Dt,4,5,"mat-option",14,dt),a()(),r(36,"div",11)(37,"mat-select",15),c(38,"translate"),x("selectionChange",function(h){return T(p),D(o.onOperationChange(h))}),r(39,"mat-option",14),l(40),c(41,"translate"),a(),k(42,St,2,2,"mat-option",14,ht),a()(),r(44,"div",11)(45,"mat-select",15),c(46,"translate"),x("selectionChange",function(h){return T(p),D(o.onUserChange(h))}),r(47,"mat-option",14),l(48),c(49,"translate"),a(),k(50,yt,2,3,"mat-option",14,dt),a()()()()(),r(52,"div",16)(53,"div",17)(54,"table",18),_(55,19),C(56,xt,4,6,"th",20)(57,At,3,4,"td",21),v(),_(58,22),C(59,Rt,3,3,"th",23)(60,wt,3,1,"td",21),v(),_(61,24),C(62,It,3,3,"th",23)(63,kt,3,1,"td",21),v(),_(64,25),C(65,Ot,3,3,"th",23)(66,Bt,2,1,"td",21),v(),_(67,26),C(68,Ht,3,3,"th",23)(69,Ft,3,4,"td",27),v(),_(70,28),C(71,Pt,3,3,"th",23)(72,Vt,2,1,"td",21),v(),_(73,29),C(74,$t,3,3,"th",23)(75,Lt,2,1,"td",21),v(),_(76,30),C(77,jt,3,3,"th",23)(78,Ut,2,1,"td",21),v(),_(79,31),C(80,zt,2,4,"td",32),v(),C(81,Qt,1,0,"tr",33)(82,Wt,1,0,"tr",34)(83,qt,1,0,"tr",35)(84,Yt,6,3,"tr",36),a()()()()()()(),ae(85),c(86,"async"),R(87,Gt,2,0,"div",37)}if(d&2){n(5),m("",s(6,27,"DOCUMENTS_AUDIT_TRAIL")," "),n(2),u("code","DOCUMENTS_AUDIT_TRAIL"),n(4),u("expanded",o.step()===0),n(3),m(" ",s(15,29,"FILTER")," "),n(4),u("placeholder",A(s(20,31,"DOCUMENT_NO"))),n(4),u("placeholder",A(s(24,33,"SEARCH_DOCUMENT_BY_NAME"))),n(4),u("placeholder",A(s(27,35,"SELECT_CATEGORY"))),ie("value",o.selectedCategory),n(3),m(" ",s(30,37,(o.selectedCategory==null?null:o.selectedCategory.displayName)??"NONE")," "),n(3),m("-- ",s(33,39,"NONE")," --"),n(2),O(o.allCategories),n(3),u("placeholder",A(s(38,41,"SELECT_OPERATION"))),n(3),m("-- ",s(41,43,"NONE")," --"),n(2),O(o.operations),n(3),u("placeholder",A(s(46,45,"SELECT_USER"))),n(3),m("-- ",s(49,47,"NONE")," --"),n(2),O(o.userStore.users()),n(3),u("ngClass",Q(51,Ct,o.step()===0)),n(),u("dataSource",o.dataSource),n(27),u("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),n(),u("matRowDefColumns",o.displayedColumns),n(),u("matFooterRowDef",o.footerToDisplayed)("matFooterRowDefSticky",!0);let p=s(86,49,o.dataSource.loading$);n(4),E(p||o.isLoadingResults?87:-1)}},dependencies:[Ce,Be,Oe,ke,mt,lt,ot,at,rt,Ve,Fe,Pe,He,it,Le,Ue,Ge,Qe,je,Xe,ze,Je,We,Ye,qe,Ke,et,Ze,tt,ge,W,q,ct,Me,we,Ie,me,ce,Re,Ae,ve,_e,he,Te,de],encapsulation:2})};var tn=[{path:"",component:V,data:{claimType:"VIEW_DOCUMENT_AUDIT_TRAIL"},canActivate:[Ee]}];export{tn as DOCUMENT_AUDIT_TRAIL_ROUTES};
