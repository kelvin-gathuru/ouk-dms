import{a as w,b as e,c as N,d as F,e as H,f as _,g as A,h as p}from"./chunk-OHUA35YV.js";import{a as y}from"./chunk-BIHV7ZGQ.js";import{b as D}from"./chunk-JSAPTJHL.js";import{b as v}from"./chunk-UFOTACYY.js";import{a as U}from"./chunk-LCPYESOB.js";import{a as L}from"./chunk-DGFNMOMG.js";import{Gc as C,Ob as I,d as g,h as d,i as W}from"./chunk-KZMFGXDY.js";import{Da as c,Pa as b,Ub as f,Ya as O,_b as s,h as l}from"./chunk-W3TJXGK4.js";import{a,b as u}from"./chunk-H5HZ6YB3.js";var T=class o{constructor(n,i){this.httpClient=n;this.commonHttpErrorService=i}getWorkflowSteps(){return this.httpClient.get("WorkflowStep").pipe(c(this.commonHttpErrorService.handleError))}getWorkflowStep(n){let i=`WorkflowStep/${n}`;return this.httpClient.get(i).pipe(c(this.commonHttpErrorService.handleError))}addWorkflowStep(n){return this.httpClient.post("WorkflowStep",{workflowSteps:n})}updateWorkflowStep(n){return this.httpClient.put("WorkflowStep",{workflowSteps:n})}deleteWorkflowStep(n){let i=`WorkflowStep/${n}`;return this.httpClient.delete(i)}static \u0275fac=function(i){return new(i||o)(d(C),d(L))};static \u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"})};var h=class o{constructor(n,i){this.httpClient=n;this.commonHttpErrorService=i}getWorkflowTransitions(){return this.httpClient.get("WorkflowTransition").pipe(c(this.commonHttpErrorService.handleError))}getWorkflowTransition(n){let i=`WorkflowTransition/${n}`;return this.httpClient.get(i).pipe(c(this.commonHttpErrorService.handleError))}addWorkflowTransition(n){return this.httpClient.post("WorkflowTransition",{workflowTransitions:n})}updateWorkflowTransition(n){return this.httpClient.put("WorkflowTransition",{workflowTransitions:n})}deleteWorkflowTransition(n){let i=`WorkflowTransition/${n}`;return this.httpClient.delete(i).pipe(c(this.commonHttpErrorService.handleError))}static \u0275fac=function(i){return new(i||o)(d(C),d(L))};static \u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"})};var M={workflows:[],isLoading:!1,commonError:null,currentWorkflow:null,roles:[],currentStep:0,isEditMode:!1,users:[]},io=N({providedIn:"root"},A(M),F(({workflows:o})=>({sortedWorkflows:I(()=>o().sort((n,i)=>n.name.localeCompare(i.name)))})),_((o,n=W(y),i=W(h),S=W(T),k=W(D),m=W(U),R=W(v))=>({loadWorkflows:p(l(b(300),s(()=>e(o,{isLoading:!0})),f(()=>n.getWorkflows().pipe(w({next:t=>{e(o,{workflows:[...t],isLoading:!1,commonError:null})},error:t=>{e(o,{commonError:t,isLoading:!1}),console.error(t)}}))))),deleteWorkflowById:p(l(O(),s(()=>e(o,{isLoading:!0})),f(t=>n.deleteWorkflow(t).pipe(w({next:()=>{k.success(m.getValue("WORKFLOW_DELETED_SUCCESSFULLY")),e(o,{workflows:o.workflows().filter(r=>r.id!==t),isLoading:!1})},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),addWorkflow:p(l(s(()=>e(o,{isLoading:!0})),f(t=>n.addWorkflow(t).pipe(w({next:r=>{e(o,{workflows:[...o.workflows(),a({},r)],isLoading:!1,commonError:null,currentWorkflow:a({},r),currentStep:1}),k.success(m.getValue("WORKFLOW_CREATED_SUCCESSFULLY"))},error:r=>{e(o,{commonError:r}),console.error(r)}}))))),updateWorkflow:p(l(s(()=>e(o,{isLoading:!0})),f(t=>n.updateWorkflow(t).pipe(w({next:r=>{let E=o.currentWorkflow();if(E){let x=u(a({},E),{name:r.name??"",description:r.description??""});e(o,{currentWorkflow:x,workflows:[...o.workflows().filter(j=>j.id!==r.id),x],isLoading:!1,commonError:null,currentStep:1})}k.success(m.getValue("WORKFLOW_UPDATED_SUCCESSFULLY"))},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),getCurrentWorkflow:()=>o.currentWorkflow(),setCurrentWorkflow:t=>{e(o,{currentWorkflow:a({},t),isEditMode:!0})},setError:t=>{e(o,{commonError:a({},t)})},getWorkflowById:p(l(s(()=>e(o,{isLoading:!0})),f(t=>n.getWorkflow(t).pipe(w({next:r=>{e(o,{currentWorkflow:r,isLoading:!1,commonError:null})},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),addWorkflowStep:p(l(s(()=>e(o,{isLoading:!0})),f(t=>S.addWorkflowStep(t).pipe(w({next:r=>{e(o,{currentWorkflow:u(a({},o.currentWorkflow()),{name:o.currentWorkflow()?.name??"",description:o.currentWorkflow()?.description??"",workflowSteps:[...r],workflowInstances:o.currentWorkflow()?.workflowInstances??[],isWorkflowSetup:o.currentWorkflow()?.isWorkflowSetup??!1,workflowTransitions:[],id:o.currentWorkflow()?.id??"",isWorkflowRedirectNextStep:o.currentWorkflow()?.isWorkflowRedirectNextStep??!1,isWorkflowStepRedirectNextStep:o.currentWorkflow()?.isWorkflowStepRedirectNextStep??!1,updatedAt:o.currentWorkflow()?.updatedAt??void 0}),isLoading:!1,currentStep:2}),k.success(m.getValue("WORKFLOW_STEP_CREATED_SUCCESSFULLY"))},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),updateWorkflowStep:p(l(s(()=>e(o,{isLoading:!0})),f(t=>S.updateWorkflowStep(t).pipe(w({next:r=>{e(o,{currentWorkflow:u(a({},o.currentWorkflow()??{id:"",name:"",description:"",isWorkflowSetup:!1,isWorkflowRedirectNextStep:!1,isWorkflowStepRedirectNextStep:!1,updatedAt:void 0,workflowSteps:[],workflowTransitions:[],workflowInstances:[]}),{name:o.currentWorkflow()?.name??"",description:o.currentWorkflow()?.description??"",workflowSteps:[...r],workflowTransitions:[...o.currentWorkflow()?.workflowTransitions??[]]}),workflows:[...o.workflows().filter(E=>E.id!==r[0].workflowId),{id:o.currentWorkflow()?.id??"",name:o.currentWorkflow()?.name??"",description:o.currentWorkflow()?.description??"",isWorkflowSetup:o.currentWorkflow()?.isWorkflowSetup??!1,isWorkflowRedirectNextStep:o.currentWorkflow()?.isWorkflowRedirectNextStep??!1,isWorkflowStepRedirectNextStep:o.currentWorkflow()?.isWorkflowStepRedirectNextStep??!1,updatedAt:o.currentWorkflow()?.updatedAt,workflowSteps:[...r],workflowInstances:o.currentWorkflow()?.workflowInstances??[],workflowTransitions:[...o.currentWorkflow()?.workflowTransitions??[]]}],isLoading:!1,currentStep:2}),k.success(m.getValue("WORKFLOW_STEP_UPDATED_SUCCESSFULLY"))},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),deleteWorkflowStep:p(l(s(()=>e(o,{isLoading:!0})),f(t=>S.deleteWorkflowStep(t).pipe(w({next:()=>{k.success(m.getValue("WORKFLOW_STEP_DELETED_SUCCESSFULLY")),e(o,{isLoading:!1})},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),getWorkflowStepById:p(l(s(()=>e(o,{isLoading:!0})),f(t=>S.getWorkflowStep(t).pipe(w({next:()=>{e(o,{isLoading:!1})},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),addWorkflowTransition:p(l(s(()=>e(o,{isLoading:!0})),f(t=>i.addWorkflowTransition(t).pipe(w({next:r=>{e(o,{currentWorkflow:u(a({},o.currentWorkflow()),{name:o.currentWorkflow()?.name??"",description:o.currentWorkflow()?.description??"",isWorkflowSetup:o.currentWorkflow()?.isWorkflowSetup??!1,workflowSteps:o.currentWorkflow()?.workflowSteps??[],isWorkflowRedirectNextStep:o.currentWorkflow()?.isWorkflowRedirectNextStep??!1,isWorkflowStepRedirectNextStep:o.currentWorkflow()?.isWorkflowStepRedirectNextStep??!1,updatedAt:o.currentWorkflow()?.updatedAt,id:o.currentWorkflow()?.id??"",workflowInstances:o.currentWorkflow()?.workflowInstances??[],workflowTransitions:[...r]}),isLoading:!1,currentStep:0,commonError:null}),k.success(m.getValue("WORKFLOW_TRANSITION_CREATED_SUCCESSFULLY"))},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),updateWorkflowTransition:p(l(s(()=>e(o,{isLoading:!0})),f(t=>i.updateWorkflowTransition(t).pipe(w({next:r=>{e(o,{currentWorkflow:u(a({},o.currentWorkflow()),{name:o.currentWorkflow()?.name??"",description:o.currentWorkflow()?.description??"",isWorkflowSetup:o.currentWorkflow()?.isWorkflowSetup??!1,workflowSteps:o.currentWorkflow()?.workflowSteps??[],isWorkflowRedirectNextStep:o.currentWorkflow()?.isWorkflowRedirectNextStep??!1,isWorkflowStepRedirectNextStep:o.currentWorkflow()?.isWorkflowStepRedirectNextStep??!1,updatedAt:o.currentWorkflow()?.updatedAt,id:o.currentWorkflow()?.id??"",workflowInstances:o.currentWorkflow()?.workflowInstances??[],workflowTransitions:[...r]}),isLoading:!1,currentStep:0,commonError:null}),k.success(m.getValue("WORKFLOW_TRANSITION_UPDATED_SUCCESSFULLY"))},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),getWorkflowTransitionById:p(l(s(()=>e(o,{isLoading:!0})),f(t=>i.getWorkflowTransition(t).pipe(w({next:()=>{e(o,{isLoading:!1})},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),deleteWorkflowTransition:p(l(s(()=>e(o,{isLoading:!0})),f(t=>i.deleteWorkflowTransition(t).pipe(w({next:()=>{k.success(m.getValue("WORKFLOW_TRANSITION_DELETED_SUCCESSFULLY")),e(o,{isLoading:!1})},error:r=>{e(o,{commonError:r,isLoading:!1}),console.error(r)}}))))),getRoles:p(l(s(()=>e(o,{isLoading:!0})),f(()=>R.getRoles().pipe(w({next:t=>{e(o,{roles:[...t],isLoading:!1})},error:t=>{e(o,{commonError:t,isLoading:!1}),console.error(t)}}))))),getUsers:p(l(s(()=>e(o,{isLoading:!0})),f(()=>R.getUsersForDropdown().pipe(w({next:t=>{e(o,{users:[...t],isLoading:!1})},error:t=>{e(o,{commonError:t,isLoading:!1}),console.error(t)}}))))),setCurrentWorkflowAsEmpty:()=>{e(o,{currentWorkflow:{id:"",name:"",description:"",isWorkflowSetup:!1,workflowSteps:[],workflowTransitions:[],workflowInstances:[]},currentStep:0})},setCurrentStep:t=>{e(o,{currentStep:t})}})),H({onInit(o){o.getRoles(),o.getUsers(),!sessionStorage.getItem("workflows")&&o.loadWorkflows()},onDestroy(o){e(o,{currentWorkflow:null,currentStep:0})}}));export{io as a};
