import{a as Ze}from"./chunk-Q64ABPSN.js";import{a as nt}from"./chunk-3MHHJSMB.js";import{b as tt}from"./chunk-RSOKOSFJ.js";import{a as Ye,b as We}from"./chunk-6QK67EK5.js";import{a as ot}from"./chunk-KXR3ZNF4.js";import{b as et}from"./chunk-IDUCEWII.js";import{a as it}from"./chunk-GNSE3KGA.js";import{a as Ke,b as Xe,c as Je}from"./chunk-NAYIGTW2.js";import"./chunk-ZL3HBFEV.js";import"./chunk-DBWWD6JI.js";import"./chunk-4U6IWAJM.js";import"./chunk-73AGG5TT.js";import{a as De}from"./chunk-DFMNWGTU.js";import"./chunk-KK3LA7D5.js";import"./chunk-PVDG46DZ.js";import{a as Ge}from"./chunk-TC5US2P6.js";import{b as Le}from"./chunk-WFK47GYZ.js";import{a as ge}from"./chunk-DD7TOTAW.js";import{b as Se}from"./chunk-VX5UXB3Q.js";import"./chunk-I43MH25B.js";import"./chunk-OHUA35YV.js";import{a as Ce}from"./chunk-6MWAWDLF.js";import{a as $e}from"./chunk-3NQBK7XS.js";import{a as Ee,b as ye}from"./chunk-GE3TJVIQ.js";import{a as _e}from"./chunk-ZXWR2MAY.js";import"./chunk-G4LST2RF.js";import"./chunk-NJY6F3LT.js";import{a as Qe,b as He,c as je}from"./chunk-FWRBVAV4.js";import"./chunk-NH2LHIRZ.js";import"./chunk-DTECNCC4.js";import"./chunk-2FSKRITI.js";import{d as qe,g as ze}from"./chunk-TQCCWZBZ.js";import"./chunk-QPRQJRAS.js";import{c as Ve}from"./chunk-756DJ4VK.js";import{a as xe}from"./chunk-JYYDN77K.js";import{f as re}from"./chunk-BQ4MMRNN.js";import{b as fe}from"./chunk-JSAPTJHL.js";import{b as he}from"./chunk-UFOTACYY.js";import{a as Me,b as Oe,e as we}from"./chunk-THB5JDTQ.js";import{a as se,b as ce}from"./chunk-4E37NPLR.js";import{D as ae,ta as le,ua as me,va as de}from"./chunk-56QOWAU7.js";import"./chunk-77WXBMFN.js";import"./chunk-XFBX5CPU.js";import{a as ve}from"./chunk-C3OPHOKD.js";import{C as Ne,D as Re,E as Pe,c as ke,e as B,h as Fe,i as Ie,o as Te,r as be,s as Ue,t as Be,u as Ae}from"./chunk-KYSGX4IW.js";import"./chunk-LCPYESOB.js";import{h as ne,k as oe}from"./chunk-BFSIXXTJ.js";import"./chunk-DGFNMOMG.js";import{$a as X,Ab as $,Ca as g,Da as f,Db as s,Ea as G,Eb as c,Fb as ee,Ga as x,Ha as E,Ia as d,Ja as r,Ka as a,La as S,Pc as pe,Rc as ue,Sa as N,Ua as b,W as o,Wa as u,Yb as te,_a as K,ab as J,eb as y,ga as H,i as h,jb as m,ka as j,kb as k,lb as _,ma as Y,mb as R,oa as W,p as I,pc as ie,q as T,vb as F,zb as Z}from"./chunk-KZMFGXDY.js";import{Da as O,Fa as Q,I as P,J as M,Ja as w,_ as z}from"./chunk-W3TJXGK4.js";import{a as L,p as q}from"./chunk-H5HZ6YB3.js";var mt=["file"],dt=()=>["/"],st=i=>({"margin-left.px":i}),ct=i=>({color:i}),A=(i,n)=>n.id;function pt(i,n){if(i&1&&(r(0,"div",17)(1,"mat-icon",18),m(2,"folder"),a(),r(3,"b"),m(4),a()()),i&2){let e=u().$implicit;o(4),k(e.name)}}function ut(i,n){if(i&1&&(r(0,"div",36)(1,"mat-icon",18),m(2,"folder"),a(),m(3),a()),i&2){let e=u().$implicit;d("matTooltip",e.name),o(3),_(" ",e.name," ")}}function _t(i,n){if(i&1&&(r(0,"mat-option",19)(1,"div",35),g(2,pt,5,1,"div",17)(3,ut,4,2,"div",36),a()()),i&2){let e=n.$implicit;d("value",e.id),o(),d("ngStyle",$(3,st,(e.deafLevel??0)*20)),o(),f(e.deafLevel==0?2:3)}}function vt(i,n){if(i&1&&(r(0,"div",20),m(1),s(2,"translate"),a()),i&2){let e=u();d("dir",e.langDir),o(),_(" ",c(2,2,"CATEGORY_IS_REQUIRED")," ")}}function gt(i,n){if(i&1&&(r(0,"mat-option",19)(1,"span",37),m(2),a()()),i&2){let e=n.$implicit;d("value",e.id),o(),d("ngStyle",$(3,ct,e==null?null:e.colorCode)),o(),_(" ",e.name," ")}}function ft(i,n){if(i&1&&(r(0,"mat-option",19),m(1),s(2,"storageType"),a()),i&2){let e=n.$implicit;d("value",e.id),o(),_(" ",ee(2,2,e.storageType,e.name)," ")}}function Ct(i,n){if(i&1&&(r(0,"mat-option",19)(1,"span"),m(2),a()()),i&2){let e=n.$implicit;d("value",e.id),o(2),_(" ",e.companyName," ")}}function ht(i,n){if(i&1&&(r(0,"span"),m(1),a()),i&2){let e,t=u(2);o(),_(" ",(e=t.documentForm.get("selectedRoles"))==null?null:e.value[0].name," ")}}function St(i,n){if(i&1&&(r(0,"span",39),m(1),a()),i&2){let e,t=u(2);o(),R(" (+",((e=t.documentForm.get("selectedRoles"))==null||e.value==null?null:e.value.length)-1," ",((e=t.documentForm.get("selectedRoles"))==null||e.value==null?null:e.value.length)===2?"other":"others",") ")}}function Dt(i,n){if(i&1&&(r(0,"mat-option",19),m(1),a()),i&2){let e=n.$implicit;d("value",e),o(),_(" ",e.name," ")}}function xt(i,n){i&1&&(r(0,"div",48),m(1),s(2,"translate"),a()),i&2&&(o(),_(" ",c(2,1,"START_DATE_IS_REQURED")," "))}function Et(i,n){i&1&&(r(0,"div",48),m(1),s(2,"translate"),a()),i&2&&(o(),_(" ",c(2,1,"END_DATE_IS_REQURED")," "))}function yt(i,n){if(i&1){let e=N();r(0,"div",12)(1,"div",33)(2,"div",43),S(3,"input",44,1),s(5,"translate"),r(6,"div",45)(7,"button",46),b("click",function(){I(e);let l=y(11);return T(l.open())}),r(8,"mat-icon",47),m(9,"calendar_today"),a()()()(),S(10,"mat-datepicker",null,2),g(12,xt,3,3,"div",48),a(),r(13,"div",33)(14,"div",43),S(15,"input",49),s(16,"translate"),r(17,"div",45)(18,"button",46),b("click",function(){I(e);let l=y(22);return T(l.open())}),r(19,"mat-icon",47),m(20,"calendar_today"),a()()()(),S(21,"mat-datepicker",null,3),g(23,Et,3,3,"div",48),a()()}if(i&2){let e,t,l,p=y(11),C=y(22),v=u(3);o(3),d("placeholder",F(c(5,14,"CHOOSE_A_START_DATE")))("dir",v.langDir)("min",v.minDate)("matDatepicker",p),o(4),d("dir",v.langDir),o(5),f((e=v.rolePermissionFormGroup.get("startDate"))!=null&&e.touched&&((e=v.rolePermissionFormGroup.get("startDate"))!=null&&e.hasError("required"))?12:-1),o(3),d("placeholder",F(c(16,16,"CHOOSE_A_END_DATE")))("dir",v.langDir)("min",(t=v.rolePermissionFormGroup.get("startDate"))==null?null:t.value)("matDatepicker",C),o(3),d("dir",v.langDir),o(5),f((l=v.rolePermissionFormGroup.get("startDate"))!=null&&l.touched&&((l=v.rolePermissionFormGroup.get("endDate"))!=null&&l.hasError("required"))?23:-1)}}function kt(i,n){if(i&1&&(r(0,"div",40)(1,"mat-checkbox",41),m(2),s(3,"translate"),a(),g(4,yt,24,18,"div",12),r(5,"div")(6,"mat-checkbox",42),m(7),s(8,"translate"),a()()()),i&2){let e,t=u(2);o(),d("dir",t.langDir),o(),_(" ",c(3,5,"SPACIFY_THE_PERIOD")," "),o(2),f((e=t.rolePermissionFormGroup.get("isTimeBound"))!=null&&e.value?4:-1),o(2),d("dir",t.langDir),o(),_("",c(8,7,"ALLOW_DOWNLOAD")," ")}}function Ft(i,n){if(i&1&&(r(0,"div",13)(1,"label",21),m(2),s(3,"translate"),a(),r(4,"mat-select",38),s(5,"translate"),r(6,"mat-select-trigger"),g(7,ht,2,1,"span"),g(8,St,2,2,"span",39),a(),x(9,Dt,2,2,"mat-option",19,A),a(),g(11,kt,9,9,"div",40),a()),i&2){let e,t,l,p=u();o(),d("dir",p.langDir),o(),k(c(3,8,"ASSIGN_ROLES")),o(2),d("placeholder",F(c(5,10,"ROLES")))("dir",p.langDir),o(3),f(((e=p.documentForm.get("selectedRoles"))==null||e.value==null?null:e.value.length)>0?7:-1),o(),f(((t=p.documentForm.get("selectedRoles"))==null||t.value==null?null:t.value.length)>1?8:-1),o(),E(p.roles),o(2),f(((l=p.documentForm.get("selectedRoles"))==null||l.value==null?null:l.value.length)>0?11:-1)}}function It(i,n){if(i&1&&(r(0,"span"),m(1),a()),i&2){let e,t=u(2);o(),R(" ",(e=t.documentForm.get("selectedUsers"))==null||e.value[0]==null?null:e.value[0].firstName," ",(e=t.documentForm.get("selectedUsers"))==null||e.value[0]==null?null:e.value[0].lastName," ")}}function Tt(i,n){if(i&1&&(r(0,"span",39),m(1),a()),i&2){let e,t=u(2);o(),R(" (+",((e=t.documentForm.get("selectedUsers"))==null||e.value==null?null:e.value.length)-1," ",((e=t.documentForm.get("selectedUsers"))==null||e.value==null?null:e.value.length)===2?"other":"others",") ")}}function bt(i,n){if(i&1&&(r(0,"mat-option",19),m(1),a()),i&2){let e=n.$implicit;d("value",e),o(),R(" ",e.firstName," ",e.lastName," ")}}function Ut(i,n){if(i&1&&(r(0,"div",20),m(1),s(2,"translate"),a()),i&2){let e=u(4);d("dir",e.langDir),o(),_(" ",c(2,2,"START_DATE_IS_REQURED")," ")}}function Bt(i,n){if(i&1&&(r(0,"div",20),m(1),s(2,"translate"),a()),i&2){let e=u(4);d("dir",e.langDir),o(),_(" ",c(2,2,"END_DATE_IS_REQURED")," ")}}function At(i,n){if(i&1){let e=N();r(0,"div",12)(1,"div",33)(2,"div",43),S(3,"input",44,1),s(5,"translate"),r(6,"div",45)(7,"button",46),b("click",function(){I(e);let l=y(11);return T(l.open())}),r(8,"mat-icon",47),m(9,"calendar_today"),a()()()(),S(10,"mat-datepicker",null,2),g(12,Ut,3,4,"div",20),a(),r(13,"div",33)(14,"div",43),S(15,"input",49),s(16,"translate"),r(17,"div",45)(18,"button",46),b("click",function(){I(e);let l=y(22);return T(l.open())}),r(19,"mat-icon",47),m(20,"calendar_today"),a()()()(),S(21,"mat-datepicker",null,3),g(23,Bt,3,4,"div",20),a()()}if(i&2){let e,t,l,p=y(11),C=y(22),v=u(3);o(3),d("placeholder",F(c(5,14,"CHOOSE_A_START_DATE")))("dir",v.langDir)("min",v.minDate)("matDatepicker",p),o(4),d("dir",v.langDir),o(5),f((e=v.userPermissionFormGroup.get("startDate"))!=null&&e.touched&&((e=v.userPermissionFormGroup.get("startDate"))!=null&&e.hasError("required"))?12:-1),o(3),d("placeholder",F(c(16,16,"CHOOSE_A_END_DATE")))("dir",v.langDir)("min",(t=v.userPermissionFormGroup.get("startDate"))==null?null:t.value)("matDatepicker",C),o(3),d("dir",v.langDir),o(5),f((l=v.userPermissionFormGroup.get("startDate"))!=null&&l.touched&&((l=v.userPermissionFormGroup.get("endDate"))!=null&&l.hasError("required"))?23:-1)}}function Nt(i,n){if(i&1&&(r(0,"div",51)(1,"mat-checkbox",41),m(2),s(3,"translate"),a(),g(4,At,24,18,"div",12),r(5,"div")(6,"mat-checkbox",42),m(7),s(8,"translate"),a()()()),i&2){let e,t=u(2);o(),d("dir",t.langDir),o(),_(" ",c(3,5,"SPACIFY_THE_PERIOD")," "),o(2),f((e=t.userPermissionFormGroup.get("isTimeBound"))!=null&&e.value?4:-1),o(2),d("dir",t.langDir),o(),k(c(8,7,"ALLOW_DOWNLOAD"))}}function Rt(i,n){if(i&1&&(r(0,"div",13)(1,"label",21),m(2),s(3,"translate"),a(),r(4,"mat-select",50),s(5,"translate"),r(6,"mat-select-trigger"),g(7,It,2,2,"span"),g(8,Tt,2,2,"span",39),a(),x(9,bt,2,3,"mat-option",19,A),a(),g(11,Nt,9,9,"div",51),a()),i&2){let e,t,l,p=u();o(),d("dir",p.langDir),o(),k(c(3,8,"ASSIGN_USERS")),o(2),d("placeholder",F(c(5,10,"USERS")))("dir",p.langDir),o(3),f(((e=p.documentForm.get("selectedUsers"))==null||e.value==null?null:e.value.length)>0?7:-1),o(),f(((t=p.documentForm.get("selectedUsers"))==null||t.value==null?null:t.value.length)>1?8:-1),o(),E(p.userStore.users()),o(2),f(((l=p.documentForm.get("selectedUsers"))==null||l.value==null?null:l.value.length)>0?11:-1)}}function Pt(i,n){if(i&1&&(r(0,"div",20),m(1),s(2,"translate"),a()),i&2){let e=u();d("dir",e.langDir),o(),_(" ",c(2,2,"DOCUMENT_IS_REQUIRED")," ")}}function Mt(i,n){if(i&1&&(r(0,"div",20),m(1),s(2,"translate"),a()),i&2){let e=u(3);d("dir",e.langDir),o(),_(" ",c(2,2,"NAME_IS_REQUIRED")," ")}}function Ot(i,n){i&1&&(r(0,"mat-icon",47),m(1,"hourglass_empty"),a())}function wt(i,n){i&1&&(r(0,"mat-icon",47),m(1,"delete"),a())}function Vt(i,n){if(i&1&&(r(0,"span",57),m(1),a()),i&2){let e,t=u(2).$implicit,l=u(2);d("dir",l.langDir),o(),_(" ",(e=t.get("message"))==null?null:e.value," ")}}function Lt(i,n){if(i&1&&(r(0,"span",58),m(1),a()),i&2){let e,t=u(2).$implicit,l=u(2);d("dir",l.langDir),o(),_(" ",(e=t.get("message"))==null?null:e.value," ")}}function Gt(i,n){if(i&1&&(r(0,"div",28),g(1,Vt,2,2,"span",57)(2,Lt,2,2,"span",58),a()),i&2){let e,t=u().$implicit;o(),f((e=t.get("isSuccess"))!=null&&e.value?1:2)}}function $t(i,n){if(i&1){let e=N();r(0,"li",53)(1,"div",54)(2,"div",33)(3,"div",14),S(4,"input",55),s(5,"translate"),a(),g(6,Mt,3,4,"div",20),a(),r(7,"div",33)(8,"button",56),b("click",function(){let l=I(e).$index,p=u(2);return T(p.removeFile(l))}),g(9,Ot,2,0,"mat-icon",47)(10,wt,2,0,"mat-icon",47),a()(),g(11,Gt,3,1,"div",28),a()()}if(i&2){let e,t,l,p,C=n.$implicit,v=n.$index,D=u(2);o(),d("formGroupName",v),o(3),d("placeholder",F(c(5,9,"SELECTED_FILE_NAME")))("dir",D.langDir)("value",(e=C.get("name"))==null?null:e.value),o(2),f((t=C.get("name"))!=null&&t.touched&&((t=C.get("name"))!=null&&t.errors)&&(!((t=C.get("name"))==null||t.errors==null)&&t.errors.required)?6:-1),o(2),d("dir",D.langDir),o(),f((l=C.get("isLoading"))!=null&&l.value?9:10),o(2),f((p=C.get("message"))!=null&&p.value?11:-1)}}function qt(i,n){if(i&1&&(r(0,"div",33)(1,"ul",52),x(2,$t,12,11,"li",53,G),a()()),i&2){let e=u();o(2),E(e.fileInputs.controls)}}function zt(i,n){if(i&1&&(r(0,"span",57),m(1),a()),i&2){let e=u().$implicit,t=u(2);d("dir",t.langDir),o(),_(" ",e.message," ")}}function Qt(i,n){if(i&1&&(r(0,"span",58),m(1),a()),i&2){let e=u().$implicit,t=u(2);d("dir",t.langDir),o(),_(" ",e.message," ")}}function Ht(i,n){if(i&1&&(r(0,"li",53)(1,"div",60)(2,"div",61)(3,"span"),m(4),a()(),r(5,"div",33),g(6,zt,2,2,"span",57)(7,Qt,2,2,"span",58),a()()()),i&2){let e=n.$implicit,t=u(2);o(2),d("dir",t.langDir),o(2),k(e.name),o(2),f(e.isSuccess?6:7)}}function jt(i,n){if(i&1&&(r(0,"div",33)(1,"ul",59),x(2,Ht,8,3,"li",53,G),a()()),i&2){let e=u();o(2),E(e.resultArray)}}function Yt(i,n){i&1&&(r(0,"div",34),S(1,"mat-progress-spinner",62),a())}var at=class i extends _e{documentForm;extension="";categories=[];allCategories=[];storageSettings=[];documentStatues=[];roles;selectedRoles=[];selectedUsers=[];allowFileExtension=[];loading=!1;resultArray=[];minDate=new Date;maxDate=new Date;fileInput;onSaveDocument=new W;progress=0;isLoading=!1;mode="indeterminate";clientStore=h(et);fb=h(Ne);cd=h(te);categoryService=h(De);commonService=h(he);documentStatusService=h(it);clonerService=h(ve);storageSettingService=h(nt);documentService=h(Ce);toastrService=h(fe);counter;documentStore=h(Se);documentResource=this.documentStore.documentResourceParameter();userStore=h(Ze);chunkSize=ge.chunkSize;chunkUploads=[];constructor(){super()}ngOnInit(){this.createDocumentForm(),this.getCategories(),this.getDocumentStatus(),this.getStorageSetting(),this.getRoles(),this.getAllAllowFileExtension()}get fileInputs(){return this.documentForm.get("files")}get rolePermissionFormGroup(){return this.documentForm.get("rolePermissionForm")}get userPermissionFormGroup(){return this.documentForm.get("userPermissionForm")}createDocumentForm(){this.documentForm=this.fb.group({name:[""],description:[""],categoryId:["",[B.required]],url:[""],extension:[""],documentMetaTags:this.fb.array([]),documentStatusId:[""],storageSettingId:[""],clientId:[""],selectedRoles:[],selectedUsers:[],files:this.fb.array([]),rolePermissionForm:this.fb.group({isTimeBound:[!1],startDate:[""],endDate:[""],isAllowDownload:[!1]}),userPermissionForm:this.fb.group({isTimeBound:[!1],startDate:[""],endDate:[""],isAllowDownload:[!1]}),retentionPeriodInDays:["0"],onExpiryAction:["0"]},{validators:ot})}getRoles(){this.sub$.sink=this.commonService.getRoles().subscribe(n=>this.roles=n)}getDocumentStatus(){this.documentStatusService.getDocumentStatuss().subscribe(n=>{n&&n.length>0?this.documentStatues=n:this.documentStatues=[]})}getStorageSetting(){this.storageSettingService.getStorageSettings().subscribe(n=>{if(n&&n.length>0){this.storageSettings=n;let e=this.storageSettings.find(t=>t.isDefault);e&&this.documentForm.patchValue({storageSettingId:e.id})}})}getAllAllowFileExtension(){this.commonService.getAllowFileExtensions().subscribe(),this.sub$.sink=this.commonService.allowFileExtension$.subscribe(n=>{n&&(this.allowFileExtension=n)})}getCategories(){this.categoryService.getAllCategories().subscribe(n=>{this.categories=[...n],this.categories.filter(t=>t.parentId==null).forEach((t,l)=>{t.deafLevel=0,t.index=l*Math.pow(.1,t.deafLevel),t.displayName=t.name,this.allCategories.push(t),this.setDeafLevel(t)}),this.allCategories=this.clonerService.deepClone(this.allCategories)})}setDeafLevel(n){return n?.children&&n.children.length>0&&n.children.map((e,t)=>{e.displayName=n.displayName+" > "+e.name,e.deafLevel=n?(n.deafLevel??0)+1:0,e.index=n?(n.index??0)+t*Math.pow(.1,e.deafLevel):0,this.allCategories.push(e),this.setDeafLevel(e)}),n}getCategoryNameById(n){return this.allCategories?.find(t=>t.id===n)?.name||""}onFileSelect(n){return q(this,null,function*(){let e=n.target;if(e.files){this.resultArray=[];for(let t=0;t<e.files.length;t++){if(!(yield $e(e.files[t]))){this.toastrService.error(this.translationService.getValue("INVALID_EXTENSION_OR_CORRUPT_INVALID_SIGNATURE")),this.cd.markForCheck();continue}let l=e.files[t];this.extension=l.name.split(".").pop()??"",this.fileExtesionValidation(this.extension)&&this.fileInputs.push(this.fb.group({fileName:[l.name],file:[l],name:[l.name,B.required],extension:[this.extension],message:[""],isSuccess:[!1],isLoading:[!1],documentId:[""]}))}this.cd.markForCheck()}})}removeFile(n){this.fileInputs.removeAt(n)}fileExtesionValidation(n){return!!this.allowFileExtension.find(t=>t.extensions?.find(l=>l.toLowerCase()===n.toLowerCase()))}markFormGroupTouched(n){Object.values(n.controls).forEach(e=>{e.markAsTouched(),e.controls&&this.markFormGroupTouched(e)})}saveFilesAndDocument(){if(this.documentForm.valid){this.loading=!0,this.counter=0;let n=[];if(this.fileInputs.controls.map(e=>{if(!e.get("isSuccess")?.value){let t=this.buildDocumentObject();t.url=e.get("fileName")?.value,t.name=e.get("name")?.value,t.extension=e.get("extension")?.value,t.file=e.get("file")?.value,e.get("file")?.value.size>this.chunkSize?n.push(this.saveDocumentChunk(L({},t))):n.push(this.documentService.addDocument(L({},t)))}}),n.length===0)return;this.resultArray=[],this.chunkUploads=[],this.sub$.sink=P(n).pipe(w((e,t)=>e.pipe(O(l=>M(`${l.error[0]}`))))).subscribe({next:e=>{if(this.counter++,typeof e!="string")if(this.addDocumentTrail(e.id??""),this.fileInputs.at(this.counter-1).patchValue({isLoading:!1,documentId:e.id}),e.isChunk){this.loading=!0;let t=this.fileInputs.at(this.counter-1).get("file")?.value;this.chunkUploads.push(this.uploadFile(e.documentVersionId??"",e.id??"",t))}else this.resultArray.push({isSuccess:!0,documentId:e.id,name:this.fileInputs.at(this.counter-1).get("name")?.value,message:this.translationService.getValue("DOCUMENT_SAVE_SUCCESSFULLY")}),this.fileInputs.at(this.counter-1).patchValue({isLoading:!1});typeof e=="string"&&this.resultArray.push({isSuccess:!1,documentId:"",message:e,name:this.fileInputs.at(this.counter-1).get("name")?.value}),this.documentStore.loadByQuery(this.documentResource)},error:e=>{this.fileInputs.at(this.counter).patchValue({isLoading:!1,documentId:""}),this.loading=!1},complete:()=>{this.uploadedChunksAllFile()}})}else{this.markFormGroupTouched(this.documentForm);return}}uploadedChunksAllFile(){this.sub$.sink=P(this.chunkUploads).pipe(w((n,e)=>n.pipe(O(t=>M(`${t.error[0]}`))))).subscribe({next:n=>{if(this.loading=!1,n.status){let t=this.fileInputs.getRawValue().find(l=>l.documentId===n.documentId);this.resultArray.push({isSuccess:!0,documentId:t.id,name:t.name,message:this.translationService.getValue("DOCUMENT_SAVE_SUCCESSFULLY")})}else this.documentChunkRemove(n.documentId)},error:n=>{this.loading=!1},complete:()=>{this.loading=!1,this.isLoading=!1,this.fileInputs.clear()}})}uploadFile(n,e,t){let l=Math.ceil(t.size/this.chunkSize),{chunkSize1:p,parallelCalls:C}=this.commonService.getNetworkSpeed(),v=[];this.progress=0,this.isLoading=!0;for(let D=0;D<l;D++){let V=D*this.chunkSize,rt=Math.min(V+this.chunkSize,t.size),lt=t.slice(V,rt),U=new FormData;U.append("file",lt),U.append("chunkIndex",D.toString()),U.append("size",this.chunkSize.toString()),U.append("totalChunks",l.toString()),U.append("extension",this.extension),U.append("documentVersionId",n),v.push(this.uploadChunk(U))}return P(v).pipe(z(D=>D,C),Q(),w(()=>this.completeUpload(e)),O(D=>M({documentId:e,status:!1})))}documentChunkRemove(n){this.loading=!0,this.isLoading=!0,this.commonService.markChunkAsUploaded(n,!1).subscribe({next:e=>{this.loading=!1,this.isLoading=!1},error:e=>{this.loading=!1,this.isLoading=!1}})}completeUpload(n){return this.commonService.markChunkAsUploaded(n,!0)}uploadChunk(n){return this.documentService.uploadChunkDocument(n)}saveDocumentChunk(n){return this.documentService.addChunkDocument(n)}addDocumentTrail(n){let e={documentId:n,operationName:2 .toString()};this.loading=!1,this.documentStore.addDocumentAudit(e)}buildDocumentObject(){let n=this.fileInputs.getRawValue(),e={categoryId:this.documentForm.get("categoryId")?.value??"",documentStatusId:this.documentForm.get("documentStatusId")?.value??"",storageSettingId:this.documentForm.get("storageSettingId")?.value??"",clientId:this.documentForm.get("clientId")?.value??"",description:this.documentForm.get("description")?.value??"",documentMetaDatas:[],isAssignToMe:!1,retentionPeriodInDays:this.documentForm.get("retentionPeriodInDays")?.value??null,onExpiryAction:this.documentForm.get("onExpiryAction")?.value??null};return this.selectedRoles.length>0&&(e.documentRolePermissions=this.documentForm.get("selectedRoles")?.value?.map(t=>Object.assign({},{id:"",documentId:"",roleId:t.id},this.rolePermissionFormGroup.value))),this.selectedUsers.length>0&&(e.documentUserPermissions=this.documentForm.get("selectedUsers")?.value?.map(t=>Object.assign({},{id:"",documentId:"",userId:t.id},this.userPermissionFormGroup.value))),e}roleTimeBoundChange(n){n.checked?(this.rolePermissionFormGroup.get("startDate")?.setValidators([B.required]),this.rolePermissionFormGroup.get("endDate")?.setValidators([B.required])):(this.rolePermissionFormGroup.get("startDate")?.clearValidators(),this.rolePermissionFormGroup.get("startDate")?.updateValueAndValidity(),this.rolePermissionFormGroup.get("endDate")?.clearValidators(),this.rolePermissionFormGroup.get("endDate")?.updateValueAndValidity())}userTimeBoundChange(n){n.checked?(this.userPermissionFormGroup.get("startDate")?.setValidators([B.required]),this.userPermissionFormGroup.get("endDate")?.setValidators([B.required])):(this.userPermissionFormGroup.get("startDate")?.clearValidators(),this.userPermissionFormGroup.get("startDate")?.updateValueAndValidity(),this.userPermissionFormGroup.get("endDate")?.clearValidators(),this.userPermissionFormGroup.get("endDate")?.updateValueAndValidity())}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=H({type:i,selectors:[["app-bulk-document-upload"]],viewQuery:function(e,t){if(e&1&&K(mt,5),e&2){let l;X(l=J())&&(t.fileInput=l.first)}},outputs:{onSaveDocument:"onSaveDocument"},features:[j],decls:93,vars:62,consts:[["file",""],["ref",""],["startDatePicker",""],["endDatePicker",""],[1,"content"],[1,"container-fluid"],[1,"d-flex","mb-2"],[1,"me-auto"],[1,"mb-0","page-title"],["code","BULK_DOCUMENT_UPLOADS"],[3,"formGroup"],["appearance","outlined"],[1,"row"],[1,"col-md-4"],[1,"form-group"],[1,"form-label","text-danger",3,"dir"],["panelClass","mat-select-control","formControlName","categoryId",1,"form-control",3,"dir","placeholder"],[1,"d-flex","align-items-center"],[1,"text-warning","me-1"],[3,"value"],[1,"text-danger",3,"dir"],[1,"form-label",3,"dir"],["panelClass","mat-select-control","formControlName","documentStatusId",1,"form-control",3,"dir"],["panelClass","mat-select-control","formControlName","storageSettingId",1,"form-control",3,"dir"],["panelClass","mat-select-control","formControlName","clientId",1,"form-control",3,"dir"],["class","col-md-4",4,"hasClaim"],["type","file","multiple","",1,"form-control",3,"change","dir"],[1,"row","mt-4"],[1,"col-md-12"],["matButton","filled","cdkFocusInitial","",1,"success","me-2",3,"click","dir"],[1,"medium-icon"],["type","button","matButton","filled",1,"error",3,"dir","routerLink"],[1,"row","mt-3"],[1,"col-md-6"],[1,"spinner-container"],[1,"country-item",3,"ngStyle"],[1,"d-flex","align-items-center",3,"matTooltip"],[3,"ngStyle"],["panelClass","mat-select-control","formControlName","selectedRoles","multiple","",1,"form-control",3,"dir","placeholder"],[1,"example-additional-selection"],["formGroupName","rolePermissionForm",1,"mt-3"],["color","primary","formControlName","isTimeBound",3,"dir"],["color","primary","formControlName","isAllowDownload",3,"dir"],[1,"input-group"],["formControlName","startDate",1,"form-control",3,"dir","min","placeholder","matDatepicker"],[1,"input-group-append"],["type","button",1,"btn","btn-primary","calendar-button",3,"click","dir"],[1,"medium-icon","fs-5","align-middle"],[1,"text-danger"],["formControlName","endDate",1,"form-control",3,"dir","min","placeholder","matDatepicker"],["panelClass","mat-select-control","formControlName","selectedUsers","multiple","",1,"form-control",3,"dir","placeholder"],["formGroupName","userPermissionForm",1,"mt-3"],["formArrayName","files",1,"list-group"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"row","w-100",3,"formGroupName"],["formControlName","name","type","text",1,"form-control",3,"dir","placeholder","value"],["matMiniFab","","type","button",1,"error",3,"click","dir"],[1,"badge","bg-success","rounded-pill",3,"dir"],[1,"badge","bg-danger","rounded-pill",3,"dir"],[1,"list-group"],[1,"row","w-100"],[1,"col-md-6",3,"dir"],["mode","indeterminate","diameter","60","strokeWidth","5"]],template:function(e,t){if(e&1){let l=N();r(0,"section",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"span",8),m(5),s(6,"translate"),S(7,"app-page-help-text",9),a()()(),r(8,"form",10)(9,"mat-card",11)(10,"mat-card-content")(11,"div",12)(12,"div",13)(13,"div",14)(14,"label",15),m(15),s(16,"translate"),r(17,"sup"),m(18,"*"),a()(),r(19,"mat-select",16),s(20,"translate"),r(21,"mat-select-trigger")(22,"div",17)(23,"mat-icon",18),m(24,"folder"),a(),r(25,"span"),m(26),s(27,"translate"),a()()(),r(28,"mat-option",19),m(29),s(30,"translate"),a(),x(31,_t,4,5,"mat-option",19,A),a(),g(33,vt,3,4,"div",20),a()(),r(34,"div",13)(35,"div",14)(36,"label",21),m(37),s(38,"translate"),a(),r(39,"mat-select",22)(40,"mat-option"),m(41),s(42,"translate"),a(),x(43,gt,3,5,"mat-option",19,A),a()()(),r(45,"div",13)(46,"div",14)(47,"label",21),m(48),s(49,"translate"),a(),r(50,"mat-select",23),x(51,ft,3,5,"mat-option",19,A),a()()(),r(53,"div",13)(54,"div",14)(55,"label",21),m(56),s(57,"translate"),a(),r(58,"mat-select",24)(59,"mat-option"),m(60),s(61,"translate"),a(),x(62,Ct,3,2,"mat-option",19,A),a()()(),Y(64,Ft,12,12,"div",25)(65,Rt,12,12,"div",25),r(66,"div",12)(67,"div",13)(68,"div",14)(69,"label",15),m(70),s(71,"translate"),r(72,"sup"),m(73,"*"),a()(),r(74,"input",26,0),b("change",function(C){return I(l),T(t.onFileSelect(C))}),a(),g(76,Pt,3,4,"div",20),a()()()(),r(77,"div",27)(78,"div",28)(79,"button",29),b("click",function(){return I(l),T(t.saveFilesAndDocument())}),r(80,"mat-icon",30),m(81,"save"),a(),m(82),s(83,"translate"),a(),r(84,"button",31)(85,"mat-icon",30),m(86,"cancel"),a(),m(87),s(88,"translate"),a()()(),r(89,"div",32),g(90,qt,4,0,"div",33),g(91,jt,4,0,"div",33),a()()()()(),g(92,Yt,2,0,"div",34),a()}if(e&2){let l,p,C;o(5),_("",c(6,35,"BULK_DOCUMENT_UPLOAD")," "),o(3),d("formGroup",t.documentForm),o(6),d("dir",t.langDir),o(),_("",c(16,37,"CATEGORY")," "),o(4),d("placeholder",F(c(20,39,"SELECT_CATEGORY")))("dir",t.langDir),o(7),_(" ",t.getCategoryNameById((l=t.documentForm.get("categoryId"))==null?null:l.value)||c(27,41,"NONE")," "),o(3),_("-- ",c(30,43,"NONE")," --"),o(2),E(t.allCategories),o(2),f((p=t.documentForm.get("categoryId"))!=null&&p.touched&&((p=t.documentForm.get("categoryId"))!=null&&p.errors)&&(!((p=t.documentForm.get("categoryId"))==null||p.errors==null)&&p.errors.required)?33:-1),o(3),d("dir",t.langDir),o(),k(c(38,45,"DOCUMENT_STATUS")),o(2),d("dir",t.langDir),o(2),_("-- ",c(42,47,"NONE")," --"),o(2),E(t.documentStatues),o(4),d("dir",t.langDir),o(),k(c(49,49,"STORAGE")),o(2),d("dir",t.langDir),o(),E(t.storageSettings),o(4),d("dir",t.langDir),o(),k(c(57,51,"CLIENT")),o(2),d("dir",t.langDir),o(2),_("-- ",c(61,53,"NONE")," --"),o(2),E(t.clientStore.clients()),o(2),d("hasClaim","ALL_SHARE_DOCUMENT"),o(),d("hasClaim","ALL_SHARE_DOCUMENT"),o(4),d("dir",t.langDir),o(),_("",c(71,55,"DOCUMENT_UPLOAD")," "),o(4),d("dir",t.langDir),o(2),f((C=t.documentForm.get("files"))!=null&&C.touched&&((C=t.documentForm.get("files"))==null?null:C.value.length)==0?76:-1),o(3),d("dir",t.langDir),o(3),_(" ",c(83,57,"SAVE")," "),o(2),d("dir",t.langDir)("routerLink",Z(61,dt)),o(3),_(" ",c(88,59,"CANCEL")," "),o(3),f(t.fileInputs.controls.length>0?90:-1),o(),f(t.resultArray.length>0?91:-1),o(),f(t.isLoading?92:-1)}},dependencies:[ue,re,ae,je,Qe,He,qe,Pe,Te,ke,Fe,Ie,be,Ae,Ue,Be,oe,ne,ze,de,le,me,We,Ye,Je,Ke,Xe,Re,ye,Ee,Ve,Ge,Le,xe,we,Me,Oe,ie,ce,se,pe,tt],encapsulation:2})};export{at as BulkDocumentUploadComponent};
