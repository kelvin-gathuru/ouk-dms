import{a as pt}from"./chunk-5P7HYDVK.js";import{b as dt}from"./chunk-T33L7LXC.js";import{a as st}from"./chunk-EFC6XIFF.js";import{a as Le}from"./chunk-2EZE64U4.js";import{a as at,b as rt,c as ct,d as lt,e as mt}from"./chunk-UYTZRGIO.js";import"./chunk-GVGC473E.js";import{a as B,b as Fe,c as $e}from"./chunk-PM3ZOWUF.js";import{a as H,b as Pe}from"./chunk-XA5EPKK2.js";import{a as ze,b as Ue,c as Qe,d as Ye,e as qe,f as We,g as Ge,h as Je,i as Ke,j as Xe,k as Ze,l as et,m as tt,n as it,o as nt,p as ot}from"./chunk-O4QTDGQI.js";import"./chunk-ZL3HBFEV.js";import"./chunk-4U6IWAJM.js";import{a as xe}from"./chunk-DFMNWGTU.js";import{a as Me}from"./chunk-KK3LA7D5.js";import"./chunk-PVDG46DZ.js";import{a as ke}from"./chunk-TC5US2P6.js";import{b as Oe}from"./chunk-WFK47GYZ.js";import{c as Ee}from"./chunk-BBTJI4ZO.js";import"./chunk-L52YSXRC.js";import{a as ye}from"./chunk-6GBRFDEJ.js";import{a as De,b as Ae}from"./chunk-GE3TJVIQ.js";import{a as he}from"./chunk-ZXWR2MAY.js";import"./chunk-G4LST2RF.js";import"./chunk-NJY6F3LT.js";import{a as Be,b as Ve,c as je}from"./chunk-FWRBVAV4.js";import"./chunk-NH2LHIRZ.js";import"./chunk-DTECNCC4.js";import"./chunk-2FSKRITI.js";import{d as He}from"./chunk-TQCCWZBZ.js";import"./chunk-QPRQJRAS.js";import{c as Ne}from"./chunk-756DJ4VK.js";import"./chunk-JYYDN77K.js";import"./chunk-BQ4MMRNN.js";import{b as Re}from"./chunk-JSAPTJHL.js";import{b as be}from"./chunk-UFOTACYY.js";import{a as we,b as Te,e as Ie}from"./chunk-THB5JDTQ.js";import{a as ue,b as ve}from"./chunk-4E37NPLR.js";import{ca as de,u as pe}from"./chunk-56QOWAU7.js";import{a as Se}from"./chunk-77WXBMFN.js";import"./chunk-XFBX5CPU.js";import{a as ge}from"./chunk-C3OPHOKD.js";import"./chunk-KYSGX4IW.js";import"./chunk-LCPYESOB.js";import"./chunk-BFSIXXTJ.js";import{a as _e}from"./chunk-DGFNMOMG.js";import{$ as C,$a as w,A as J,Ab as Y,Ca as x,Da as D,Db as s,Dc as me,Eb as p,Fa as Z,Fb as ae,Ga as U,Gc as se,Ha as Q,Ia as d,Ja as r,Ka as a,La as y,Pa as _,Pc as fe,Qa as S,Rc as Ce,Sa as O,Ua as A,W as o,Wa as v,_a as E,ab as T,d as G,ga as K,h as z,jb as m,ka as X,kb as k,kc as re,lb as u,ma as h,mb as ee,p as R,pb as te,pc as ce,q as b,qb as ie,rb as ne,rc as le,vb as I,zb as oe}from"./chunk-KZMFGXDY.js";import{Pa as $,Ya as L,_b as N,fa as F,gb as W,la as q,o as M}from"./chunk-W3TJXGK4.js";import{p as P}from"./chunk-H5HZ6YB3.js";var V=class{constructor(i){this.recentActivityService=i}recentActivitySubject=new M([]);responseHeaderSubject=new M(null);loadingSubject=new M(!1);loading$=this.loadingSubject.asObservable();_count=0;get count(){return this._count}responseHeaderSubject$=this.responseHeaderSubject.asObservable();connect(i){return this.recentActivitySubject.asObservable()}disconnect(i){this.recentActivitySubject.complete(),this.loadingSubject.complete()}loadRecentActivityDocuments(i){this.loadingSubject.next(!0),this.recentActivityService.getRecentDocuments(i).pipe(W(()=>this.loadingSubject.next(!1))).subscribe(e=>{let l=e.headers.get("X-Pagination"),n=l?JSON.parse(l):null;this.responseHeaderSubject.next(n);let c=e.body?[...e.body]:[];this._count=c.length,this.recentActivitySubject.next(c)})}};var j=class t{constructor(i,e){this.httpClient=i;this.commonHttpErrorService=e}getRecentDocuments(i){let e="recentDocument",l=new me().set("Fields",i.fields??"").set("OrderBy",i.orderBy??"").set("PageSize",i.pageSize.toString()).set("Skip",i.skip.toString()).set("SearchQuery",i.searchQuery??"").set("categoryId",i.categoryId??"").set("operation",i.operation??"").set("name",i.name??"").set("documentNumber",i.documentNumber??"").set("id",i?.id?.toString()??"").set("createdBy",i?.createdBy?.toString()??"");return this.httpClient.get(e,{params:l,observe:"response"})}static \u0275fac=function(e){return new(e||t)(z(se),z(_e))};static \u0275prov=G({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ct=["input"],yt=["docNoInput"],ht=t=>({"grid-height-medium":t}),gt=t=>({"margin-left.px":t}),_t=()=>[10,20,30],St=(t,i)=>i.value;function Rt(t,i){if(t&1&&(r(0,"div",36)(1,"mat-icon",38),m(2,"folder"),a(),r(3,"b"),m(4),a()()),t&2){let e=v().$implicit;o(4),k(e.name)}}function bt(t,i){if(t&1&&(r(0,"div",37)(1,"mat-icon",38),m(2,"folder"),a(),m(3),a()),t&2){let e=v().$implicit;d("matTooltip",e.name),o(3),u(" ",e.name," ")}}function xt(t,i){if(t&1&&(r(0,"mat-option",14)(1,"div",35),x(2,Rt,5,1,"div",36)(3,bt,4,2,"div",37),a()()),t&2){let e=i.$implicit;d("value",e),o(),d("ngStyle",Y(3,gt,(e.deafLevel??0)*20)),o(),D(e.deafLevel==0?2:3)}}function Dt(t,i){if(t&1&&(r(0,"mat-option",14),m(1),a()),t&2){let e=i.$implicit;d("value",e.value),o(),u(" ",e.key," ")}}function At(t,i){t&1&&(r(0,"th",39),m(1),s(2,"translate"),s(3,"translate"),a()),t&2&&(o(),ee(" ",p(2,2,"ACTION")," ",p(3,4,"DATE")," "))}function Et(t,i){if(t&1&&(r(0,"td",40),m(1),s(2,"utcToLocalTime"),a()),t&2){let e=i.$implicit;o(),u(" ",ae(2,1,e==null?null:e.createdDate,"full")," ")}}function wt(t,i){t&1&&(r(0,"th",41),m(1),s(2,"translate"),a()),t&2&&(o(),u(" ",p(2,1,"DOCUMENT_NO")," "))}function Tt(t,i){if(t&1){let e=O();r(0,"a",43),A("click",function(){R(e);let n=v().$implicit,c=v();return b(c.onDocumentView(n))}),m(1),a()}if(t&2){let e=v().$implicit;o(),k(e.documentNumber)}}function It(t,i){if(t&1&&m(0),t&2){let e=v().$implicit;u(" ",e.documentNumber," ")}}function Mt(t,i){if(t&1&&(r(0,"td",40),x(1,Tt,2,1,"a",42)(2,It,1,1),a()),t&2){let e=i.$implicit;o(),D(e.isDocumentDeleted===!1?1:2)}}function Nt(t,i){t&1&&(r(0,"th",41),m(1),s(2,"translate"),a()),t&2&&(o(),u(" ",p(2,1,"NAME")," "))}function Ot(t,i){if(t&1){let e=O();r(0,"a",43),A("click",function(){R(e);let n=v().$implicit,c=v();return b(c.onDocumentView(n))}),m(1),a()}if(t&2){let e=v().$implicit;o(),k(e.documentName)}}function kt(t,i){if(t&1&&m(0),t&2){let e=v().$implicit;u(" ",e.documentName," ")}}function Ht(t,i){if(t&1&&(r(0,"td",40),x(1,Ot,2,1,"a",42)(2,kt,1,1),a()),t&2){let e=i.$implicit;o(),D(e.isDocumentDeleted===!1?1:2)}}function Bt(t,i){t&1&&(r(0,"th",41),m(1),s(2,"translate"),a()),t&2&&(o(),u(" ",p(2,1,"CATEGORY_NAME")," "))}function Vt(t,i){if(t&1&&(r(0,"td",40),m(1),a()),t&2){let e=i.$implicit;o(),u(" ",e.categoryName," ")}}function jt(t,i){t&1&&(r(0,"th",41),m(1),s(2,"translate"),a()),t&2&&(o(),u(" ",p(2,1,"OPERATION")," "))}function Pt(t,i){if(t&1&&(r(0,"td",44),m(1),s(2,"translate"),a()),t&2){let e=i.$implicit;d("appDocumentOperationColor",e.operationName),o(),u(" ",p(2,2,e.operationName.toUpperCase())," ")}}function Ft(t,i){if(t&1&&(r(0,"td",45),y(1,"mat-paginator",46),a()),t&2){let e=v();o(),d("length",e.documentResource.totalCount)("pageSize",e.documentResource.pageSize)("pageSizeOptions",oe(3,_t))}}function $t(t,i){t&1&&y(0,"tr",47)}function Lt(t,i){t&1&&y(0,"tr",48)}function zt(t,i){t&1&&y(0,"tr",49)}function Ut(t,i){t&1&&(r(0,"tr")(1,"td",50)(2,"div",51)(3,"b"),m(4),s(5,"translate"),a()()()()),t&2&&(o(4),u(" ",p(5,1,"NO_DATA_FOUND")))}function Qt(t,i){t&1&&(r(0,"div",34),y(1,"mat-progress-spinner",52),a())}var ut=class t extends he{constructor(e,l,n,c,g,f,Yt,qt){super();this.categoryService=e;this.commonService=l;this.overlay=n;this.clonerService=c;this.toastrService=g;this.securityService=f;this.recentActivityService=Yt;this.breakpointObserver=qt;this.documentResource=new Le,this.documentResource.pageSize=10,this.documentResource.orderBy="createdDate desc"}dataSource;operations=[];documentOperation=Me;documentAuditTrails=[];displayedColumns=["createdDate","documentNumber","documentName","categoryName","operationName"];isLoadingResults=!0;documentResource;categories=[];allCategories=[];selectedCategory=null;loading$;securityObject;paginator;sort;input;docNoInput;users=[];footerToDisplayed=["footer"];step=J(0);ngOnInit(){this.getAuthObj(),this.ismobileCheck(),this.dataSource=new V(this.recentActivityService),this.dataSource.loadRecentActivityDocuments(this.documentResource),this.getCategories(),this.getResourceParameter(),this.getOperations()}ismobileCheck(){this.breakpointObserver.isMatched(de.Handset)&&this.step.set(1)}getAuthObj(){this.sub$.sink=this.securityService.SecurityObject.subscribe(e=>{e&&(this.securityObject=e)})}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),this.sub$.sink=q(this.sort.sortChange,this.paginator.page).pipe(N(e=>{this.documentResource.skip=this.paginator.pageIndex*this.paginator.pageSize,this.documentResource.pageSize=this.paginator.pageSize,this.documentResource.orderBy=this.sort.active+" "+this.sort.direction,this.dataSource.loadRecentActivityDocuments(this.documentResource)})).subscribe(),this.sub$.sink=F(this.input.nativeElement,"keyup").pipe($(1e3),L(),N(()=>{this.paginator.pageIndex=0,this.documentResource.skip=0,this.documentResource.name=this.input.nativeElement.value,this.dataSource.loadRecentActivityDocuments(this.documentResource)})).subscribe(),this.sub$.sink=F(this.docNoInput.nativeElement,"keyup").pipe($(1e3),L(),N(()=>{this.paginator.pageIndex=0,this.documentResource.skip=0,this.documentResource.documentNumber=this.docNoInput.nativeElement.value,this.dataSource.loadRecentActivityDocuments(this.documentResource)})).subscribe()}onCategoryChange(e){e&&e.value?this.documentResource.categoryId=e.value.id:this.documentResource.categoryId="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.dataSource.loadRecentActivityDocuments(this.documentResource)}onOperationChange(e){e.value?this.documentResource.operation=e.value:this.documentResource.operation="",this.documentResource.skip=0,this.paginator.pageIndex=0,this.dataSource.loadRecentActivityDocuments(this.documentResource)}getOperations(){this.operations=[{key:"Read",value:1},{key:"Created",value:2},{key:"Modified",value:3},{key:"Deleted",value:4},{key:"Download",value:8},{key:"Added Version",value:9},{key:"Added Signature",value:10},{key:"Restored Version",value:11},{key:"Archived",value:12},{key:"Restored",value:13},{key:"Archived Folder",value:16},{key:"Restored Folder",value:17},{key:"Added Folder",value:18},{key:"Edited Folder",value:19},{key:"Deleted Folder",value:20}]}getCategories(){this.categoryService.getAllCategories().subscribe(e=>{this.categories=[...e],this.categories.filter(n=>n.parentId==null).forEach((n,c)=>{n.deafLevel=0,n.index=c*Math.pow(.1,n.deafLevel),n.displayName=n.name,this.allCategories.push(n),this.setDeafLevel(n)}),this.allCategories=this.clonerService.deepClone(this.allCategories)})}setDeafLevel(e){return e?.children&&e.children.length>0&&e.children.map((l,n)=>{l.displayName=e.displayName+" > "+l.name,l.deafLevel=e?(e.deafLevel??0)+1:0,l.index=e?(e.index??0)+n*Math.pow(.1,l.deafLevel):0,this.allCategories.push(l),this.setDeafLevel(l)}),e}getResourceParameter(){this.sub$.sink=this.dataSource.responseHeaderSubject$.subscribe(e=>{e&&(this.documentResource.pageSize=e.pageSize,this.documentResource.skip=e.skip,this.documentResource.totalCount=e.totalCount)})}onDocumentView(e){return P(this,null,function*(){let n=(e?.url?.split(".")??[])[1],c={documentId:e.documentId,name:e.documentName,extension:n,isVersion:!1,isFromPublicPreview:!1,isPreviewDownloadEnabled:!1,isSignatureExists:!1,isFileRequestDocument:!1,url:e.url,isChunk:e.isChunk,documentNumber:e.documentNumber};if(this.securityObject.isSuperAdmin){let{BasePreviewComponent:g}=yield import("./chunk-JJBHCVNV.js");this.overlay.open(g,{position:"center",origin:"global",panelClass:["file-preview-overlay-container","white-background"],data:c})}else this.commonService.checkDocumentPermission(c.documentId??"").subscribe(g=>P(this,null,function*(){if(g){let{BasePreviewComponent:f}=yield import("./chunk-JJBHCVNV.js");this.overlay.open(f,{position:"center",origin:"global",panelClass:["file-preview-overlay-container","white-background"],data:c})}else{this.toastrService.error(this.translationService.getValue("YOUR_PERMISSION_IS_REVOKED_YOU_CANNOT_SEE_THIS_DOCUMENT"));return}}))})}static \u0275fac=function(l){return new(l||t)(C(xe),C(be),C(Ee),C(ge),C(Re),C(Se),C(j),C(pe))};static \u0275cmp=K({type:t,selectors:[["app-recent-activity"]],viewQuery:function(l,n){if(l&1&&(E(H,5),E(B,5),E(Ct,5),E(yt,5)),l&2){let c;w(c=T())&&(n.paginator=c.first),w(c=T())&&(n.sort=c.first),w(c=T())&&(n.input=c.first),w(c=T())&&(n.docNoInput=c.first)}},features:[X],decls:70,vars:46,consts:[["docNoInput",""],["input",""],[1,"content"],[1,"container-fluid"],[1,"d-flex","mb-2"],[1,"me-auto"],[1,"mb-0","page-title"],[3,"code"],["appearance","outlined"],[3,"expanded"],[1,"d-flex","flex-wrap","flex-column","flex-sm-row"],[1,"p-1","flex-item","flex-fill"],[1,"form-control",3,"placeholder"],["panelClass","mat-select-control",1,"form-control",3,"valueChange","selectionChange","value","placeholder"],[3,"value"],["panelClass","mat-select-control",1,"form-control",3,"selectionChange","placeholder"],[1,"table-responsive","mt-2"],[3,"ngClass"],["mat-table","","matSort","","matSortActive","createdDate","matSortDirection","desc",1,"w-100",3,"dataSource"],["matColumnDef","createdDate"],["class","table-column-fix-200","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","documentNumber"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","documentName"],["matColumnDef","categoryName"],["matColumnDef","operationName"],["mat-cell","",3,"appDocumentOperationColor",4,"matCellDef"],["matColumnDef","footer"],["mat-footer-cell","","colspan","8",4,"matFooterCellDef"],["class","grid-header-color","mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef","matFooterRowDefSticky"],[4,"matNoDataRow"],[1,"spinner-container"],[1,"country-item",3,"ngStyle"],[1,"d-flex","align-items-center"],[1,"d-flex","align-items-center",3,"matTooltip"],[1,"text-warning","me-1"],["mat-header-cell","","mat-sort-header","",1,"table-column-fix-200"],["mat-cell",""],["mat-header-cell","","mat-sort-header",""],[1,"doc-link"],[1,"doc-link",3,"click"],["mat-cell","",3,"appDocumentOperationColor"],["mat-footer-cell","","colspan","8"],[3,"length","pageSize","pageSizeOptions"],["mat-header-row","",1,"grid-header-color"],["mat-row",""],["mat-footer-row",""],["colspan","7"],[1,"m-2"],["mode","indeterminate","diameter","60","strokeWidth","5"]],template:function(l,n){if(l&1){let c=O();r(0,"section",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"span",6),m(5),s(6,"translate"),y(7,"app-page-help-text",7),a()()(),r(8,"mat-card",8)(9,"mat-card-content")(10,"mat-accordion")(11,"mat-expansion-panel",9)(12,"mat-expansion-panel-header")(13,"mat-panel-title"),m(14),s(15,"translate"),a()(),r(16,"div",10)(17,"div",11),y(18,"input",12,0),s(20,"translate"),a(),r(21,"div",11),y(22,"input",12,1),s(24,"translate"),a(),r(25,"div",11)(26,"mat-select",13),s(27,"translate"),ne("valueChange",function(f){return R(c),ie(n.selectedCategory,f)||(n.selectedCategory=f),b(f)}),A("selectionChange",function(f){return R(c),b(n.onCategoryChange(f))}),r(28,"mat-select-trigger"),m(29),s(30,"translate"),a(),r(31,"mat-option",14),m(32),s(33,"translate"),a(),U(34,xt,4,5,"mat-option",14,Z),a()(),r(36,"div",11)(37,"mat-select",15),s(38,"translate"),A("selectionChange",function(f){return R(c),b(n.onOperationChange(f))}),r(39,"mat-option",14),m(40),s(41,"translate"),a(),U(42,Dt,2,2,"mat-option",14,St),a()()()()(),r(44,"div",16)(45,"div",17)(46,"table",18),_(47,19),h(48,At,4,6,"th",20)(49,Et,3,4,"td",21),S(),_(50,22),h(51,wt,3,3,"th",23)(52,Mt,3,1,"td",21),S(),_(53,24),h(54,Nt,3,3,"th",23)(55,Ht,3,1,"td",21),S(),_(56,25),h(57,Bt,3,3,"th",23)(58,Vt,2,1,"td",21),S(),_(59,26),h(60,jt,3,3,"th",23)(61,Pt,3,4,"td",27),S(),_(62,28),h(63,Ft,2,4,"td",29),S(),h(64,$t,1,0,"tr",30)(65,Lt,1,0,"tr",31)(66,zt,1,0,"tr",32)(67,Ut,6,3,"tr",33),a()()()()()()(),x(68,Qt,2,0,"div",34),s(69,"async")}l&2&&(o(5),u("",p(6,24,"RECENT_ACTIVITY")," "),o(2),d("code","RECENT_ACTIVITY"),o(4),d("expanded",n.step()===0),o(3),u(" ",p(15,26,"FILTER")," "),o(4),d("placeholder",I(p(20,28,"DOCUMENT_NO"))),o(4),d("placeholder",I(p(24,30,"SEARCH_DOCUMENT_BY_NAME"))),o(4),d("placeholder",I(p(27,32,"SELECT_CATEGORY"))),te("value",n.selectedCategory),o(3),u(" ",p(30,34,(n.selectedCategory==null?null:n.selectedCategory.displayName)??"NONE")," "),o(3),u("-- ",p(33,36,"NONE")," --"),o(2),Q(n.allCategories),o(3),d("placeholder",I(p(38,38,"SELECT_OPERATION"))),o(3),u("-- ",p(41,40,"NONE")," --"),o(2),Q(n.operations),o(3),d("ngClass",Y(44,ht,n.step()===0)),o(),d("dataSource",n.dataSource),o(18),d("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),o(),d("matRowDefColumns",n.displayedColumns),o(),d("matFooterRowDef",n.footerToDisplayed)("matFooterRowDefSticky",!0),o(2),D(p(69,42,n.dataSource.loading$)?68:-1))},dependencies:[ot,ze,Qe,Ke,qe,Ue,Ze,Ye,Xe,We,Je,Ge,et,it,tt,nt,je,Be,Ve,He,dt,$e,B,Fe,Pe,H,st,Ce,mt,lt,at,rt,ct,ke,Oe,pt,Ne,ve,ue,Ie,we,Te,re,ce,Ae,De,fe,ye,le],encapsulation:2})};export{ut as RecentActivityComponent};
