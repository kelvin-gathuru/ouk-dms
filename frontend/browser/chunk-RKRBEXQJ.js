import{a as f}from"./chunk-C3OPHOKD.js";import{g as p}from"./chunk-BFSIXXTJ.js";import{wa as b}from"./chunk-GDJX5AXE.js";import{Gc as h,d as m,h as o}from"./chunk-KZMFGXDY.js";import{Da as c,_b as u,o as l}from"./chunk-W3TJXGK4.js";var a=class{id;userName="";firstName="";lastName="";email="";phoneNumber="";bearerToken="";isAuthenticated=!1;isSuperAdmin=!1;claims=[]};var y=class n{constructor(e,t,r,i){this.http=e;this.clonerService=t;this.commonHttpErrorService=r;this.router=i}securityObject=new a;securityObject$=new l(null);companyProfile$=new l(null);get SecurityObject(){return this.securityObject$.asObservable()}isUserAuthenticate(){return this.securityObject.userName&&this.securityObject.bearerToken?!0:this.parseSecurityObj()}setCompany(e){if(e)sessionStorage.setItem("company_profile",JSON.stringify(e)),this.companyProfile$.next(JSON.parse(JSON.stringify(e)));else{let t=sessionStorage.getItem("company_profile");t&&t!=="null"&&t!=="undefined"&&this.companyProfile$.next(JSON.parse(t))}}get companyProfile(){return this.companyProfile$.asObservable()}login(e){return this.resetSecurityObject(),this.http.post("user/login",e).pipe(u(t=>{this.securityObject=this.clonerService.deepClone(t),localStorage.setItem("auth_user",JSON.stringify(this.securityObject)),this.securityObject$.next(t)}))}refreshToken(){return this.http.get("user/refresh_token").pipe(u(e=>{this.securityObject=this.clonerService.deepClone(e),localStorage.setItem("auth_user",JSON.stringify(this.securityObject)),this.securityObject$.next(e)})).pipe(c(this.commonHttpErrorService.handleError))}parseSecurityObj(){let e=localStorage.getItem("auth_user"),t=null;if(e)try{t=JSON.parse(e)}catch(r){console.error("Error parsing auth_user from local storage",r)}return t?(this.securityObject=this.clonerService.deepClone(t),this.securityObject.userName&&this.securityObject.bearerToken?(this.securityObject$.next(this.securityObject),!0):!1):!1}logout(){this.resetSecurityObject()}resetSecurityObject(){this.securityObject.userName="",this.securityObject.bearerToken="",this.securityObject.isAuthenticated=!1,this.securityObject.firstName="",this.securityObject.lastName="",this.securityObject.claims=[],localStorage.removeItem("auth_user"),sessionStorage.clear(),this.securityObject$.next(null),this.router.navigate(["/login"])}hasClaim(e,t){let r=!1;if(typeof e=="string")r=this.isClaimValid(e,t);else{let i=e;if(i.length===0)return!0;if(i)for(let s=0;s<i.length&&(r=this.isClaimValid(i[s]),!r);s++);}return r}isClaimValid(e,t){let r=!1,i=null;if(i=this.securityObject,i){if(e.indexOf(":")>=0){let s=e.split(":");e=s[0].toLowerCase(),t=s[1]}else e=e.toLowerCase(),t=t||"true";r=i.claims.find(s=>s.claimType?.toLowerCase()==e?.toLowerCase()&&s.claimValue==t)!=null}return r}getUserDetail(){let e=localStorage.getItem("auth_user");if(!e)return null;try{return JSON.parse(e)}catch{return null}}setUserDetail(e){this.securityObject=this.clonerService.deepClone(e),localStorage.setItem("auth_user",JSON.stringify(this.securityObject))}getQueryParam(e){return new URLSearchParams(window.location.search).get(e)}getCompanyProfile(){return this.http.get("companyprofile")}updateCompanyProfile(e,t){return this.http.post("companyprofile/activate_license",{purchaseCode:t,licenseKey:e}).pipe(c(this.commonHttpErrorService.handleError))}static \u0275fac=function(t){return new(t||n)(o(h),o(f),o(b),o(p))};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};export{y as a};
