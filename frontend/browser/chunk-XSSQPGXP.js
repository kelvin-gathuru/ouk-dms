import{c as ie}from"./chunk-2OJALU77.js";import"./chunk-BJ2ZHXLF.js";import{a as q}from"./chunk-APWCXNU6.js";import{a as U,b as z}from"./chunk-YCBFVA3Y.js";import{a as W}from"./chunk-ZXWR2MAY.js";import"./chunk-G4LST2RF.js";import{b as E,c as _,d as B,e as O,f as h}from"./chunk-2DXU6Z77.js";import{e as te}from"./chunk-F3ENXN4Q.js";import{B as $,E as ee,c as H,e as K,h as Q,i as J,o as X,r as Y,u as Z}from"./chunk-KYSGX4IW.js";import"./chunk-LCPYESOB.js";import{e as M,h as R,k as F}from"./chunk-BFSIXXTJ.js";import{a as A,b as G}from"./chunk-P6E4AR6Q.js";import{ta as T,va as N}from"./chunk-GDJX5AXE.js";import{$ as k,Ca as u,Da as f,Db as d,Eb as p,Ia as v,Ja as o,Ka as n,La as w,Pc as V,Rc as j,Ua as I,W as a,ga as g,i as c,jb as s,ka as b,kb as S,lb as D,vb as x,zb as y}from"./chunk-KZMFGXDY.js";import"./chunk-W3TJXGK4.js";import{p as C}from"./chunk-H5HZ6YB3.js";function ae(t,i){t&1&&(o(0,"div",11),s(1),d(2,"translate"),n()),t&2&&(a(),D(" ",p(2,1,"PASSWORD_IS_REQUIRED")," "))}var L=class t extends W{constructor(e,l,m){super();this.dialogRef=e;this.data=l;this.fb=m}documentLinkForm;isPasswordInvalid=!1;ngOnInit(){this.createDocumentLinkForm()}createDocumentLinkForm(){this.documentLinkForm=this.fb.group({password:["",[K.required]]})}checkPassword(){if(this.documentLinkForm.valid){let e=this.documentLinkForm.get("password")?.value;this.dialogRef.close(e)}else this.documentLinkForm.markAllAsTouched()}static \u0275fac=function(l){return new(l||t)(k(E),k(_),k($))};static \u0275cmp=g({type:t,selectors:[["app-document-link-preview-password"]],features:[b],decls:24,vars:15,consts:[[1,"d-flex"],[1,"me-auto","p-2"],[1,"mb-3","page-title"],["disableClose","true",1,"mt-1",3,"formGroup"],[1,"row","col-md-12"],[1,"col-md-auto"],[1,"material-icons","text-main",2,"font-size","100px"],[1,"col-md"],[1,"form-group"],["for","exampleInputPassword1"],["type","password","formControlName","password","id","exampleInputPassword1",1,"form-control",3,"placeholder"],[1,"text-danger"],["type","submit","matButton","filled",1,"success","mt-2",3,"click"],[1,"medium-icon","fs-5","align-middle"]],template:function(l,m){if(l&1&&(o(0,"mat-dialog-content")(1,"div",0)(2,"div",1)(3,"span",2),s(4),d(5,"translate"),n()()(),o(6,"form",3)(7,"div",4)(8,"div",5)(9,"span",6),s(10," https "),n()(),o(11,"div",7)(12,"div",8)(13,"label",9),s(14),d(15,"translate"),n(),w(16,"input",10),d(17,"translate"),u(18,ae,3,3,"div",11),o(19,"button",12),I("click",function(){return m.checkPassword()}),o(20,"mat-icon",13),s(21,"check"),n(),s(22),d(23,"translate"),n()()()()()()),l&2){let r;a(4),D(" ",p(5,7,"LINK_IS_PASSWORD_PROTECTED")," "),a(2),v("formGroup",m.documentLinkForm),a(8),S(p(15,9,"PASSWORD")),a(2),v("placeholder",x(p(17,11,"ENTER_PASSWORD"))),a(2),f((r=m.documentLinkForm.get("password"))!=null&&r.touched&&(!((r=m.documentLinkForm.get("password"))==null||r.errors==null)&&r.errors.required)?18:-1),a(4),D(" ",p(23,13,"SUBMIT")," ")}},dependencies:[ee,X,H,Q,J,Y,Z,h,O,j,te,N,T,G,A,V],encapsulation:2})};var se=()=>["/"];function le(t,i){t&1&&(o(0,"div",0)(1,"h2"),s(2,"Opps, this is Link is Expired"),n(),o(3,"h3"),s(4,"This url is not valid anymore"),n(),o(5,"a",2),s(6,"Go to Home"),n()()),t&2&&(a(5),v("routerLink",y(1,se)))}function me(t,i){t&1&&(o(0,"div",1),w(1,"mat-progress-spinner",3),n())}var oe=class t{isLoadingResults=!1;documents=[];isLinkExpired=!1;code;route=c(M);overlay=c(ie);dialog=c(B);documentService=c(q);ngOnInit(){this.code=this.route.snapshot.params.code,this.getLinkInfo()}getLinkInfo(){this.documentService.getLinkInfoByCode(this.code).subscribe({next:i=>{i.isLinkExpired?this.isLinkExpired=!0:this.getDocument(i)},error:()=>{this.isLinkExpired=!0}})}getDocument(i){this.documentService.getDocumentByCode(this.code).subscribe({next:e=>C(this,null,function*(){this.isLoadingResults=!0;try{let m=(e.url?.split(".")??[])[1],r={documentId:this.code,name:e.name,extension:m,isVersion:!1,isFromPublicPreview:!0,isPreviewDownloadEnabled:e.isAllowDownload??!1,isFileRequestDocument:!1,isSignatureExists:e.isSignatureExists,documentNumber:e.documentNumber};if(i.hasPassword)this.openForgotPasswordDialog(i,r);else{let{BasePreviewComponent:P}=yield import("./chunk-BJ7BM7KC.js");this.overlay.open(P,{position:"center",origin:"global",panelClass:["file-preview-overlay-container","white-background"],data:r,closeOnBackdropClick:!1})}}finally{this.isLoadingResults=!1}}),error:()=>{this.isLinkExpired=!0}})}openForgotPasswordDialog(i,e){this.dialog.open(L,{data:{linkInfo:i,docView:e},disableClose:!0,backdropClass:"black-background",width:"500px"}).afterClosed().subscribe(m=>C(this,null,function*(){this.isLoadingResults=!0;try{e.linkPassword=m;let{BasePreviewComponent:r}=yield import("./chunk-BJ7BM7KC.js");this.overlay.open(r,{position:"center",origin:"global",panelClass:["file-preview-overlay-container","white-background"],data:e,closeOnBackdropClick:!1}).afterClosed().subscribe(()=>{this.openForgotPasswordDialog(i,e)})}finally{this.isLoadingResults=!1}}))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=g({type:t,selectors:[["app-document-link-preview"]],inputs:{documents:"documents"},decls:2,vars:2,consts:[[1,"center-screen"],[1,"spinner-container"],[1,"btn","btn-primary",3,"routerLink"],["mode","indeterminate","diameter","60","strokeWidth","5"]],template:function(e,l){e&1&&(u(0,le,7,2,"div",0),u(1,me,2,0,"div",1)),e&2&&(f(l.isLinkExpired?0:-1),a(),f(l.isLoadingResults?1:-1))},dependencies:[F,R,h,z,U],encapsulation:2})};export{oe as DocumentLinkPreviewComponent};
