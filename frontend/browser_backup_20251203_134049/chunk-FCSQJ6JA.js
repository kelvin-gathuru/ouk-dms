import{b as xe,c as Fe,d as he}from"./chunk-YVPTUBXX.js";import{a as Ie}from"./chunk-TKVPHECB.js";import{a as Ee}from"./chunk-3NQBK7XS.js";import{a as Ce}from"./chunk-6B3EO7HE.js";import{a as Y}from"./chunk-6GBRFDEJ.js";import{a as ie,b as ne}from"./chunk-GE3TJVIQ.js";import{a as Z}from"./chunk-ZXWR2MAY.js";import"./chunk-G4LST2RF.js";import{b as ee}from"./chunk-JSAPTJHL.js";import{b as te}from"./chunk-UFOTACYY.js";import{a as fe,b as _e,e as ve}from"./chunk-THB5JDTQ.js";import{a as Q,b as X}from"./chunk-4E37NPLR.js";import{$,ta as z,va as W}from"./chunk-56QOWAU7.js";import{a as J}from"./chunk-77WXBMFN.js";import"./chunk-XFBX5CPU.js";import"./chunk-C3OPHOKD.js";import{B as ce,E as ue,c as oe,e as L,h as re,i as le,o as ae,r as se,s as de,t as pe,u as me}from"./chunk-KYSGX4IW.js";import"./chunk-LCPYESOB.js";import{e as U,h as G,k as j}from"./chunk-BFSIXXTJ.js";import"./chunk-DGFNMOMG.js";import{$ as E,Ca as u,Da as f,Db as s,Eb as d,Fa as w,Fb as V,Ga as k,Ha as D,Ia as F,Ja as n,Ka as o,La as g,Pc as H,R as A,Rc as K,Sa as S,Ua as R,W as t,Wa as x,Yb as O,_ as M,ga as B,jb as l,ka as N,kb as v,lb as _,p as I,q as h,u as T,vb as q,zb as y}from"./chunk-KZMFGXDY.js";import"./chunk-W3TJXGK4.js";import{p as P}from"./chunk-H5HZ6YB3.js";var Re=()=>["/"];function ge(i,m){i&1&&(n(0,"div",12)(1,"h2"),l(2),s(3,"translate"),o(),n(4,"p"),l(5),s(6,"translate"),o(),n(7,"a",14),l(8),s(9,"translate"),o()()),i&2&&(t(2),v(d(3,4,"LINK_EXPIRED")),t(3),v(d(6,6,"URL_NOT_VALID")),t(2),F("routerLink",y(10,Re)),t(),_(" ",d(9,8,"GO_HOME")," "))}function qe(i,m){i&1&&(n(0,"div",20),l(1),s(2,"translate"),o()),i&2&&(t(),_(" ",d(2,1,"PASSWORD_IS_REQUIRED")," "))}function Le(i,m){if(i&1){let e=S();n(0,"form",15)(1,"div",17)(2,"label",18),l(3),s(4,"translate"),n(5,"sup"),l(6,"*"),o()(),g(7,"input",19),s(8,"translate"),u(9,qe,3,3,"div",20),n(10,"button",21),R("click",function(){I(e);let a=x(2);return h(a.checkPassword())}),n(11,"mat-icon",22),l(12,"lock"),o(),l(13),s(14,"translate"),o()()()}if(i&2){let e,r=x(2);F("formGroup",r.documentLinkForm),t(3),_("",d(4,6,"PASSWORD")," "),t(4),F("placeholder",q(d(8,8,"ENTER_PASSWORD"))),t(2),f((e=r.documentLinkForm.get("password"))!=null&&e.touched&&((e=r.documentLinkForm.get("password"))!=null&&e.hasError("required"))?9:-1),t(4),_(" ",d(14,10,"SUBMIT")," ")}}function be(i,m){if(i&1){let e=S();n(0,"button",28),R("click",function(){I(e);let a=x(4);return h(a.addFileInput())}),n(1,"mat-icon",22),l(2,"add"),o(),l(3),s(4,"translate"),o()}i&2&&(t(3),_(" ",d(4,1,"ADD_ANOTHER_FILE")," "))}function we(i,m){if(i&1&&(n(0,"div",25),u(1,be,5,3,"button",27),o()),i&2){let e=x(3);t(),f(e.fileInputs&&e.fileRequestInfo&&e.fileRequestDocuments&&e.fileInputs.length<e.fileRequestInfo.maxDocument-e.fileRequestDocuments.length?1:-1)}}function ke(i,m){i&1&&(n(0,"div",33),l(1),s(2,"translate"),o()),i&2&&(t(),_(" ",d(2,1,"FILE_IS_REQUIRED")," "))}function De(i,m){i&1&&(n(0,"div",33),l(1),s(2,"translate"),o()),i&2&&(t(),_(" ",d(2,1,"FILE_SIZE_EXCEEDED")," "))}function ye(i,m){i&1&&(n(0,"div",33),l(1),s(2,"translate"),o()),i&2&&(t(),_(" ",d(2,1,"INVALID_FILE_EXTENSION")," "))}function Pe(i,m){i&1&&(n(0,"div",33),l(1),s(2,"translate"),o()),i&2&&(t(),_(" ",d(2,1,"NAME_IS_REQUIRED")," "))}function Te(i,m){if(i&1){let e=S();n(0,"button",37),R("click",function(){I(e);let a=x().$index,p=x(4);return h(p.removeFileInput(a))}),n(1,"mat-icon",22),l(2,"delete"),o()()}}function Ae(i,m){if(i&1){let e=S();n(0,"div",30)(1,"div",8)(2,"div",9)(3,"label",31),l(4),s(5,"translate"),n(6,"sup"),l(7,"*"),o()(),n(8,"input",32),R("change",function(a){let p=I(e).$index,c=x(4);return h(c.onFileSelected(a,p))}),o(),u(9,ke,3,3,"div",33),u(10,De,3,3,"div",33),u(11,ye,3,3,"div",33),o(),n(12,"div",9)(13,"label",31),l(14),s(15,"translate"),n(16,"sup"),l(17,"*"),o()(),g(18,"input",34),s(19,"translate"),u(20,Pe,3,3,"div",33),o(),n(21,"div",35),u(22,Te,3,0,"button",36),o()()()}if(i&2){let e,r,a,p,c=m.$implicit,C=m.$index,b=x(4);F("formGroupName",C),t(3),F("for",q("fileInput-"+C)),t(),_("",d(5,17,"DOCUMENT_UPLOAD")," "),t(4),F("id","fileInput-"+C),t(),f((e=c.get("file"))!=null&&e.touched&&((e=c.get("file"))!=null&&e.hasError("required"))?9:-1),t(),f((r=c.get("file"))!=null&&r.touched&&((r=c.get("file"))!=null&&r.hasError("sizeExceeded"))?10:-1),t(),f((a=c.get("file"))!=null&&a.touched&&((a=c.get("file"))!=null&&a.hasError("invalidExtension"))?11:-1),t(2),F("for",q("fileName-"+C)),t(),_(" ",d(15,19,"FILE_NAME")," "),t(4),F("placeholder",q(d(19,21,"SELECTED_FILE_NAME")))("id","fileName-"+C)("value",b.uploadedFileNames[C]||""),t(2),f((p=c.get("name"))!=null&&p.touched&&((p=c.get("name"))!=null&&p.hasError("required"))?20:-1),t(2),f(C>0?22:-1)}}function Me(i,m){if(i&1){let e=S();n(0,"div",16)(1,"button",38),R("click",function(){I(e);let a=x(4);return h(a.onFileUpload())}),n(2,"mat-icon",39),l(3,"save"),o(),l(4),s(5,"translate"),o(),n(6,"button",40)(7,"mat-icon",39),l(8,"cancel"),o(),l(9),s(10,"translate"),o()()}if(i&2){let e=x(4);t(),F("disabled",e.uploadedFiles.length===0),t(3),_(" ",d(5,4,"UPLOAD_FILES")," "),t(2),F("routerLink",y(8,Re)),t(3),_(" ",d(10,6,"CANCEL")," ")}}function Be(i,m){if(i&1&&(n(0,"form",26)(1,"mat-card",11)(2,"mat-card-content")(3,"div",29),k(4,Ae,23,23,"div",30,w),o(),u(6,Me,11,9,"div",16),o()()()),i&2){let e=x(3);F("formGroup",e.uploadForm),t(4),D(e.fileInputs.controls),t(2),f(e.fileRequestDocuments&&e.fileRequestInfo&&e.fileRequestDocuments.length<e.fileRequestInfo.maxDocument?6:-1)}}function Ne(i,m){if(i&1&&(n(0,"div",23)(1,"table",24)(2,"thead")(3,"tr")(4,"th"),l(5),s(6,"translate"),o(),n(7,"th"),l(8),s(9,"translate"),o(),n(10,"th"),l(11),s(12,"translate"),o(),n(13,"th"),l(14),s(15,"translate"),o()()(),n(16,"tbody")(17,"tr")(18,"td"),l(19),o(),n(20,"td"),l(21),o(),n(22,"td"),l(23),o(),n(24,"td"),l(25),o()()()()(),u(26,we,2,1,"div",25),u(27,Be,7,2,"form",26)),i&2){let e=x(2);t(5),v(d(6,10,"SUBJECT")),t(3),v(d(9,12,"ALLOW_FILE_TYPE")),t(3),v(d(12,14,"REQUEST_BY")),t(3),v(d(15,16,"MAXIMUM_FILE_SIZE_UPLOAD")),t(5),v(e.fileRequestInfo.subject),t(2),v(e.fileRequestInfo.allowExtension),t(2),v(e.fileRequestInfo.createdById),t(2),_("",e.fileRequestInfo.sizeInMb," Mb"),t(),f(!e.requiresPassword||e.isPasswordVerified?26:-1),t(),f(e.fileRequestInfo&&e.fileRequestInfo.maxDocument-e.fileRequestDocuments.length>=e.fileInputs.length?27:-1)}}function Ve(i,m){if(i&1&&(n(0,"tr")(1,"td"),l(2),o(),n(3,"td",41),s(4,"fileRequestDocumentStatus"),l(5),s(6,"fileRequestDocumentStatus"),o(),n(7,"td"),l(8),s(9,"utcToLocalTime"),o()()),i&2){let e=m.$implicit;t(2),v(e.name),t(),F("appStatusColor",d(4,4,e.fileRequestDocumentStatus)),t(2),_(" ",d(6,6,e.fileRequestDocumentStatus)," "),t(3),v(V(9,8,e.createdDate,"full"))}}function Oe(i,m){if(i&1&&(n(0,"div",16)(1,"h5"),l(2),s(3,"translate"),o(),n(4,"table",24)(5,"thead")(6,"tr")(7,"th"),l(8),s(9,"translate"),o(),n(10,"th"),l(11),s(12,"translate"),o(),n(13,"th"),l(14),s(15,"translate"),o()()(),n(16,"tbody"),k(17,Ve,10,11,"tr",null,w),o()()()),i&2){let e=x(2);t(2),v(d(3,4,"UPLOADED_FILES")),t(6),v(d(9,6,"FILE_NAME")),t(3),v(d(12,8,"DOCUMENT_STATUS")),t(3),v(d(15,10,"UPLOADED_DATE")),t(3),D(e.fileRequestDocuments)}}function Ue(i,m){if(i&1&&(u(0,Le,15,12,"form",15),u(1,Ne,28,18),u(2,Oe,19,12,"div",16)),i&2){let e=x();f(e.requiresPassword&&!e.isPasswordVerified?0:-1),t(),f((!e.requiresPassword||e.isPasswordVerified)&&e.fileRequestDocuments&&e.fileRequestInfo&&e.fileRequestDocuments.length<e.fileRequestInfo.maxDocument?1:-1),t(),f(e.fileRequestDocuments&&e.fileRequestDocuments.length>0?2:-1)}}function Ge(i,m){i&1&&(n(0,"div",13),g(1,"mat-progress-spinner",42),o())}var Se=class i extends Z{constructor(e,r,a,p,c,C,b,je,$e,ze){super();this.document=e;this.route=r;this.renderer=a;this.fileRequestService=p;this.fileRequestDocumentService=c;this.fb=C;this.commonService=b;this.toastrService=je;this.securityService=$e;this.cd=ze}documents=[];logoUrl;isLinkExpired=!1;fileRequestInfo;fileRequestDocuments=[];uploadForm;requiresPassword=!1;isPasswordVerified=!1;subject;requestedBy;extension;allowFileExtension=[];uploadedFiles=[];uploadedFileNames=[];isLoading=!1;get fileInputs(){return this.uploadForm.get("files")}addFileInput(){this.fileInputs.push(this.createFileGroup())}removeFileInput(e){e>0&&(this.fileInputs.removeAt(e),this.uploadedFiles.splice(e,1),this.uploadedFileNames.splice(e,1))}code;documentLinkForm;isPasswordInvalid=!1;ngOnInit(){this.code=this.route.snapshot.params.code,this.createFileRequestLinkForm(),this.uploadForm=this.fb.group({files:this.fb.array([this.createFileGroup()])}),this.getLinkInfo(),this.getAllAllowFileExtension(),this.getCompanyProfile()}getAllAllowFileExtension(){this.commonService.getAllowFileExtensions().subscribe(),this.sub$.sink=this.commonService.allowFileExtension$.subscribe(e=>{e&&(this.allowFileExtension=e)})}createFileRequestLinkForm(){this.documentLinkForm=this.fb.group({password:["",[L.required]]})}checkPassword(){if(this.documentLinkForm.valid){let e=this.documentLinkForm.get("password")?.value;this.fileRequestService.verifyPassword(this.code,e).subscribe({next:r=>{this.isPasswordVerified=r,r?this.documentLinkForm.reset():(this.toastrService.error(this.translationService.getValue("INVALID_PASSWORD")),this.documentLinkForm.get("password")?.setErrors({invalid:!0}))},error:()=>{this.documentLinkForm.get("password")?.setErrors({invalid:!0})}})}else this.documentLinkForm.markAllAsTouched()}createFileGroup(){return this.fb.group({name:["",[L.required]],file:["",[L.required]]})}createBuildObject(){let e=this.fileRequestInfo.id,r=this.fileInputs.controls?.map(c=>c.get("file")?.value),a=this.fileInputs.controls?.map(c=>c.get("name")?.value);return{fileRequestId:e??"",files:r,names:a}}getLinkInfo(){this.fileRequestService.getFileRequestData(this.code).subscribe({next:e=>{this.isLinkExpired=!!e.isLinkExpired,this.isLinkExpired||(this.fileRequestInfo=e,this.fileRequestDocuments=e.fileRequestDocuments||[],this.requiresPassword=!!e.hasPassword)},error:()=>{this.isLinkExpired=!0}})}onFileUpload(){let e=this.uploadedFiles.filter(r=>r!==void 0);if(!e.length){this.toastrService.error("Please select at least one valid file.");return}if(this.uploadForm.valid){this.isLoading=!0;let r={fileRequestId:this.code,files:e,names:this.uploadedFileNames.filter(a=>a!==void 0)};this.fileRequestDocumentService.addFileRequestDocument(r).subscribe({next:()=>{this.isLoading=!1,this.toastrService.success(this.translationService.getValue("FILE_UPLOADED_SUCCESSFULLY")),this.uploadedFiles=[],this.uploadedFileNames=[],this.fileInputs.clear(),this.getLinkInfo()},error:()=>{this.isLoading=!1}})}else this.uploadForm.markAllAsTouched()}onFileSelected(e,r){return P(this,null,function*(){let p=e.target?.files?.[0];if(!p||!(yield Ee(p))){this.toastrService.error(this.translationService.getValue("INVALID_EXTENSION_OR_CORRUPT_INVALID_SIGNATURE")),this.cd.markForCheck();return}if(p){if(p.size/1048576>this.fileRequestInfo.sizeInMb){this.uploadedFiles[r]=void 0,this.uploadedFileNames[r]=void 0,this.fileInputs.at(r)?.get("file")?.setErrors({sizeExceeded:!0}),this.uploadForm.updateValueAndValidity();return}if(this.validateFileExtension(p))this.uploadedFiles[r]=p,this.uploadedFileNames[r]=p.name,this.fileInputs.at(r)?.get("file")?.setErrors(null),this.fileInputs.at(r)?.get("name")?.setErrors(null);else{this.uploadedFiles[r]=void 0,this.uploadedFileNames[r]=void 0,this.fileInputs.at(r)?.get("file")?.setErrors({invalidExtension:!0}),this.uploadForm.updateValueAndValidity();return}}})}validateFileExtension(e){let r=e.name.split(".").pop()?.toLowerCase();if(!r)return!1;let p=(this.fileRequestInfo.allowExtension?this.fileRequestInfo.allowExtension.split(","):[]).map(C=>Ce[C]);return this.allowFileExtension.some(C=>p.includes(C.fileType)&&C.extensions?.includes(r))}fileExtesionValidation(e){return!!this.allowFileExtension.find(a=>a.extensions?.find(p=>p.toLowerCase()===e.toLowerCase()))}mobileMenuSidebarOpen(e,r){e.target.classList.contains(r)?this.renderer.removeClass(this.document.body,r):this.renderer.addClass(this.document.body,r)}getCompanyProfile(){this.securityService.getCompanyProfile().subscribe(e=>{e&&(this.logoUrl=e.logoUrl)})}static \u0275fac=function(r){return new(r||i)(E(T),E(U),E(M),E(Ie),E(he),E(ce),E(te),E(ee),E(J),E(O))};static \u0275cmp=B({type:i,selectors:[["app-file-request-link-preview"]],inputs:{documents:"documents"},features:[N],decls:19,vars:7,consts:[["navbar",""],[1,"navbar","active"],[1,"container-fluid"],[1,"navbar-header"],["onClick","return false;",1,"bars",3,"click"],["routerLink","/",1,"navbar-brand"],["alt","Logo",1,"logo-img",3,"src"],[1,"content"],[1,"row","align-items-center"],[1,"col-md-6","mb-2"],[1,"mb-0","page-title"],["appearance","outlined"],[1,"text-center","text-danger"],[1,"spinner-container"],[1,"btn","btn-primary","mt-3",3,"routerLink"],[1,"mb-4",3,"formGroup"],[1,"mt-4"],[1,"form-group"],[1,"form-label","text-danger"],["type","password","formControlName","password",1,"form-control",3,"placeholder"],[1,"text-danger"],["matButton","filled",1,"primary","mt-2",3,"click"],[1,"medium-icon","fs-5","align-middle"],[1,"table-responsive"],[1,"table","table-bordered"],[1,"col-md-12","d-flex","justify-content-end","mb-2"],[1,"mt-4",3,"formGroup"],["type","button",1,"btn","btn-primary","me-2"],["type","button",1,"btn","btn-primary","me-2",3,"click"],["formArrayName","files",1,"row","g-3"],[1,"col-12",3,"formGroupName"],[1,"form-label","text-danger",3,"for"],["type","file","formControlName","file",1,"form-control",3,"change","id"],[1,"text-danger","small","mt-1"],["type","text","formControlName","name",1,"form-control",3,"id","value","placeholder"],[1,"col-md-1","text-end"],["type","button","aria-label","Remove",1,"btn","btn-danger","btn-sm"],["type","button","aria-label","Remove",1,"btn","btn-danger","btn-sm",3,"click"],["matButton","filled","type","button",1,"success","me-2",3,"click","disabled"],[1,"medium-icon","align-middle"],["matButton","filled","type","button",1,"error",3,"routerLink"],[3,"appStatusColor"],["mode","indeterminate","diameter","60","strokeWidth","5"]],template:function(r,a){if(r&1){let p=S();n(0,"nav",1,0)(2,"div",2)(3,"div",3)(4,"a",4),R("click",function(C){return I(p),h(a.mobileMenuSidebarOpen(C,"overlay-open"))}),o(),n(5,"a",5),g(6,"img",6),o()()()(),n(7,"section",7)(8,"div",2)(9,"div",8)(10,"div",9)(11,"span",10),l(12),s(13,"translate"),o()()(),n(14,"mat-card",11)(15,"mat-card-content"),u(16,ge,10,11,"div",12),u(17,Ue,3,3),o()()()(),u(18,Ge,2,0,"div",13)}r&2&&(t(6),F("src",a.logoUrl,A),t(6),_(" ",d(13,5,"FILE_UPLOAD_REQUEST")," "),t(4),f(a.isLinkExpired||a.fileRequestDocuments&&a.fileRequestInfo&&a.fileRequestDocuments.length>=a.fileRequestInfo.maxDocument?16:-1),t(),f(a.isLinkExpired?-1:17),t(),f(a.isLoading?18:-1))},dependencies:[ue,ae,oe,re,le,se,me,de,pe,j,G,K,Fe,$,X,Q,ve,fe,_e,W,z,ne,ie,xe,H,Y],styles:[".card[_ngcontent-%COMP%]{border-radius:10px;box-shadow:0 4px 8px #0000001a}.card-header[_ngcontent-%COMP%]{border-top-left-radius:10px;border-top-right-radius:10px}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center}.input-group[_ngcontent-%COMP%]   .btn-danger[_ngcontent-%COMP%]{margin-left:8px}.btn[_ngcontent-%COMP%]{font-size:14px}.list-group-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}section.content[_ngcontent-%COMP%]{margin-left:0!important}"]})};export{Se as FileRequestLinkPreviewComponent};
