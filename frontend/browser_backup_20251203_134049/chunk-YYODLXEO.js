import{a as T}from"./chunk-DFMNWGTU.js";import{a as y,b as a,c as I,d as R,e as S,f as b,g as E,h as p}from"./chunk-OHUA35YV.js";import{a as N}from"./chunk-6MWAWDLF.js";import{a as w}from"./chunk-77WXBMFN.js";import{Ob as h,i as c}from"./chunk-KZMFGXDY.js";import{J as D,Pa as u,Ub as g,_b as B,h as l}from"./chunk-W3TJXGK4.js";import{a as m,b as d}from"./chunk-H5HZ6YB3.js";var U={documents:[],isLoading:!1,categories:[],selectedCategoryId:"",newCategoryPath:[],documentResourceParameter:{id:"",createdBy:"",categoryId:"",documentStatusId:"",storageSettingId:"",clientId:"",createDate:void 0,fields:"",orderBy:"createdDate desc",searchQuery:"",pageSize:15,skip:0,name:"",totalCount:0,metaTags:"",documentNumber:""},commonError:null},O=I({providedIn:"root"},E(U),R(({documentResourceParameter:o,categories:i,documents:n})=>({sortedCategories:h(()=>{if(!i()||i().length===0)return[];let r=o().orderBy.split(" ");return r[0]==="name"?r[1]==="asc"?[...i().sort((e,t)=>t.name.localeCompare(e.name))]:[...i().sort((e,t)=>e.name.localeCompare(t.name))]:r[0]==="createdDate"?r[1]==="asc"?[...i().sort((e,t)=>new Date(e.createdDate).getTime()-new Date(t.createdDate).getTime())]:[...i().sort((e,t)=>new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime())]:r[0]==="createdBy"?r[1]==="asc"?[...i().sort((e,t)=>t.createdUserName?.localeCompare(e.createdUserName??"")??0)]:[...i().sort((e,t)=>e.createdUserName?.localeCompare(t.createdUserName??"")??0)]:[...i()]}),sortedDocuments:h(()=>{if(!n()||n().length===0)return[];let r=o().orderBy.split(" ");return r[0]==="createdDate"?r[1]==="asc"?[...n().sort((e,t)=>new Date(e.createdDate).getTime()-new Date(t.createdDate).getTime())]:[...n().sort((e,t)=>new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime())]:r[0]==="name"?r[1]==="asc"?[...n().sort((e,t)=>t.name.localeCompare(e.name))]:[...n().sort((e,t)=>e.name.localeCompare(t.name))]:r[0]==="documentNumber"?r[1]==="asc"?[...n().sort((e,t)=>t.documentNumber?.localeCompare(e.documentNumber))]:[...n().sort((e,t)=>e.documentNumber?.localeCompare(t.documentNumber))]:r[0]==="createdBy"?r[1]==="asc"?[...n().sort((e,t)=>t.createdBy?.localeCompare(e.createdBy))]:[...n().sort((e,t)=>e.createdBy?.localeCompare(t.createdBy))]:[...n()]})})),b((o,i=c(N),n=c(T),f=c(w))=>({loadCategoriesById:p(l(u(300),g(r=>(r||(r="00000000-0000-0000-0000-000000000000"),n.getCategoriesByParentId(r).pipe(y({next:e=>{let t=r;r=="00000000-0000-0000-0000-000000000000"&&(t=""),a(o,{categories:[...e],documentResourceParameter:d(m({},o.documentResourceParameter()),{categoryId:t}),selectedCategoryId:t,isLoading:!1})},error:e=>{a(o,{commonError:e}),console.error(e)}})))))),loadByQuery:p(l(u(300),B(()=>a(o,{isLoading:!0})),g(r=>r?(r.categoryId||(r.categoryId="00000000-0000-0000-0000-000000000000"),f.hasClaim("all_view_documents")?i.getDocuments(r).pipe(y({next:e=>{if(e.headers.get("X-Pagination")){let t=e.headers,s=t.get("X-Pagination")?JSON.parse(t.get("X-Pagination")??"{}"):null,C=o.documentResourceParameter(),x=d(m({},C),{totalCount:s?.totalCount??0,pageSize:s?.pageSize??0,skip:s?.skip??0}),P=e.body?e.body:[],L=[...o.documents().filter(v=>P.findIndex(k=>k.id===v.id)===-1),...P];a(o,{documents:[...L],isLoading:!1,commonError:void 0,documentResourceParameter:m({},x)})}},error:e=>{a(o,{commonError:e,isLoading:!1})}})):(a(o,{isLoading:!1,documents:[]}),D(null))):D(null)))),setLoadingFlag(r){a(o,{isLoading:r})},loadCategoriesBySelectedCategoryId(){this.loadCategoriesById(o.selectedCategoryId())},loadDocumentsByCategory(r){let e=d(m({},o.documentResourceParameter()),{skip:0,categoryId:r});this.loadByQuery(e)},setDocumentsEmpty(){a(o,{documents:[]})},setDocumentResource(r){a(o,{documentResourceParameter:m({},r)})},loadDocuments(){o.selectedCategoryId()&&this.loadByQuery(o.documentResourceParameter())},addCategoryPath(r){r?a(o,{newCategoryPath:[...o.newCategoryPath(),r]}):a(o,{newCategoryPath:[]})},categoryPath:p(l(u(300),g(r=>n.getCategoriesHierarchicalBychildId(r).pipe(y({next:e=>{let t=e.sort((s,C)=>C.level??0>(s.level??0)?1:-1);a(o,{newCategoryPath:[...t]})},error:e=>{a(o,{commonError:e}),console.error(e)}}))))),removeCategoryPath(r){if(!r)a(o,{newCategoryPath:[]});else{let e=o.newCategoryPath().findIndex(t=>t.id===r.id);if(e!==-1){let t=o.newCategoryPath().slice(0,e+1);a(o,{newCategoryPath:t})}}}})),S({onInit(o,i=c(w)){i.isUserAuthenticate()&&o.loadCategoriesById("")}}));export{O as a};
