<VirtualHost *:80>
    ServerName na.topdev.co.ke
    ServerAlias na-api.topdev.co.ke

    # Redirect HTTP to HTTPS
    RewriteEngine on
    RewriteCond %{SERVER_NAME} =na.topdev.co.ke [OR]
    RewriteCond %{SERVER_NAME} =na-api.topdev.co.ke
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
    ServerName na-api.topdev.co.ke
    
    # SSL Configuration (Certbot will likely manage the paths, but we set placeholders or rely on Certbot to add them)
    # SSLEngine on
    # SSLCertificateFile /etc/letsencrypt/live/na.topdev.co.ke/fullchain.pem
    # SSLCertificateKey /etc/letsencrypt/live/na.topdev.co.ke/privkey.pem

    # Proxy configuration for .NET API
    ProxyPreserveHost On
    ProxyPass / http://localhost:5000/
    ProxyPassReverse / http://localhost:5000/

    ErrorLog ${APACHE_LOG_DIR}/na-api-error.log
    CustomLog ${APACHE_LOG_DIR}/na-api-access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName na.topdev.co.ke
    DocumentRoot /var/www/html/ParliamentSystem/frontend

    # SSL Configuration
    # SSLEngine on
    # SSLCertificateFile /etc/letsencrypt/live/na.topdev.co.ke/fullchain.pem
    # SSLCertificateKey /etc/letsencrypt/live/na.topdev.co.ke/privkey.pem

    <Directory /var/www/html/ParliamentSystem/frontend>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Angular Routing
        RewriteEngine On
        RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -f [OR]
        RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -d
        RewriteRule ^ - [L]
        RewriteRule ^ /index.html [L]
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/na-frontend-error.log
    CustomLog ${APACHE_LOG_DIR}/na-frontend-access.log combined
</VirtualHost>
